<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>试卷模拟系统</title>
    <style>
        /* 保持原有样式不变 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            overflow-x: hidden;
            font-size: 16px;
        }

        .app-container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            height: 95vh;
            max-height: 900px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* 页面容器 */
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .page.active {
            display: flex;
        }

        /* 试卷选择页面 */
        .exam-selection {
            padding: 20px 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .exam-selection h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #2d3748;
            font-size: 24px;
            font-weight: 600;
        }

        /* 更新说明按钮 */
        .update-notes-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 8px 12px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .update-notes-btn:hover {
            background: #4c51bf;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

        /* 更新说明弹窗 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 15px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 18px;
            padding: 25px;
            width: 100%;
            max-width: 700px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #718096;
            cursor: pointer;
            transition: color 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal-btn:hover {
            color: #2d3748;
            background: #f7fafc;
        }

        .update-notes {
            line-height: 1.8;
        }

        .update-section {
            margin-bottom: 20px;
        }

        .update-section h3 {
            font-size: 17px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #5a67d8;
            display: inline-block;
        }

        .update-section ul {
            padding-left: 20px;
        }

        .update-section li {
            margin-bottom: 10px;
            color: #4a5568;
            font-size: 15px;
        }

        .security-notice {
            background: #f7fafc;
            border-left: 4px solid #e53e3e;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            color: #742a2a;
            font-size: 14px;
        }

        .update-date {
            text-align: right;
            color: #718096;
            font-size: 13px;
            margin-top: 20px;
        }

        .exam-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            flex: 1;
        }

        .exam-card {
            background: white;
            border-radius: 15px;
            padding: 18px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
        }

        .exam-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: #5a67d8;
        }

        .exam-icon {
            font-size: 32px;
            margin-bottom: 12px;
            text-align: center;
        }

        .exam-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .exam-title {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2d3748;
        }

        .exam-description {
            color: #718096;
            font-size: 14px;
            margin-bottom: 12px;
            flex: 1;
        }

        .exam-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .exam-question-count {
            font-size: 13px;
            color: #4a5568;
        }

        .exam-status {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 500;
        }

        .exam-status.available {
            background: #c6f6d5;
            color: #2f855a;
        }

        .exam-status.empty {
            background: #fed7d7;
            color: #c53030;
        }

        /* 随机练习选择页面 */
        .random-selection {
            padding: 20px 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .random-selection h1 {
            text-align: center;
            margin-bottom: 18px;
            color: #2d3748;
            font-size: 22px;
            font-weight: 600;
        }

        .random-description {
            background: #f7fafc;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            color: #4a5568;
            font-size: 14px;
            line-height: 1.6;
            border-left: 4px solid #5a67d8;
        }

        .random-exam-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .random-exam-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            text-align: center;
        }

        .random-exam-item:hover {
            border-color: #5a67d8;
            background: #edf2f7;
        }

        .random-exam-item.selected {
            background: #e6fffa;
            border-color: #5a67d8;
        }

        .random-exam-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .random-exam-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 6px;
            color: #2d3748;
        }

        .random-exam-count {
            font-size: 13px;
            color: #718096;
        }

        .random-selection-info {
            background: #f7fafc;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 18px;
        }

        .random-selection-info h3 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2d3748;
        }

        .random-selection-info p {
            color: #4a5568;
            font-size: 14px;
        }

        .random-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: auto;
        }

        /* 错题记录页面 */
        .wrong-answer-container {
            padding: 20px 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .wrong-answer-container h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #2d3748;
            font-size: 24px;
            font-weight: 600;
        }

        .wrong-answer-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .wrong-answer-item {
            background: white;
            border-radius: 15px;
            padding: 18px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid #e53e3e;
        }

        .wrong-answer-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .wrong-answer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .wrong-answer-type {
            background: #e53e3e;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .wrong-answer-number {
            font-size: 14px;
            color: #718096;
        }

        .wrong-answer-question {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .wrong-answer-details {
            display: flex;
            gap: 15px;
            font-size: 14px;
        }

        .wrong-answer-user {
            color: #e53e3e;
        }

        .wrong-answer-correct {
            color: #38a169;
        }

        .empty-wrong-answers {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px 20px;
            text-align: center;
        }

        .empty-icon {
            font-size: 50px;
            color: #cbd5e0;
            margin-bottom: 18px;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
        }

        .empty-text {
            font-size: 15px;
            color: #718096;
            max-width: 400px;
        }

        .wrong-answer-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: auto;
        }

        /* 加载动画 */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .loading-container.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e2e8f0;
            border-top: 5px solid #5a67d8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .loading-subtext {
            font-size: 14px;
            color: #718096;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 答题界面 */
        .exam-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .header {
            background: #5a67d8;
            color: white;
            padding: 12px 15px;
            position: relative;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .header-btn.active {
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .exam-title {
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .progress-container {
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-bar {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 13px;
            opacity: 0.9;
        }

        .content-wrapper {
            flex: 1;
            overflow-y: auto;
            position: relative;
            height: calc(100% - 120px);
            padding-bottom: 80px;
        }

        .content {
            padding: 18px 15px;
            padding-bottom: 80px;
        }

        .question-type {
            display: inline-block;
            background: #5a67d8;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .question-type.animate {
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .question-number {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }

        .dynamic-feedback {
            font-size: 13px;
            color: #718096;
        }

        .correct-option {
            color: #38a169;
            font-weight: 600;
        }

        .user-option {
            color: #e53e3e;
            font-weight: 600;
        }

        .question-text {
            font-size: 17px;
            font-weight: 500;
            margin-bottom: 18px;
            line-height: 1.5;
            color: #2d3748;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option:hover {
            border-color: #5a67d8;
            background: #edf2f7;
        }

        .option.selected {
            background: #e6fffa;
            border-color: #5a67d8;
        }

        .option.correct {
            background: #c6f6d5;
            border-color: #38a169;
        }

        .option.incorrect {
            background: #fed7d7;
            border-color: #e53e3e;
        }

        .option-label {
            width: 30px;
            height: 30px;
            background: #5a67d8;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .option-text {
            flex: 1;
            font-size: 15px;
            color: #2d3748;
        }

        /* 判断题选项样式 */
        .judge-option {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 60px;
        }

        .judge-option:hover {
            border-color: #5a67d8;
            background: #edf2f7;
        }

        .judge-option.selected {
            background: #e6fffa;
            border-color: #5a67d8;
        }

        .judge-option.correct {
            background: #c6f6d5;
            border-color: #38a169;
        }

        .judge-option.incorrect {
            background: #fed7d7;
            border-color: #e53e3e;
        }

        .judge-label {
            font-size: 17px;
            font-weight: 600;
            color: #2d3748;
        }

        /* 排序题样式 */
        .sort-container {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .sort-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .sort-option {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sort-option:hover {
            border-color: #5a67d8;
            background: #edf2f7;
        }

        .sort-option.used {
            background: #e2e8f0;
            border-color: #cbd5e0;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .sort-option.locked {
            background: #e2e8f0;
            border-color: #cbd5e0;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .sort-number {
            width: 30px;
            height: 30px;
            background: #5a67d8;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .sort-text {
            flex: 1;
            font-size: 15px;
            color: #2d3748;
        }

        .sort-answer-area {
            background: #f7fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 18px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .sort-answer-item {
            background: #5a67d8;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sort-answer-item:hover {
            background: #4c51bf;
            transform: translateY(-2px);
        }

        .sort-answer-item.locked {
            cursor: not-allowed;
            opacity: 0.8;
        }

        .sort-arrow {
            color: #5a67d8;
            font-size: 20px;
            font-weight: bold;
        }

        /* 排序题提交按钮 */
        .sort-submit-container {
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }

        .sort-submit-btn {
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sort-submit-btn:hover {
            background: #4c51bf;
            transform: translateY(-2px);
        }

        .sort-submit-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        /* 多选题样式 - 紧凑布局 */
        .multiple-container {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .multiple-compact {
            background: #f7fafc;
            border-radius: 15px;
            padding: 18px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .multiple-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .multiple-info {
            font-size: 15px;
            color: #4a5568;
            font-weight: 500;
        }

        .multiple-actions {
            display: flex;
            gap: 8px;
        }

        .multiple-action-btn {
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .multiple-action-btn.secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .multiple-action-btn:hover {
            transform: translateY(-1px);
        }

        .multiple-main {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .multiple-options-panel, .multiple-answer-panel {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .multiple-panel-title {
            font-size: 15px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
        }

        .multiple-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
        }

        .multiple-option-item {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .multiple-option-item:hover {
            border-color: #5a67d8;
            background: #edf2f7;
        }

        .multiple-option-item.used {
            background: #e2e8f0;
            border-color: #cbd5e0;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .multiple-option-letter {
            width: 24px;
            height: 24px;
            background: #5a67d8;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 13px;
            flex-shrink: 0;
        }

        .multiple-option-text {
            flex: 1;
            font-size: 14px;
            color: #2d3748;
        }

        .multiple-answer-content {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .multiple-answer-tag {
            background: #5a67d8;
            color: white;
            padding: 8px 10px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .multiple-answer-tag:hover {
            background: #4c51bf;
            transform: translateY(-1px);
        }

        .remove-icon {
            font-size: 14px;
            font-weight: bold;
        }

        .empty-hint {
            color: #a0aec0;
            font-style: italic;
            text-align: center;
            padding: 18px;
        }

        .multiple-submit-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
        }

        .multiple-count {
            font-size: 13px;
            color: #4a5568;
        }

        .count-number {
            font-weight: 600;
            color: #5a67d8;
        }

        .multiple-submit-btn {
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 14px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .multiple-submit-btn:hover {
            background: #4c51bf;
            transform: translateY(-1px);
        }

        .multiple-submit-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none !important;
        }

        /* 答案反馈样式 */
        .answer-feedback {
            margin-top: 18px;
            padding: 15px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            display: none;
        }

        .answer-feedback.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .answer-feedback.correct {
            background: #c6f6d5;
            color: #2f855a;
            border-left: 4px solid #38a169;
        }

        .answer-feedback.incorrect {
            background: #fed7d7;
            color: #c53030;
            border-left: 4px solid #e53e3e;
        }

        /* 底部固定导航栏 */
        .bottom-navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            padding: 12px 15px;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 110px;
            justify-content: center;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .nav-btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .nav-btn-secondary:hover {
            background: #cbd5e0;
            transform: translateY(-2px);
        }

        .nav-btn-primary {
            background: #5a67d8;
            color: white;
        }

        .nav-btn-primary:hover {
            background: #4c51bf;
            transform: translateY(-2px);
        }

        .nav-icon {
            font-size: 17px;
        }

        .nav-text {
            font-size: 15px;
        }

        /* 密码输入弹窗 */
        .password-content {
            background: white;
            border-radius: 18px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .password-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 18px;
            text-align: center;
            color: #2d3748;
        }

        .password-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }

        .password-input:focus {
            outline: none;
            border-color: #5a67d8;
        }

        .password-error {
            color: #e53e3e;
            font-size: 14px;
            margin-bottom: 18px;
            text-align: center;
            display: none;
        }

        .password-actions {
            display: flex;
            gap: 12px;
        }

        .password-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .password-btn-primary {
            background: #5a67d8;
            color: white;
        }

        .password-btn-primary:hover {
            background: #4c51bf;
        }

        .password-btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .password-btn-secondary:hover {
            background: #cbd5e0;
        }

        /* 打乱动画弹窗 - 提高z-index确保在最上层 */
        .shuffle-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            text-align: center;
            position: relative;
            z-index: 9999;
        }

        .shuffle-icon-large {
            font-size: 50px;
            margin-bottom: 18px;
            animation: spin 2s linear infinite;
        }

        .shuffle-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #2d3748;
        }

        .shuffle-text {
            font-size: 15px;
            color: #718096;
            margin-bottom: 18px;
            line-height: 1.5;
        }

        .shuffle-progress {
            height: 8px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 18px;
        }

        .shuffle-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #5a67d8, #9f7aea);
            width: 0%;
            animation: progress 3s linear forwards;
        }

        @keyframes progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        .shuffle-dots {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .shuffle-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #cbd5e0;
            animation: dotPulse 1.5s infinite;
        }

        .shuffle-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .shuffle-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes dotPulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 1; }
        }

        /* 顾老太太打乱方式选择弹窗 - 确保在最上层 */
        #grandmaShuffleModeModal {
            z-index: 1001;
        }

        #grandmaShuffleModeModal .shuffle-content {
            position: relative;
            z-index: 1002;
            animation: scaleIn 0.3s ease;
        }

        /* 一键打乱方式选择弹窗 */
        #shuffleModeModal {
            z-index: 1001;
        }

        #shuffleModeModal .shuffle-content {
            position: relative;
            z-index: 1002;
            animation: scaleIn 0.3s ease;
        }

        /* 设置模态框 - 优化布局 */
        .settings-content {
            background: white;
            border-radius: 18px;
            padding: 25px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            max-height: 90vh;
            overflow-y: auto;
        }

        .settings-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            color: #2d3748;
        }

        /* 顾老太太打乱设置区域 - 移至最上层并突出显示 */
        .grandma-shuffle-section {
            background: linear-gradient(135deg, #f8f9ff 0%, #e6f7ff 100%);
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 20px;
            border: 2px solid #5a67d8;
            box-shadow: 0 4px 12px rgba(90, 103, 216, 0.15);
            position: relative;
            overflow: hidden;
        }

        .grandma-shuffle-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #5a67d8, #9f7aea);
        }

        .grandma-shuffle-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .grandma-icon {
            font-size: 24px;
            color: #5a67d8;
        }

        .grandma-title {
            font-size: 17px;
            font-weight: 600;
            color: #2d3748;
        }

        .grandma-description {
            font-size: 13px;
            color: #4a5568;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .grandma-toggle-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .grandma-toggle-label {
            font-size: 15px;
            color: #2d3748;
            font-weight: 500;
        }

        .grandma-toggle {
            width: 55px;
            height: 28px;
            background: #cbd5e0;
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .grandma-toggle.active {
            background: #5a67d8;
            box-shadow: 0 0 10px rgba(90, 103, 216, 0.3);
        }

        .grandma-toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .grandma-toggle.active .grandma-toggle-slider {
            transform: translateX(27px);
        }

        .grandma-status {
            font-size: 12px;
            color: #718096;
            margin-top: 8px;
            font-style: italic;
        }

        /* 普通设置项 */
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            font-size: 15px;
            color: #4a5568;
            font-weight: 500;
        }

        .toggle-switch {
            width: 48px;
            height: 24px;
            background: #cbd5e0;
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: #5a67d8;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        .shuffle-mode-selector {
            margin-top: 10px;
            margin-bottom: 18px;
        }

        .shuffle-mode-option {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .shuffle-mode-option:hover {
            border-color: #5a67d8;
            background: #f7fafc;
        }

        .shuffle-mode-option.active {
            border-color: #5a67d8;
            background: #e6fffa;
        }

        .shuffle-mode-radio {
            width: 18px;
            height: 18px;
            border: 2px solid #cbd5e0;
            border-radius: 50%;
            position: relative;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .shuffle-mode-option.active .shuffle-mode-radio {
            border-color: #5a67d8;
        }

        .shuffle-mode-option.active .shuffle-mode-radio::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 8px;
            height: 8px;
            background: #5a67d8;
            border-radius: 50%;
        }

        .shuffle-mode-label {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .shuffle-mode-description {
            font-size: 13px;
            color: #718096;
            line-height: 1.4;
        }

        .sound-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .sound-btn {
            background: #f8f9fa;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .sound-btn:hover {
            border-color: #5a67d8;
            background: #edf2f7;
        }

        .sound-btn.active {
            border-color: #5a67d8;
            background: #e6fffa;
        }

        .sound-preview {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #4a5568;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sound-preview:hover {
            background: #cbd5e0;
        }

        .sound-preview.playing {
            animation: spin 1s linear infinite;
        }

        .close-settings-btn {
            width: 100%;
            padding: 12px;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 18px;
        }

        .close-settings-btn:hover {
            background: #4c51bf;
        }

        /* 答题卡模态框 */
        .answer-card-content {
            background: white;
            border-radius: 18px;
            padding: 25px;
            width: 100%;
            max-width: 700px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            max-height: 90vh;
            overflow-y: auto;
        }

        .answer-card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 18px;
            text-align: center;
            color: #2d3748;
        }

        .filter-tabs {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 18px;
            background: #f7fafc;
            border-radius: 10px;
            padding: 5px;
        }

        .filter-tab {
            flex: 1;
            padding: 8px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #718096;
            font-size: 13px;
        }

        .filter-tab:hover {
            background: #edf2f7;
        }

        .filter-tab.active {
            background: #5a67d8;
            color: white;
        }

        /* 特殊状态提示区域 */
        #specialStatusArea {
            margin-bottom: 18px;
        }

        .answer-card-special {
            background: #f7fafc;
            border-radius: 15px;
            padding: 18px;
            text-align: center;
            border-left: 5px solid;
        }

        .answer-card-special.empty {
            border-color: #cbd5e0;
        }

        .answer-card-special.all-correct {
            border-color: #38a169;
            background: #f0fff4;
        }

        .answer-card-special.all-incorrect {
            border-color: #e53e3e;
            background: #fffaf0;
        }

        .special-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .special-title {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2d3748;
        }

        .special-text {
            font-size: 13px;
            color: #718096;
            line-height: 1.5;
        }

        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
            gap: 8px;
            margin-bottom: 18px;
        }

        .question-btn {
            aspect-ratio: 1;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            color: #4a5568;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .question-btn:hover {
            border-color: #5a67d8;
            transform: translateY(-2px);
        }

        .question-btn.current {
            background: #5a67d8;
            color: white;
            border-color: #5a67d8;
        }

        .question-btn.unanswered {
            background: #fed7d7;
            border-color: #feb2b2;
            color: #c53030;
        }

        .question-btn.correct {
            background: #c6f6d5;
            border-color: #9ae6b4;
            color: #2f855a;
        }

        .question-btn.incorrect {
            background: #fed7d7;
            border-color: #feb2b2;
            color: #c53030;
        }

        .answer-card-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 18px;
        }

        /* 清空确认弹窗 */
        .confirm-content {
            background: white;
            border-radius: 18px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            text-align: center;
        }

        .confirm-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #2d3748;
        }

        .confirm-text {
            font-size: 15px;
            color: #718096;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .confirm-actions {
            display: flex;
            gap: 12px;
        }

        /* 结果模态框 */
        .result-content {
            background: white;
            border-radius: 25px;
            padding: 30px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
            text-align: center;
        }

        .result-icon {
            font-size: 50px;
            margin-bottom: 18px;
        }

        .result-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 18px;
            color: #2d3748;
        }

        .result-score {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .result-score.pass {
            color: #38a169;
        }

        .result-score.fail {
            color: #e53e3e;
        }

        .result-score.perfect {
            color: #f6ad55;
        }

        #scorePercentage {
            font-size: 42px;
            font-weight: 700;
        }

        .result-badge {
            padding: 6px 10px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 600;
        }

        .result-badge.pass {
            background: #c6f6d5;
            color: #2f855a;
        }

        .result-badge.fail {
            background: #fed7d7;
            color: #c53030;
        }

        .result-badge.perfect {
            background: #fef5e7;
            color: #d69e2e;
        }

        .result-details {
            background: #f7fafc;
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 500;
            color: #4a5568;
            font-size: 14px;
        }

        .result-value {
            font-weight: 600;
            color: #2d3748;
            font-size: 14px;
        }

        .result-text {
            font-size: 16px;
            color: #4a5568;
            margin-bottom: 18px;
            line-height: 1.5;
        }

        .result-evaluation {
            background: #f7fafc;
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 20px;
            text-align: left;
            line-height: 1.6;
        }

        .result-evaluation.pass {
            border-left: 5px solid #38a169;
        }

        .result-evaluation.fail {
            border-left: 5px solid #e53e3e;
        }

        .result-evaluation.perfect {
            border-left: 5px solid #f6ad55;
        }

        .close-btn {
            width: 100%;
            padding: 12px;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #4c51bf;
        }

        /* 打乱顺序提示 */
        .shuffle-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #2d3748;
            color: white;
            padding: 12px 18px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 500;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            animation: slideUp 0.3s ease;
        }

        /* 音效错误提示 */
        .sound-error-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #e53e3e;
            color: white;
            padding: 12px 18px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 500;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            animation: slideUp 0.3s ease;
        }

        /* 音效预览提示 */
        .sound-preview-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #5a67d8;
            color: white;
            padding: 12px 18px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 500;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            animation: slideUp 0.3s ease;
        }

        /* 错误提示 */
        .error-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #e53e3e;
            color: white;
            padding: 12px 18px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 500;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            animation: slideUp 0.3s ease;
        }

        /* 多选题反馈样式 */
        .feedback-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            flex-wrap: wrap;
            gap: 8px;
        }

        .feedback-score {
            font-weight: 600;
        }

        .feedback-time {
            font-size: 12px;
            opacity: 0.8;
        }

        .multiple-feedback-detail {
            text-align: left;
        }

        .feedback-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 8px;
        }

        .feedback-item.correct {
            background: rgba(56, 161, 105, 0.2);
        }

        .feedback-item.incorrect {
            background: rgba(229, 62, 62, 0.2);
        }

        .feedback-item.missing {
            background: rgba(237, 137, 54, 0.2);
        }

        .feedback-icon {
            flex-shrink: 0;
            margin-top: 2px;
        }

        .feedback-text {
            flex: 1;
            line-height: 1.4;
        }

        .feedback-section {
            margin-bottom: 12px;
        }

        .feedback-section-title {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .feedback-explanation {
            margin-top: 12px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.5;
        }

        .feedback-explanation-title {
            font-weight: 600;
            margin-bottom: 6px;
        }

        /* 按钮样式 */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 44px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: #5a67d8;
            color: white;
        }

        .btn-primary:hover {
            background: #4c51bf;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-danger {
            background: #e53e3e;
            color: white;
        }

        .btn-danger:hover {
            background: #c53030;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* 历史记录样式 */
        .history-container {
            padding: 20px 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .history-container h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #2d3748;
            font-size: 24px;
            font-weight: 600;
        }

        .history-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 18px;
        }

        .history-record-item {
            background: white;
            border-radius: 15px;
            padding: 18px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .history-record-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .history-record-item.pass {
            border-color: #38a169;
        }

        .history-record-item.fail {
            border-color: #e53e3e;
        }

        .empty-history {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px 20px;
            text-align: center;
        }

        .empty-icon {
            font-size: 50px;
            color: #cbd5e0;
            margin-bottom: 18px;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
        }

        .empty-text {
            font-size: 15px;
            color: #718096;
            max-width: 400px;
        }

        .history-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: auto;
        }

        /* 10086版本特殊功能 - 人物脸部状态 - 优化动画效果 */
        .character-face {
            position: absolute;
            top: 70px;
            right: 20px;
            width: 80px;
            height: 80px;
            background: #ffdbac;
            border-radius: 50%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 10;
            overflow: hidden;
        }

        .character-face.normal {
            background: #ffdbac;
            border-radius: 50%;
            width: 80px;
            height: 80px;
        }

        /* 优化肿胀动画 - 更逼真的猪头效果 */
        .character-face.swollen {
            background: #ff9e80;
            border-radius: 60%;
            width: 110px;
            height: 110px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            animation: swell 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8) 0%, transparent 20%),
                            radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.6) 0%, transparent 15%),
                            radial-gradient(circle at 50% 50%, rgba(255, 150, 100, 0.8) 0%, #ff9e80 70%);
        }

        /* 优化恢复动画 - 更平滑的恢复过程 */
        .character-face.recovering {
            animation: recover 2s ease-in-out forwards;
        }

        @keyframes swell {
            0% {
                border-radius: 50%;
                width: 80px;
                height: 80px;
                background: #ffdbac;
                transform: scale(1);
            }
            30% {
                border-radius: 70%;
                width: 100px;
                height: 100px;
                background: #ff9e80;
                transform: scale(1.1);
            }
            60% {
                border-radius: 65%;
                width: 115px;
                height: 115px;
                background: #ff8a65;
                transform: scale(1.2);
            }
            100% {
                border-radius: 60%;
                width: 110px;
                height: 110px;
                background: #ff9e80;
                transform: scale(1.15);
                background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8) 0%, transparent 20%),
                                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.6) 0%, transparent 15%),
                                radial-gradient(circle at 50% 50%, rgba(255, 150, 100, 0.8) 0%, #ff9e80 70%);
            }
        }

        @keyframes recover {
            0% {
                border-radius: 60%;
                width: 110px;
                height: 110px;
                background: #ff9e80;
                transform: scale(1.15);
                background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8) 0%, transparent 20%),
                                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.6) 0%, transparent 15%),
                                radial-gradient(circle at 50% 50%, rgba(255, 150, 100, 0.8) 0%, #ff9e80 70%);
            }
            25% {
                border-radius: 65%;
                width: 100px;
                height: 100px;
                background: #ffa270;
                transform: scale(1.1);
                background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.7) 0%, transparent 25%),
                                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.5) 0%, transparent 20%),
                                radial-gradient(circle at 50% 50%, rgba(255, 160, 120, 0.7) 0%, #ffa270 70%);
            }
            50% {
                border-radius: 70%;
                width: 90px;
                height: 90px;
                background: #ffb090;
                transform: scale(1.05);
                background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6) 0%, transparent 30%),
                                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.4) 0%, transparent 25%),
                                radial-gradient(circle at 50% 50%, rgba(255, 170, 140, 0.6) 0%, #ffb090 70%);
            }
            75% {
                border-radius: 80%;
                width: 85px;
                height: 85px;
                background: #ffc0a0;
                transform: scale(1.02);
                background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.5) 0%, transparent 35%),
                                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.3) 0%, transparent 30%),
                                radial-gradient(circle at 50% 50%, rgba(255, 180, 160, 0.5) 0%, #ffc0a0 70%);
            }
            100% {
                border-radius: 50%;
                width: 80px;
                height: 80px;
                background: #ffdbac;
                transform: scale(1);
                background-image: none;
            }
        }

        .face-eyes {
            display: flex;
            justify-content: space-around;
            width: 60%;
            margin-bottom: 10px;
        }

        .face-eye {
            width: 12px;
            height: 12px;
            background: #333;
            border-radius: 50%;
            transition: all 0.5s;
        }

        /* 优化肿胀时的眼睛效果 - 更逼真的眯眼效果 */
        .character-face.swollen .face-eye {
            width: 6px;
            height: 4px;
            border-radius: 50%;
            background: #333;
            transform: translateY(2px);
            box-shadow: 0 0 3px rgba(255, 0, 0, 0.6);
        }

        /* 优化恢复时的眼睛效果 */
        .character-face.recovering .face-eye {
            animation: eyeRecover 2s ease-in-out forwards;
        }

        @keyframes eyeRecover {
            0% {
                width: 6px;
                height: 4px;
                border-radius: 50%;
                background: #333;
                transform: translateY(2px);
                box-shadow: 0 0 3px rgba(255, 0, 0, 0.6);
            }
            50% {
                width: 9px;
                height: 8px;
                border-radius: 50%;
                background: #333;
                transform: translateY(1px);
                box-shadow: 0 0 2px rgba(255, 0, 0, 0.3);
            }
            100% {
                width: 12px;
                height: 12px;
                border-radius: 50%;
                background: #333;
                transform: translateY(0);
                box-shadow: none;
            }
        }

        .face-mouth {
            width: 30px;
            height: 15px;
            border-bottom: 3px solid #333;
            border-radius: 0 0 30px 30px;
            transition: all 0.5s;
        }

        /* 优化肿胀时的嘴巴效果 - 更扭曲的嘴巴 */
        .character-face.swollen .face-mouth {
            width: 20px;
            height: 10px;
            border-bottom: 3px solid #333;
            border-radius: 0 0 20px 20px;
            transform: rotate(-5deg);
            border-left: 2px solid #333;
            border-right: 2px solid #333;
        }

        /* 优化恢复时的嘴巴效果 */
        .character-face.recovering .face-mouth {
            animation: mouthRecover 2s ease-in-out forwards;
        }

        @keyframes mouthRecover {
            0% {
                width: 20px;
                height: 10px;
                border-bottom: 3px solid #333;
                border-radius: 0 0 20px 20px;
                transform: rotate(-5deg);
                border-left: 2px solid #333;
                border-right: 2px solid #333;
            }
            50% {
                width: 25px;
                height: 12px;
                border-bottom: 3px solid #333;
                border-radius: 0 0 25px 25px;
                transform: rotate(-2deg);
                border-left: 1px solid #333;
                border-right: 1px solid #333;
            }
            100% {
                width: 30px;
                height: 15px;
                border-bottom: 3px solid #333;
                border-radius: 0 0 30px 30px;
                transform: rotate(0deg);
                border-left: none;
                border-right: none;
            }
        }

        /* 添加肿胀时的颤抖效果 */
        .character-face.swollen {
            animation: swell 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55), 
                       shake 0.5s ease-in-out 0.8s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0) scale(1.15); }
            10% { transform: translateX(-2px) scale(1.15); }
            20% { transform: translateX(2px) scale(1.15); }
            30% { transform: translateX(-2px) scale(1.15); }
            40% { transform: translateX(2px) scale(1.15); }
            50% { transform: translateX(-1px) scale(1.15); }
            60% { transform: translateX(1px) scale(1.15); }
            70% { transform: translateX(-1px) scale(1.15); }
            80% { transform: translateX(1px) scale(1.15); }
            90% { transform: translateX(-0.5px) scale(1.15); }
        }

        /* 10086版本特殊弹窗 - 优化消失动画 */
        .special-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 30px 40px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            z-index: 2000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: specialToastAppear 0.5s ease-out;
            max-width: 80%;
            transition: opacity 1.5s ease-out, transform 1.5s ease-out;
            cursor: pointer;
        }

        .special-toast.hiding {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
        }

        @keyframes specialToastAppear {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        /* 音频激活按钮 - 优化移动端体验 */
        .audio-activation-btn {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(90, 103, 216, 0.4);
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(90, 103, 216, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(90, 103, 216, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(90, 103, 216, 0);
            }
        }

        .audio-activation-btn:hover {
            background: #4c51bf;
            transform: scale(1.1);
        }

        .audio-activation-btn:active {
            transform: scale(0.95);
        }

        /* 语音状态指示器 */
        .voice-status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            z-index: 100;
            display: none;
            align-items: center;
            gap: 8px;
        }

        .voice-status-indicator.show {
            display: flex;
        }

        .voice-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4ade80;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* 页面刷新确认弹窗 */
        .refresh-confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 15px;
        }

        .refresh-confirm-modal.active {
            display: flex;
        }

        .refresh-confirm-content {
            background: white;
            border-radius: 18px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            text-align: center;
        }

        .refresh-confirm-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #2d3748;
        }

        .refresh-confirm-text {
            font-size: 15px;
            color: #718096;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .refresh-confirm-actions {
            display: flex;
            gap: 12px;
        }

        .refresh-confirm-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-confirm-btn-primary {
            background: #5a67d8;
            color: white;
        }

        .refresh-confirm-btn-primary:hover {
            background: #4c51bf;
        }

        .refresh-confirm-btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .refresh-confirm-btn-secondary:hover {
            background: #cbd5e0;
        }

        /* 返回主页确认弹窗 */
        .home-confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 15px;
        }

        .home-confirm-modal.active {
            display: flex;
        }

        .home-confirm-content {
            background: white;
            border-radius: 18px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            text-align: center;
        }

        .home-confirm-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #2d3748;
        }

        .home-confirm-text {
            font-size: 15px;
            color: #718096;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .home-confirm-actions {
            display: flex;
            gap: 12px;
        }

        .home-confirm-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .home-confirm-btn-primary {
            background: #5a67d8;
            color: white;
        }

        .home-confirm-btn-primary:hover {
            background: #4c51bf;
        }

        .home-confirm-btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .home-confirm-btn-secondary:hover {
            background: #cbd5e0;
        }

        /* 响应式设计 - 移动端优先 */
        @media (min-width: 768px) {
            /* 平板端样式 */
            .app-container {
                border-radius: 20px;
                height: auto;
                max-height: 95vh;
            }
            
            .exam-selection {
                padding: 30px 20px;
            }
            
            .exam-selection h1 {
                font-size: 28px;
            }
            
            .exam-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .random-selection {
                padding: 30px 20px;
            }
            
            .random-selection h1 {
                font-size: 24px;
            }
            
            .random-exam-list {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .exam-container {
                height: 90vh;
                max-height: 900px;
            }
            
            .header {
                padding: 15px 20px;
            }
            
            .exam-title {
                font-size: 20px;
            }
            
            .content {
                padding: 20px 20px 80px 20px;
            }
            
            .question-text {
                font-size: 18px;
            }
            
            .multiple-main {
                flex-direction: row;
            }
            
            .sound-options {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .result-content {
                padding: 35px;
            }
            
            .result-icon {
                font-size: 60px;
            }
            
            #scorePercentage {
                font-size: 48px;
            }
            
            .settings-content, .answer-card-content {
                padding: 30px;
            }
        }

        @media (min-width: 1024px) {
            /* 桌面端样式 */
            .app-container {
                max-width: 1000px;
            }
            
            .exam-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .random-exam-list {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .sound-options {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        /* 移动端特定优化 */
        @media (max-width: 767px) {
            /* 确保模态框在移动端全屏显示 */
            .modal-content, .password-content, .settings-content, 
            .answer-card-content, .confirm-content, .result-content {
                width: 95%;
                max-width: none;
                margin: 0 auto;
                border-radius: 15px;
            }
            
            /* 优化底部导航栏在移动端的显示 */
            .bottom-navigation {
                padding: 10px 15px;
            }
            
            .nav-btn {
                min-width: 100px;
                padding: 10px 15px;
                font-size: 14px;
            }
            
            /* 优化题目网格在移动端的显示 */
            .question-grid {
                grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
                gap: 6px;
            }
            
            .question-btn {
                font-size: 13px;
            }
            
            /* 选项按钮在移动端更大，更容易点击 */
            .option, .judge-option {
                padding: 18px;
                min-height: 50px;
            }
            
            .option-text, .judge-label {
                font-size: 16px;
            }
            
            /* 多选题选项在移动端优化 */
            .multiple-option-item {
                padding: 15px;
            }
            
            .multiple-option-text {
                font-size: 15px;
            }
            
            /* 排序题选项在移动端优化 */
            .sort-option {
                padding: 15px;
            }
            
            .sort-text {
                font-size: 15px;
            }
            
            /* 设置项在移动端优化 */
            .setting-item {
                padding: 18px 0;
            }
            
            .setting-label {
                font-size: 16px;
            }
            
            /* 按钮在移动端更大，更容易点击 */
            .btn {
                min-height: 48px;
                padding: 12px 20px;
                font-size: 16px;
            }
            
            /* 头部按钮在移动端优化 */
            .header-btn {
                width: 44px;
                height: 44px;
                font-size: 20px;
            }
            
            /* 题目类型标签在移动端优化 */
            .question-type {
                font-size: 14px;
                padding: 6px 14px;
            }
            
            /* 题目文本在移动端优化 */
            .question-text {
                font-size: 16px;
                line-height: 1.6;
            }
            
            /* 答案反馈在移动端优化 */
            .answer-feedback {
                font-size: 14px;
                padding: 12px;
            }
            
            /* 进度条在移动端优化 */
            .progress-text {
                font-size: 12px;
            }
            
            /* 标题在移动端优化 */
            .exam-title {
                font-size: 16px;
            }
            
            /* 筛选标签在移动端优化 */
            .filter-tab {
                font-size: 12px;
                padding: 6px;
            }
            
            /* 结果页面在移动端优化 */
            .result-title {
                font-size: 20px;
            }
            
            #scorePercentage {
                font-size: 36px;
            }
            
            .result-icon {
                font-size: 40px;
            }
            
            /* 历史记录在移动端优化 */
            .history-container h1 {
                font-size: 20px;
            }
            
            .history-record-item {
                padding: 15px;
            }
            
            /* 更新说明弹窗在移动端优化 */
            .update-section h3 {
                font-size: 16px;
            }
            
            .update-section li {
                font-size: 14px;
            }
            
            .security-notice {
                font-size: 13px;
            }
            
            .update-date {
                font-size: 12px;
            }
            
            /* 密码输入在移动端优化 */
            .password-input {
                font-size: 16px;
                padding: 15px;
            }
            
            /* 打乱动画在移动端优化 */
            .shuffle-content {
                padding: 25px;
            }
            
            .shuffle-title {
                font-size: 18px;
            }
            
            .shuffle-text {
                font-size: 14px;
            }
            
            /* 顾老太太打乱设置在移动端优化 */
            .grandma-title {
                font-size: 16px;
            }
            
            .grandma-description {
                font-size: 12px;
            }
            
            .grandma-toggle-label {
                font-size: 14px;
            }
            
            /* 10086版本特殊功能 - 移动端优化 */
            .character-face {
                width: 60px;
                height: 60px;
                top: 60px;
                right: 15px;
            }
            
            .character-face.normal {
                width: 60px;
                height: 60px;
            }
            
            .character-face.swollen {
                width: 85px;
                height: 85px;
            }
            
            .special-toast {
                font-size: 20px;
                padding: 25px 30px;
            }
            
            /* 音频激活按钮在移动端优化 */
            .audio-activation-btn {
                width: 70px;
                height: 70px;
                font-size: 28px;
                bottom: 120px;
            }
            
            /* 语音状态指示器在移动端优化 */
            .voice-status-indicator {
                top: 15px;
                right: 15px;
                padding: 6px 10px;
                font-size: 12px;
            }
        }

        /* 超小屏幕优化 */
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .app-container {
                height: 98vh;
                border-radius: 15px;
            }
            
            .exam-selection, .random-selection, .history-container, .wrong-answer-container {
                padding: 15px 10px;
            }
            
            .exam-selection h1, .random-selection h1, .history-container h1, .wrong-answer-container h1 {
                font-size: 20px;
                margin-bottom: 15px;
            }
            
            .exam-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .random-exam-list {
                grid-template-columns: 1fr;
            }
            
            .exam-card {
                padding: 15px;
            }
            
            .exam-icon {
                font-size: 28px;
            }
            
            .exam-title {
                font-size: 16px;
            }
            
            .exam-description {
                font-size: 13px;
            }
            
            .random-exam-item {
                padding: 12px;
            }
            
            .random-exam-icon {
                font-size: 24px;
            }
            
            .random-exam-title {
                font-size: 14px;
            }
            
            .header {
                padding: 10px;
            }
            
            .header-btn {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .exam-title {
                font-size: 14px;
            }
            
            .content {
                padding: 15px 10px 80px 10px;
            }
            
            .question-text {
                font-size: 15px;
            }
            
            .option, .judge-option {
                padding: 15px;
            }
            
            .option-text, .judge-label {
                font-size: 15px;
            }
            
            .bottom-navigation {
                padding: 8px 10px;
            }
            
            .nav-btn {
                min-width: 90px;
                padding: 8px 12px;
                font-size: 13px;
            }
            
            .nav-icon {
                font-size: 15px;
            }
            
            .nav-text {
                font-size: 13px;
            }
            
            .modal-content, .password-content, .settings-content, 
            .answer-card-content, .confirm-content, .result-content {
                padding: 20px 15px;
                border-radius: 12px;
            }
            
            .result-title {
                font-size: 18px;
            }
            
            #scorePercentage {
                font-size: 32px;
            }
            
            .result-icon {
                font-size: 36px;
            }
            
            .result-row {
                padding: 8px 0;
            }
            
            .result-label, .result-value {
                font-size: 13px;
            }
            
            .result-text {
                font-size: 14px;
            }
            
            .result-evaluation {
                padding: 15px;
                font-size: 14px;
            }
            
            .question-grid {
                grid-template-columns: repeat(auto-fill, minmax(35px, 1fr));
                gap: 5px;
            }
            
            .question-btn {
                font-size: 12px;
            }
            
            .filter-tab {
                font-size: 11px;
                padding: 5px;
            }
            
            .answer-card-title {
                font-size: 18px;
            }
            
            .special-title {
                font-size: 16px;
            }
            
            .special-text {
                font-size: 12px;
            }
            
            .multiple-option-item {
                padding: 12px;
            }
            
            .multiple-option-text {
                font-size: 14px;
            }
            
            .sort-option {
                padding: 12px;
            }
            
            .sort-text {
                font-size: 14px;
            }
            
            .shuffle-content {
                padding: 20px;
            }
            
            .shuffle-title {
                font-size: 16px;
            }
            
            .shuffle-text {
                font-size: 13px;
            }
            
            .grandma-title {
                font-size: 15px;
            }
            
            .grandma-description {
                font-size: 11px;
            }
            
            .grandma-toggle-label {
                font-size: 13px;
            }
            
            .setting-label {
                font-size: 14px;
            }
            
            .shuffle-mode-label {
                font-size: 13px;
            }
            
            .shuffle-mode-description {
                font-size: 12px;
            }
            
            .sound-btn {
                padding: 10px;
            }
            
            .close-settings-btn {
                padding: 10px;
                font-size: 15px;
            }
            
            .password-title {
                font-size: 18px;
            }
            
            .password-input {
                padding: 12px;
            }
            
            .password-btn {
                padding: 10px;
                font-size: 15px;
            }
            
            .update-section h3 {
                font-size: 15px;
            }
            
            .update-section li {
                font-size: 13px;
            }
            
            .security-notice {
                font-size: 13px;
            }
            
            .update-date {
                font-size: 12px;
            }
            
            .history-record-item {
                padding: 12px;
            }
            
            .empty-title {
                font-size: 16px;
            }
            
            .empty-text {
                font-size: 14px;
            }
            
            .btn {
                min-height: 44px;
                padding: 10px 15px;
                font-size: 15px;
            }
            
            .answer-feedback {
                font-size: 13px;
                padding: 10px;
            }
            
            .question-type {
                font-size: 12px;
                padding: 4px 10px;
            }
            
            .dynamic-feedback {
                font-size: 12px;
            }
            
            .progress-text {
                font-size: 11px;
            }
            
            /* 10086版本特殊功能 - 移动端优化 */
            .character-face {
                width: 60px;
                height: 60px;
                top: 60px;
                right: 15px;
            }
            
            .character-face.normal {
                width: 60px;
                height: 60px;
            }
            
            .character-face.swollen {
                width: 85px;
                height: 85px;
            }
            
            .special-toast {
                font-size: 20px;
                padding: 25px 30px;
            }
            
            /* 音频激活按钮在超小屏幕优化 */
            .audio-activation-btn {
                width: 60px;
                height: 60px;
                font-size: 24px;
                bottom: 100px;
            }
            
            /* 语音状态指示器在超小屏幕优化 */
            .voice-status-indicator {
                top: 10px;
                right: 10px;
                padding: 5px 8px;
                font-size: 11px;
            }
        }
        
        /* 添加得分高亮样式 */
        .highlight-score {
            color: #e53e3e;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        /* 修复电脑端显示问题 */
        @media (min-width: 769px) {
            .app-container {
                height: auto;
                min-height: 100vh;
                max-height: none;
                overflow: visible;
            }
            
            .page {
                position: relative;
                height: auto;
                min-height: 100vh;
                overflow: visible;
            }
            
            .page.active {
                display: flex;
            }
            
            .exam-selection, .random-selection, .wrong-answer-container, .history-container {
                overflow: visible;
            }
            
            .content-wrapper {
                height: auto;
                min-height: calc(100vh - 200px);
                overflow: visible;
            }
            
            .bottom-navigation {
                position: relative;
                margin-top: 20px;
                box-shadow: none;
                border-top: 1px solid #e2e8f0;
            }
        }
    </style>
</head>
<body>
    <noscript>
        <div style="text-align:center; padding:50px; font-size:18px; color:#e53e3e;">
            请启用JavaScript以使用此应用。
        </div>
    </noscript>
    
    <div class="app-container">
        <!-- 试卷选择页面 -->
        <div id="examSelectionPage" class="page active">
            <div class="exam-selection">
                <h1>试卷模拟系统</h1>
                
                <!-- 更新说明按钮 -->
                <button class="update-notes-btn" onclick="showUpdateNotes()">
                    <span>📢</span>
                    <span>更新说明</span>
                </button>
                
                <div class="exam-grid">
                    <div class="exam-card" onclick="startExam('exam1')">
                        <div class="exam-icon">📝</div>
                        <div class="exam-content">
                            <div class="exam-title">试卷模拟 1</div>
                            <div class="exam-description">包含单选题、多选题、判断题和排序题的综合测试</div>
                            <div class="exam-footer">
                                <div>题目数量: <span class="exam-question-count">50</span></div>
                                <div class="exam-status available">可用</div>
                            </div>
                        </div>
                    </div>
                    <div class="exam-card" onclick="startExam('exam2')">
                        <div class="exam-icon">📋</div>
                        <div class="exam-content">
                            <div class="exam-title">试卷模拟 2</div>
                            <div class="exam-description">包含单选题、多选题、判断题和排序题的综合测试</div>
                            <div class="exam-footer">
                                <div>题目数量: <span class="exam-question-count">50</span></div>
                                <div class="exam-status available">可用</div>
                            </div>
                        </div>
                    </div>
                    <div class="exam-card" onclick="startExam('exam3')">
                        <div class="exam-icon">📚</div>
                        <div class="exam-content">
                            <div class="exam-title">试卷模拟 3</div>
                            <div class="exam-description">包含单选题、多选题、判断题和排序题的综合测试</div>
                            <div class="exam-footer">
                                <div>题目数量: <span class="exam-question-count">50</span></div>
                                <div class="exam-status available">可用</div>
                            </div>
                        </div>
                    </div>
                    <div class="exam-card" onclick="startExam('exam4')">
                        <div class="exam-icon">📖</div>
                        <div class="exam-content">
                            <div class="exam-title">试卷模拟 4</div>
                            <div class="exam-description">包含单选题、多选题、判断题和排序题的综合测试</div>
                            <div class="exam-footer">
                                <div>题目数量: <span class="exam-question-count">50</span></div>
                                <div class="exam-status available">可用</div>
                            </div>
                        </div>
                    </div>
                    <div class="exam-card" onclick="showRandomSelection()">
                        <div class="exam-icon">🎲</div>
                        <div class="exam-content">
                            <div class="exam-title">随机练习</div>
                            <div class="exam-description">从多个试卷中随机选择题目进行练习，至少选择2个试卷</div>
                            <div class="exam-footer">
                                <div>最少选择: <span class="exam-question-count">2</span>个试卷</div>
                                <div class="exam-status available">可用</div>
                            </div>
                        </div>
                    </div>
                    <div class="exam-card" onclick="showHistoryRecords()">
                        <div class="exam-icon">📊</div>
                        <div class="exam-content">
                            <div class="exam-title">历史记录</div>
                            <div class="exam-description">查看您在题目练习中的分数情况和历史成绩</div>
                            <div class="exam-footer">
                                <div>记录数量: <span class="exam-question-count" id="historyCount">0</span></div>
                                <div class="exam-status available">可用</div>
                            </div>
                        </div>
                    </div>
                    <div class="exam-card" onclick="showWrongAnswers()" id="wrongAnswerCard">
                        <div class="exam-icon">❌</div>
                        <div class="exam-content">
                            <div class="exam-title">错题记录</div>
                            <div class="exam-description">查看您答错的题目，支持一键选择错题重新作答</div>
                            <div class="exam-footer">
                                <div>错题数量: <span class="exam-question-count" id="wrongAnswerCount">0</span></div>
                                <div class="exam-status available">可用</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 随机练习选择页面 -->
        <div id="randomSelectionPage" class="page">
            <div class="random-selection">
                <h1>随机练习</h1>
                <div class="random-description">
                    从以下有题目的试卷中选择<strong>2个或更多</strong>，系统将按照以下规则生成一份新的练习试卷：<br>
                    <strong>单选题：20道</strong> | <strong>多选题：5道</strong> | <strong>判断题：20道</strong> | <strong>排序题：5道</strong><br>
                    总共50道题目，保持题型分类，不打乱题型顺序。
                </div>
                
                <div class="random-exam-list" id="randomExamList">
                    <!-- 动态生成可选择的试卷 -->
                </div>
                
                <div class="random-selection-info" id="randomSelectionInfo">
                    <h3>已选择试卷</h3>
                    <p id="selectedExamsText">请至少选择2个试卷</p>
                </div>
                
                <div class="random-actions">
                    <button class="btn btn-secondary" onclick="backToExamSelection()">返回</button>
                    <button class="btn btn-primary" id="startRandomBtn" onclick="startRandomPractice()" disabled>开始随机练习</button>
                </div>
            </div>
        </div>

        <!-- 错题记录页面 -->
        <div id="wrongAnswerPage" class="page">
            <div class="wrong-answer-container">
                <h1>错题记录</h1>
                <div class="wrong-answer-list" id="wrongAnswerList">
                    <!-- 错题记录将在这里动态生成 -->
                </div>
                <div class="wrong-answer-actions">
                    <button class="btn btn-secondary" onclick="backToExamSelection()">返回</button>
                    <button class="btn btn-danger" onclick="clearWrongAnswers()">清空错题</button>
                    <button class="btn btn-primary" id="retryWrongBtn" onclick="retryWrongAnswers()" disabled>重做错题</button>
                </div>
            </div>
        </div>

        <!-- 答题页面 -->
        <div id="examPage" class="page">
            <div class="exam-container">
                <div class="header">
                    <div class="header-top">
                        <div class="header-btn" onclick="confirmBackToHome()" title="返回首页">🏠</div>
                        <div class="header-btn" onclick="openSettings()">⚙️</div>
                        <div class="header-btn" onclick="openAnswerCard()">📋</div>
                        <div class="header-btn" id="shuffleBtn" onclick="toggleShuffle()" title="一键打乱">🔀</div>
                    </div>
                    <h1 id="examTitle">操作试卷模拟1</h1>
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-text" id="progressText">第 1 题 / 共 50 题</div>
                </div>

                <!-- 10086版本特殊功能 - 人物脸部状态 -->
                <div id="characterFace" class="character-face normal">
                    <div class="face-eyes">
                        <div class="face-eye"></div>
                        <div class="face-eye"></div>
                    </div>
                    <div class="face-mouth"></div>
                </div>

                <div class="content-wrapper">
                    <div class="content">
                        <div class="question-type" id="questionType">单选题</div>
                        <div class="question-number">
                            <span id="questionNumber">第 1 题</span>
                            <span class="dynamic-feedback" id="dynamicFeedback">正确答案：<span class="correct-option">答题后显示</span></span>
                        </div>
                        <div class="question-text" id="questionText"></div>
                        <div class="options" id="optionsContainer"></div>
                        <div class="answer-feedback" id="answerFeedback"></div>
                    </div>
                </div>
            </div>
            
            <!-- 底部固定导航栏 -->
            <div class="bottom-navigation">
                <div class="nav-buttons">
                    <button class="nav-btn nav-btn-secondary" id="prevBtn" onclick="previousQuestion()">
                        <span class="nav-icon">←</span>
                        <span class="nav-text">上一题</span>
                    </button>
                    <button class="nav-btn nav-btn-primary" id="nextBtn" onclick="nextQuestion()">
                        <span class="nav-text">下一题</span>
                        <span class="nav-icon">→</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 历史记录页面 -->
        <div id="historyPage" class="page">
            <div class="history-container">
                <h1>历史记录</h1>
                <div class="history-list" id="historyList">
                    <!-- 历史记录将在这里动态生成 -->
                </div>
                <div class="history-actions">
                    <button class="btn btn-secondary" onclick="backToExamSelection()">返回</button>
                    <button class="btn btn-danger" onclick="clearHistoryRecords()">清空记录</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 更新说明弹窗 -->
    <div id="updateNotesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <span>📢</span>
                    <span>更新说明</span>
                </div>
                <button class="close-modal-btn" onclick="hideUpdateNotes()">×</button>
            </div>
            <div class="update-notes">
                <div class="update-section">
                    <h3>新增功能</h3>
                    <ul>
                        <li>完成所有题目作答后，系统将自动弹出弹窗，显示考试分数以及是否及格的信息</li>
                        <li>新增历史记录功能，可用于查看在题目练习中的分数情况</li>
                        <li>在主页添加了更新说明板块，清晰展示系统的新增内容和优化事项</li>
                        <li>为部分版本增加了智能分组打乱功能的开关按钮</li>
                        <li>为排序题添加了"提交答案"按钮，支持用户在不小心选错选项的情况下进行删除操作</li>
                        <li>为特殊版本添加了"你还活着干嘛"语音播报开关功能</li>
                        <li>新增错题记录功能，用户可以查看做错的题目，支持一键选择错题并重新作答</li>
                        <li>新增页面刷新保护机制，防止意外刷新导致答题进度丢失</li>
                        <li>优化错题重做评分系统，根据实际答题情况动态计算及格线</li>
                        <li>优化数据持久化机制，确保历史记录和错题记录在浏览器关闭后重新打开时仍然存在</li>
                        <li>新增满分徽章显示，当考生全部答对时，弹窗将显示"满分"徽章</li>
                    </ul>
                </div>
                <div class="update-section">
                    <h3>优化事项</h3>
                    <ul>
                        <li>针对所有排序题，若排序出现错误，则不允许再次修改，且无需给出"顺序有误，请调整"之类的提醒，即一旦出错便不可再修改</li>
                        <li>删除了"提交答案"按钮，简化了底部导航栏</li>
                        <li>修复了部分版本下打乱方式没有开关按钮的问题</li>
                        <li>优化了特殊版本下打乱开关动画的显示层级</li>
                        <li>提高了打乱动画弹窗的z-index值，确保显示在设置界面的最上层</li>
                        <li>优化历史记录页面返回按钮交互，解决点击返回后页面元素占位异常、空间占用过大问题</li>
                        <li>修复返回主页时出现空白页面的问题，确保页面切换流畅且布局正确</li>
                        <li>修复未输入密码点击取消按钮返回主页时显示异常的问题</li>
                        <li>优化更新说明展示方式，改为悬浮弹窗形式，节省页面空间</li>
                        <li><strong>【核心修复】</strong>修复了点击"取消"返回主页后，再次点击"获取题目"导致页面呈现空白的关键问题。优化了页面状态管理与重置逻辑，确保考试流程可以正常、重复地启动。</li>
                        <li><strong>【排序题优化】</strong>优化了排序题交互逻辑，添加了"提交答案"按钮，允许用户在提交前修改已选选项，提交后锁定答案，确保答题结果以首次提交为准。</li>
                        <li><strong>【语音播报优化】</strong>优化了特殊版本中"你还活着干嘛"语音播报功能，添加了开关控制，默认关闭状态，仅在连续答对5道题时触发恢复动画优化。</li>
                        <li><strong>【移动端语音优化】</strong>解决了特殊版本在手机端出现的"你还活着干嘛"语音播放无声音的问题，增加了多种音频激活机制，确保语音功能在移动端正常工作。</li>
                        <li><strong>【数据持久化优化】</strong>修复了历史记录和错题记录在浏览器关闭后丢失的问题，确保数据正确保存到localStorage。</li>
                    </ul>
                </div>
                <div class="security-notice">
                    <strong>安全提示：</strong>本系统访问密码属于敏感信息，请严格保密，不要在公开场合或非授权情况下分享。
                </div>
                <div class="update-date">更新日期：2025年10月15日</div>
            </div>
        </div>
    </div>

    <!-- 加载动画 -->
    <div id="loadingContainer" class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">正在获取题目...</div>
        <div class="loading-subtext">请稍候，系统正在为您准备试卷</div>
    </div>

    <!-- 密码输入弹窗 -->
    <div id="passwordModal" class="modal">
        <div class="password-content">
            <div class="password-title">请输入访问密码</div>
            <input type="password" class="password-input" id="passwordInput" placeholder="请输入密码" maxlength="11">
            <div class="password-error" id="passwordError">密码错误，请重新输入</div>
            <div class="password-actions">
                <button class="password-btn password-btn-primary" onclick="verifyPassword()">确认</button>
                <button class="password-btn password-btn-secondary" onclick="cancelPassword()">取消</button>
            </div>
        </div>
    </div>

    <!-- 打乱动画弹窗 -->
    <div id="shuffleModal" class="modal" style="z-index: 9999;">
        <div class="shuffle-content">
            <div class="shuffle-icon-large" id="shuffleIcon">🔄</div>
            <div class="shuffle-title" id="shuffleTitle">正在打乱题目顺序...</div>
            <div class="shuffle-text" id="shuffleText">请稍候，系统正在为您打乱题目顺序</div>
            <div class="shuffle-progress">
                <div class="shuffle-progress-bar"></div>
            </div>
            <div class="shuffle-dots">
                <div class="shuffle-dot"></div>
                <div class="shuffle-dot"></div>
                <div class="shuffle-dot"></div>
            </div>
        </div>
    </div>

    <!-- 顾老太太打乱方式选择弹窗 -->
    <div id="grandmaShuffleModeModal" class="modal" style="z-index: 1001;">
        <div class="shuffle-content">
            <div class="shuffle-icon-large">👵</div>
            <div class="shuffle-title">选择打乱方式</div>
            <div class="shuffle-text">请选择您想要的题目打乱方式</div>
            <div class="shuffle-mode-selector">
                <div class="shuffle-mode-option" onclick="selectGrandmaShuffleMode('full')">
                    <div class="shuffle-mode-radio"></div>
                    <div>
                        <div class="shuffle-mode-label">全部打乱</div>
                        <div class="shuffle-mode-description">将所有题目随机打乱顺序</div>
                    </div>
                </div>
                <div class="shuffle-mode-option" onclick="selectGrandmaShuffleMode('group')">
                    <div class="shuffle-mode-radio"></div>
                    <div>
                        <div class="shuffle-mode-label">智能分组打乱</div>
                        <div class="shuffle-mode-description">按题型分组，在组内打乱顺序</div>
                    </div>
                </div>
            </div>
            <div class="shuffle-actions">
                <button class="btn btn-secondary" onclick="cancelGrandmaShuffle()">取消</button>
            </div>
        </div>
    </div>

    <!-- 一键打乱方式选择弹窗 -->
    <div id="shuffleModeModal" class="modal" style="z-index: 1001;">
        <div class="shuffle-content">
            <div class="shuffle-icon-large">🔀</div>
            <div class="shuffle-title">选择打乱方式</div>
            <div class="shuffle-text">请选择您想要的题目打乱方式</div>
            <div class="shuffle-mode-selector">
                <div class="shuffle-mode-option" onclick="selectShuffleMode('full')">
                    <div class="shuffle-mode-radio"></div>
                    <div>
                        <div class="shuffle-mode-label">全部打乱</div>
                        <div class="shuffle-mode-description">将所有题目随机打乱顺序</div>
                    </div>
                </div>
                <div class="shuffle-mode-option" onclick="selectShuffleMode('group')">
                    <div class="shuffle-mode-radio"></div>
                    <div>
                        <div class="shuffle-mode-label">智能分组打乱</div>
                        <div class="shuffle-mode-description">按题型分组，在组内打乱顺序</div>
                    </div>
                </div>
            </div>
            <div class="shuffle-actions">
                <button class="btn btn-secondary" onclick="cancelShuffleMode()">取消</button>
            </div>
        </div>
    </div>

    <!-- 设置模态框 -->
    <div id="settingsModal" class="modal">
        <div class="settings-content">
            <div class="settings-title">设置</div>
             
            <!-- 顾老太太打乱设置区域 -->
            <div id="grandmaShuffleSection" class="grandma-shuffle-section" style="display: none;">
                <div class="grandma-shuffle-header">
                    <div class="grandma-icon">👵</div>
                    <div class="grandma-title">顾老太太打乱</div>
                </div>
                <div class="grandma-description">
                    顾老太太正在为您打乱题目顺序，让您的学习体验更加有趣！
                </div>
                <div class="grandma-toggle-container">
                    <div class="grandma-toggle-label">开启顾老太太打乱</div>
                    <div class="grandma-toggle" id="grandmaShuffleToggle" onclick="toggleGrandmaShuffle()">
                        <div class="grandma-toggle-slider"></div>
                    </div>
                </div>
                <div class="grandma-status" id="grandmaShuffleStatus">
                    当前状态：已关闭
                </div>
            </div>
            
            <!-- 10086版本特殊功能 - 答错语音播报设置 -->
            <div id="specialToastSection" class="setting-item" style="display: none;">
                <div class="setting-label">答错语音播报</div>
                <div class="toggle-switch" id="specialToastToggle" onclick="toggleSpecialToast()">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            
            <!-- 答题自动下一题设置 -->
            <div class="setting-item">
                <div class="setting-label">答题自动下一题</div>
                <div class="toggle-switch" id="autoNextToggle" onclick="toggleAutoNext()">
                    <div class="toggle-slider"></div>
                </div>
            </div>
             
            <div class="setting-item" id="shuffleSettingItem">
                <div class="setting-label" id="shuffleLabel">一键打乱</div>
                <div class="toggle-switch" id="shuffleToggle" onclick="toggleShuffleFromSettings()">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            
            <div class="setting-item">
                <div class="setting-label">答题音效</div>
            </div>
             
            <div class="sound-options" id="soundOptions">
                <!-- 音效选项将通过JavaScript动态生成 -->
            </div>
             
            <button class="close-settings-btn" onclick="closeSettings()">确定</button>
        </div>
    </div>

    <!-- 答题卡模态框 -->
    <div id="answerCardModal" class="modal">
        <div class="answer-card-content">
            <div class="answer-card-title">答题卡</div>
             
            <div class="filter-tabs">
                <div class="filter-tab active" onclick="filterQuestions('all')">全部</div>
                <div class="filter-tab" onclick="filterQuestions('unanswered')">未作答</div>
                <div class="filter-tab" onclick="filterQuestions('correct')">答对</div>
                <div class="filter-tab" onclick="filterQuestions('incorrect')">答错</div>
            </div>
             
            <!-- 特殊状态提示区域 -->
            <div id="specialStatusArea"></div>
             
            <div class="question-grid" id="questionGrid"></div>
             
            <div class="answer-card-actions">
                <button class="btn btn-danger" onclick="showClearConfirm()">清空记录</button>
                <button class="btn btn-primary" onclick="viewResults()">查看结果</button>
                <button class="btn btn-secondary" onclick="closeAnswerCard()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 清空确认弹窗 -->
    <div id="confirmModal" class="modal">
        <div class="confirm-content">
            <div class="confirm-title">确认清空</div>
            <div class="confirm-text">确定要清空所有答题记录吗？此操作不可撤销。</div>
            <div class="confirm-actions">
                <button class="btn btn-secondary" onclick="hideClearConfirm()">取消</button>
                <button class="btn btn-danger" onclick="clearRecords()">确定清空</button>
            </div>
        </div>
    </div>

    <div id="resultModal" class="modal">
        <div class="result-content">
            <div class="result-icon" id="resultIcon">🎉</div>
            <div class="result-title" id="resultTitle">答题完成！</div>
            <div class="result-score" id="resultScore">
                <span id="scorePercentage">0%</span>
                <span class="result-badge" id="scoreBadge">待评定</span>
            </div>
            <div class="result-details" id="resultDetails">
                <div class="result-row">
                    <div class="result-label">选择题</div>
                    <div class="result-value" id="singleScore">0分/40分</div>
                </div>
                <div class="result-row">
                    <div class="result-label">多选题</div>
                    <div class="result-value" id="multipleScore">0分/15分</div>
                </div>
                <div class="result-row">
                    <div class="result-label">判断题</div>
                    <div class="result-value" id="judgeScore">0分/20分</div>
                </div>
                <div class="result-row">
                    <div class="result-label">排序题</div>
                    <div class="result-value" id="sortScore">0分/15分</div>
                </div>
                <div class="result-row">
                    <div class="result-label">总分</div>
                    <div class="result-value" id="totalScore">0分/90分</div>
                </div>
            </div>
            <div class="result-text" id="resultText">您答对了 0 道题，共 50 道题</div>
            <div class="result-evaluation" id="resultEvaluation">
                <!-- 评价内容将通过JavaScript动态生成 -->
            </div>
            <button class="close-btn" onclick="closeModal()">确定</button>
        </div>
    </div>

    <!-- 10086版本特殊弹窗 -->
    <div id="specialToast" class="special-toast" style="display: none;">
        你还活着干嘛
    </div>

    <!-- 音频激活按钮 - 10086版本专用 -->
    <button id="audioActivationBtn" class="audio-activation-btn" style="display: none;" onclick="activateAudio()">
        🔊
    </button>

    <!-- 语音状态指示器 -->
    <div id="voiceStatusIndicator" class="voice-status-indicator">
        <div class="voice-status-dot"></div>
        <span>正在播放语音</span>
    </div>

    <!-- 页面刷新确认弹窗 -->
    <div id="refreshConfirmModal" class="refresh-confirm-modal">
        <div class="refresh-confirm-content">
            <div class="refresh-confirm-title">确认离开？</div>
            <div class="refresh-confirm-text">您的试卷题目尚未完成，是否提交试卷？</div>
            <div class="refresh-confirm-actions">
                <button class="refresh-confirm-btn refresh-confirm-btn-primary" onclick="submitAndRefresh()">提交试卷</button>
                <button class="refresh-confirm-btn refresh-confirm-btn-secondary" onclick="cancelRefresh()">取消</button>
            </div>
        </div>
    </div>

    <!-- 返回主页确认弹窗 -->
    <div id="homeConfirmModal" class="home-confirm-modal">
        <div class="home-confirm-content">
            <div class="home-confirm-title">确认返回主页？</div>
            <div class="home-confirm-text">您已开始答题，返回主页将提交当前试卷并显示成绩。是否确认返回？</div>
            <div class="home-confirm-actions">
                <button class="home-confirm-btn home-confirm-btn-primary" onclick="submitAndGoHome()">提交并返回</button>
                <button class="home-confirm-btn home-confirm-btn-secondary" onclick="cancelGoHome()">取消</button>
            </div>
        </div>
    </div>

    <script>
        // 应用状态管理
        const AppState = {
            currentPage: 'examSelection',
            currentExam: null,
            questions: [],
            currentQuestion: 0,
            userAnswers: [],
            isAnswered: [],
            sortSubmitted: [],
            sortSelectedItems: [],
            multipleSelectedItems: [],
            previousQuestionType: '',
            autoNextEnabled: false,
            soundType: 'correct',
            currentFilter: 'all',
            multipleStartTime: null,
            soundLoaded: {
                'correct': false,
                'incorrect': false
            },
            isPreviewing: false,
            isShuffled: false,
            originalIndices: [],
            shuffleMode: 'full',
            isSpecialVersion: false,
            passwordAttempts: 0,
            selectedRandomExams: [],
            historyRecords: [],
            wrongAnswers: [], // 新增：错题记录
            audioContext: null,
            correctSound: null,
            incorrectSound: null,
            lastShuffleMode: 'full',
            grandmaShuffleEnabled: false,
            grandmaShuffleMode: 'full',
            // 10086版本特殊功能
            correctCountInSpecialVersion: 0,
            specialToastAudio: null,
            specialToastTimeout: null,
            specialToastActive: false,
            // 优化：添加连续答对计数器
            consecutiveCorrectCount: 0,
            lastAnswerCorrect: false,
            isRecovering: false,
            // 10086版本语音播报开关
            specialToastEnabled: false,
            // 音频激活状态
            audioActivated: false,
            // 语音合成状态
            speechSynthesisSupported: false,
            // 音频初始化状态
            audioInitialized: false,
            // 全局点击监听器是否已添加
            globalClickListenerAdded: false,
            // 移动端音频激活标志
            mobileAudioActivated: false,
            // 语音播放重试次数
            speechRetryCount: 0,
            // 最大重试次数
            maxSpeechRetry: 3,
            // 页面刷新保护
            refreshProtectionEnabled: false
        };

        // 试卷数据
        const examData = {
            exam1: {
                title: '试卷模拟1',
                questions: [
                    // 单选题
                    {
                        type: 'single',
                        question: '信息经济学将商品进行了分类，消费者在购买时就能确定或评价其质量的商品称为',
                        options: ['经验性商品', '可量化性商品', '可鉴别商品', '感官性商品'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '可以制作网页动画的软件是',
                        options: ['Fireworks', 'Dreamweaver', 'Flash', 'Photoshop'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '（ ）可以把浏览者从一个网页带到另一个网页，或者从网页的某一个部分引导到另一个部分。',
                        options: ['超文本', '主页', '超级链接', '网页'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '商品发布在（ ）最合适。',
                        options: ['早上 8:00', '上午 10:00', '下午 3:00', '晚上 12:00'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '商家 FAQ 中经常设置的内容不包括',
                        options: ['商品的价格问题', '网购的质量问题', '网购的支付问题', '网购的选品问题'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '下列不属于新建文件背景内容的是',
                        options: ['前景色', '背景色', '白色', '透明'],
                        answer: 'A'
                    },
                    {
                        type: 'single',
                        question: '下列不属于沟通礼仪作用的是',
                        options: ['沟通礼仪是留下良好第一印象的关键', '沟通礼仪是取得客户信任的前提', '沟通礼仪是电商客服必须要掌握的技能和知识', '沟通礼仪有助于解决纠纷交易'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '关于宝贝详情页设计与制作的说法，正确的是（ ）。',
                        options: ['作为网页设计师一定要用图说话，因而宝贝详情页的设计与制作都要做成图片形式。', '多媒体元素在详情页中的作用是非常显著的，页面设计时最好使用大量的多媒体元素，以增加详情页的美化效果。', '商品类比的设计与排版方式比较适合挖掘本商品与其他商品的不同，从而展示商品的优势。', '为了增强买家对商品的信任感，网页中可放入大量的评价截图并配以"最好"等字样的描述文案。'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: 'CSS 的中文名称为',
                        options: ['层叠样式', '层次样式', '层叠样式表', '层次样式表'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '类样式可以引用（ ）次。',
                        options: ['1', '2', '3', '多'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '下列属于吸光体的商品是',
                        options: ['玻璃', '橡胶', '银器', '红酒'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '一般商品应该有（ ）张主图和（ ）张辅图。',
                        options: ['1, 2', '1, 3', '1, 4', '1, 5'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '淘宝店招模块中高度一般为（ ）像素。',
                        options: ['90', '100', '120', '150'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '可以作为大大特价活动图片上传的文件大小是（ ）。',
                        options: ['1.2 MB', '1 GB', '700 KB', '3 MB'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '店铺钻石展位出价 10 元，系统底价为 3 元，则（ ）最佳。',
                        options: ['通投出价 5 元，定向溢价 5 元', '通投出价 7 元，定向溢价 3 元', '通投出价 0元，定向溢价 10 元', '通投出价 3 元，定向溢价 7 元'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '预览网页的快捷键是',
                        options: ['F1', 'F5', 'F11', 'F12'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '（ ）选框工具，可以选出一个像素高与图像等宽的选区。',
                        options: ['单列', '单行', '椭圆', '矩形'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: 'AP DIV 设置单位是',
                        options: ['px', 'cm', 'em', 'm'],
                        answer: 'A'
                    },
                    {
                        type: 'single',
                        question: '下列关于 BBS 的说法，不正确的是',
                        options: ['利用 BBS 收集资料主要是地过目建的 BBS 网站了解情况', 'BBS 即电子公告牌系统，是互联网上出现较早的网上交流方式', 'BBS 是一种重要的网络营销工具', 'BBS 只能用于学术交流，不能用于商业目的'],
                        answer: 'A'
                    },
                    {
                        type: 'single',
                        question: '选择"椭圆工具"按住（ ）键，可以绘制出正圆形。',
                        options: ['Shift', 'Ctrl', 'Alt', 'Enter'],
                        answer: 'A'
                    },
                    // 多选题
                    {
                        type: 'multiple',
                        question: 'float 常用属性为',
                        options: ['Left', 'Right', 'None', 'Font'],
                        answer: ['A', 'B', 'C'],
                        explanation: 'CSS的float属性用于控制元素的浮动方式，常用属性值包括：Left（向左浮动）、Right（向右浮动）、None（不浮动）。'
                    },
                    {
                        type: 'multiple',
                        question: '详情页文案设计的两个基本点为',
                        options: ['把所有的客户都当成专业人士', '把所有的客户都当成非专业人士', '寻找产品的促销点而非价值点', '寻找产品的价值点而非促销点'],
                        answer: ['B', 'D'],
                        explanation: '详情页文案设计应该将所有客户视为非专业人士，使用简单易懂的语言；同时应该突出产品的价值点而非单纯的促销点。'
                    },
                    {
                        type: 'multiple',
                        question: '下列关于客户咨询礼貌用语中欢迎语的说法，正确的有',
                        options: ['欢迎语可以包含欢迎内容和自我介绍，也可以突出店铺活动', '如果无法及时应答客户，则需要做好解释与安抚工作', '客户第一次来店咨询时，客服需要快速响应，在1分钟内做出反馈，不要让客户长时间等待', '"亲，您好，请问有什么可以帮到您？本店正在举行周年庆促销活动，即日起，本店任意购买两件即可包邮哦！"这是欢迎语'],
                        answer: ['A', 'B', 'D'],
                        explanation: '欢迎语可以包含欢迎内容、自我介绍和店铺活动信息；无法及时响应时需要做好解释安抚；但选项C中提到的"1分钟内做出响应"不是必须的，实际中应尽可能快速响应。'
                    },
                    {
                        type: 'multiple',
                        question: '模板中可定义的模板区域类型有',
                        options: ['可编辑区域', '重复区域', '可选区域', '锁定区域'],
                        answer: ['A', 'B', 'C'],
                        explanation: '在模板中，可以定义的区域类型包括：可编辑区域（允许编辑内容）、重复区域（可重复使用的区域）、可选区域（可选择显示或隐藏的区域）。锁定区域不是模板区域的标准类型。'
                    },
                    {
                        type: 'multiple',
                        question: '下列关于宝贝主图描述，正确的是（）',
                        options: ['无Logo、无水印、无拼接、无牛皮癣，最好将素材抠图、边缘处理干净', '图片中不可以出现模特，必须是挂拍或平铺，不可出现衣架、商品吊牌等', '商品需正面展现，不可侧面或背面展现', '每张图片可以出现多个主体'],
                        answer: ['A', 'B', 'C'],
                        explanation: '宝贝主图要求无水印无拼接，正面展现，不出现多余元素，每张图片应突出单一主体。'
                    },
                    // 判断题
                    {
                        type: 'judge',
                        question: '模板文件中不能再嵌入模板。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: 'PC 端很多时候用深色系来体现店铺的风格，而移动端浏览由于尺寸小，因此颜色鲜亮，以便让消费者浏览得舒适。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '对角线构图可以使画面产生活力，使物体产生动感，易于突出表现商品的造型与色彩。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '转载量是指所有转载量中保留版权链接的转载所占的比例。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '根据淘宝支付宝的规定，快递发货 10 天后，如果买家没有主动确认收货，也没有提出退货或退款申请，那么，支付宝会默认买家已收到货，并将货款打给卖家。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '赠品遗失或者破损需做相应价处理即可，不会影响商品退款。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '客户不喜欢或者客户的其他原因退换货，客户应该承担寄回运费。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '淘宝店铺的店招图片不可以在线制作。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '一篇文章的色彩搭配不要超过 3 种颜色。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '快递就是物流。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '一个身份证只能开一家店，开店后无法注销。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '为了衬托帖子的气氛和人气，可以适当找托顶一下。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '详情页前两屏决定客户是否想购买商品。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '图片属于多媒体元素。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '文本域和文本区域在网页提交类表单中经常被用到，其实是一样的元素，没有本质上的区别。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '淘金币招商活动的报名要求只能报一款商品。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '用"钢笔工具"绘制的矢量图形称为路径，又称为赛贝尔曲线。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '光圈越小，光圈值越大，进光量越少。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '二维码生成器的工作原理是将所需的信息输入二维码生成器中，生成相对应二维码，然后进行保存。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '密码输入框用于采集用户账号信息。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    // 排序题
                    {
                        type: 'sort',
                        question: '注册微信公众号的步骤为',
                        options: ['选择注册的账号类型', '选择公众号类型', '登录注册界面', '选择注册订阅号的主体类型', '填写邮箱、密码等基本信息', '输入邮箱验证码', '填写公众号信息'],
                        answer: ['C', 'A', 'E', 'F', 'B', 'D', 'G']
                    },
                    {
                        type: 'sort',
                        question: '进行搜索引擎营销的基本操作步骤为',
                        options: ['选择投放服务商', '选择投放策略', '撰写关键词创意', '选择投放设备及时间'],
                        answer: ['C', 'A', 'D', 'B']
                    },
                    {
                        type: 'sort',
                        question: '设置图片强调效果的操作步骤是',
                        options: ['添加行为效果', '表格布局', '保存并预览'],
                        answer: ['B', 'A', 'C']
                    },
                    {
                        type: 'sort',
                        question: '一件商品从生产厂家到消费者手中，要经过很多环节，其基本流程为',
                        options: ['零售商', '地方批发商', '全国批发商', '原料供应商', '消费者', '终端批发商', '生产厂家'],
                        answer: ['D', 'G', 'C', 'B', 'F', 'A', 'E']
                    },
                    {
                        type: 'sort',
                        question: '使用"修补工具"清除图片中商品污点的步骤为',
                        options: ['选择"修补工具"，设置工具选项栏上的修补方式为"源"，选区为新选区', '松开鼠标，选区中的污点区域被干净区域所修补', '按Ctrl + D快捷键，取消选区', '在图像窗口中拖曳鼠标圈选污点区域，生成选区', '启动Photoshop软件，按Ctrl+O快捷键，打开需要处理的图片', '选中选区并按住鼠标不放，将选区拖曳到其他干净的区域'],
                        answer: ['E', 'A', 'D', 'F', 'B', 'C']
                    }
                ]
            },
            exam2: {
                title: '试卷模拟2',
                questions: [
                    // 单选题
                    {
                        type: 'single',
                        question: '（）对商品的功能、特点进行详尽、透彻地分析和解说，是商品的特色呈现所在，通过该模块能够让消费者对商品产生兴趣。',
                        options: ['详情页海报', '商品信息模块', '商品卖点模块', '商品展示模块'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '未付款的订单要在（）内催款。',
                        options: ['24小时', '48小时', '72小时', '当天'],
                        answer: 'A'
                    },
                    {
                        type: 'single',
                        question: 'photoshop中RGB色彩模式的B表示（）',
                        options: ['饱和度', '色相', '亮度', '蓝色'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '以下哪项不属于表单？（）',
                        options: ['文件域', '按钮', '复选框', '表格'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '站点导出文件的扩展名是（）',
                        options: ['html', 'dwt', 'css', 'ste'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '注册淘宝用户的会员名的字符范围是多少（）',
                        options: ['5 - 20', '6 - 16', '3 - 18', '5 - 18'],
                        answer: 'A'
                    },
                    {
                        type: 'single',
                        question: '下列属于主关键词的是（）',
                        options: ['夏装宽松', '"618"大促包邮', '代购休闲运动鞋', 'T恤'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '如进入页面之后"立即报名"按钮呈（）说明您符合所有招商资质要求，可立即报名。',
                        options: ['灰色', '黄色', '红色', '绿色'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '一位年轻的妈妈给孩子选商品，客服应站在母亲的立场，考虑孩子的需要，用比较成熟的语气来表述。这体现的沟通技巧是（）',
                        options: ['坚守诚信', '处处为客户着想，用诚心打动客户', '多虚心请教，多倾听客户声音', '保持相同的谈话方式'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '交易状态为"（）"时，可以操作关闭订单交易。',
                        options: ['等待买家付款', '买家已经付款', '等待发货', '卖家已发货'],
                        answer: 'A'
                    },
                    {
                        type: 'single',
                        question: '隐藏域名（）是指在百度注册的名字。',
                        options: ['CL', 'CT', 'SI', 'TN'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '（）给人以庄重、严谨的感觉，多用来表现有垂直线条或外观修长的商品。',
                        options: ['竖式构图', '对角线构图', '对称式构图', '三分法构图'],
                        answer: 'A'
                    },
                    {
                        type: 'single',
                        question: '移动端电商网站详情页设计规格：宽度为（）px。',
                        options: ['320 - 480', '360 - 560', '480 - 620', '650 - 768'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '下列不会导致关键词没有展现量的是（）',
                        options: ['标题中不包含这个关键词', '关键词出价太低', '关键词太长且生僻', '关键词质量得分很低'],
                        answer: 'A'
                    },
                    {
                        type: 'single',
                        question: '衡量访客是否流失的一个很重要的指标是（）',
                        options: ['访客数', '有效入店人数', '访客跳失人数', '成交人数'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '执行"选择"→"取消选择"命令或按（）组合键，可以取消选区状态。',
                        options: ['Ctrl + V', 'Ctrl + D', 'Ctrl + M', 'Ctrl + T'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '下列不属于减淡工具组的工具是（）',
                        options: ['锐化工具', '加深工具', '海绵工具', '减淡工具'],
                        answer: 'A'
                    },
                    {
                        type: 'single',
                        question: '常见的网络视频文件有RM、MOV、ASF和（）',
                        options: ['MP3', 'AVI', 'FLV', 'MPEG'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '淘宝页面的通栏尺寸是（）',
                        options: ['980', '950', '960', '1024'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '（）是网站持有方信息的链接集群',
                        options: ['网站栏目导航', '网站持有方信息导航', '产品分类导航', '当前位置导航'],
                        answer: 'B'
                    },
                    // 多选题
                    {
                        type: 'multiple',
                        question: '"移动工具"属性中分布图层的功能可以把所有选择的图层按（）分布。',
                        options: ['按顶', '垂直居中', '按左', '水平居中'],
                        answer: ['A', 'B', 'C', 'D'],
                        explanation: '移动工具的分布功能可以按顶、垂直居中、按左、水平居中等多种方式分布图层。'
                    },
                    {
                        type: 'multiple',
                        question: '超链接按照连接路径的不同，可以分为（）',
                        options: ['外部链接', '内部链接', '空链接', '锚点链接'],
                        answer: ['A', 'B', 'D'],
                        explanation: '超链接按路径分为外部链接、内部链接、锚点链接，空链接不是按路径分类的。'
                    },
                    {
                        type: 'multiple',
                        question: '淘宝网中查找关键词的方法有（）',
                        options: ['利用淘宝首页搜索下拉框', '查看"您是不是想找"', '查看竞争对手的关键词', '使用"生意参谋"里面的"选词助手"'],
                        answer: ['A', 'B', 'C', 'D'],
                        explanation: '淘宝网查找关键词的方法包括搜索下拉框、相关搜索提示、竞品分析和生意参谋选词助手等。'
                    },
                    {
                        type: 'multiple',
                        question: '腾讯QQ的登录方式有（）',
                        options: ['QQ号码', '手机', '邮箱', '二维码登录'],
                        answer: ['A', 'B', 'C', 'D'],
                        explanation: '腾讯QQ支持多种登录方式，包括QQ号、手机号、邮箱和二维码扫描登录。'
                    },
                    {
                        type: 'multiple',
                        question: '下列关于宝贝主图描述，正确的是（）',
                        options: ['无Logo、无水印、无拼接、无牛皮癣，最好将素材抠图、边缘处理干净', '图片中不可以出现模特，必须是挂拍或平铺，不可出现衣架、商品吊牌等', '商品需正面展现，不可侧面或背面展现', '每张图片可以出现多个主体'],
                        answer: ['A', 'B', 'C'],
                        explanation: '宝贝主图要求无水印无拼接，正面展现，不出现多余元素，每张图片应突出单一主体。'
                    },
                    // 判断题
                    {
                        type: 'judge',
                        question: '表单是HTML的一个重要部分，主要用于采集和提交用户输入的信息。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '在Dreamweaver CS6软件中，按快捷键F8可实现对当前文档的预览。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '买家收到货物，觉得不喜欢要退货，卖家无过错，责任方在于买家，邮费由买家承担。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '开放式提问就是允许被调查者用自己的话自由回答问题，不提供具体答案。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '用"钢笔工具"绘制的矢量图形称为路径，又称为赛贝尔曲线。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '定位概括为三点就是类目、价格、风格。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '选择淘宝开店时，企业账户可以更改为个人账户，个人账户也能升级为企业账户。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '可以通过设置不同的曝光度参数来调整背景的变化效果。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '宝贝标题优化时需注意，可以加与自己宝贝无关的关键词，关键词注意和宝贝的属性相对应。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '店铺推广按展现扣费。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '一般域名注册的年限越长，在搜索引擎中的排名就会越靠前。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '宝贝分类可以是文字的形式，也可以是图片的形式。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: 'Absolute是对元素进行绝对定位，它永远固定在页面的某个地方，不会随着网页的滚动而移动。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '静态广告活泼有趣，被所有网站接受。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '一篇文章的色彩搭配不要超过3种颜色。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                   {
                        type: 'judge',
                        question: '为了进行有效的论坛营销，不而要对和产品无关的帖子进行回复和灌水。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '"极致产品 + 内容为主 + 体验至上" 是微信营销的本质。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '直接 IP 数，即通过软文发布地址或关键词直接访问的数量，相较于浏览量，这个数值更能说明正文的质量。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '可以用右键插入表格。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '可通过菜单栏中的反相命令来实现选区的反选效果。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    // 排序题
                    {
                        type: 'sort',
                        question: '网页设计与制作的基本流程为（）。',
                        options: ['制作网页', '规划结构', '选择主题', '检测网页', '收集素材'],
                        answer: ['C', 'B', 'E', 'A', 'D']
                    },
                    {
                        type: 'sort',
                        question: '设置店铺模板的操作步骤是（）',
                        options: ['单击"模板管理"，进入店铺模板选择设置页面', '淘宝首页--卖家中心--店铺管理--店铺装修,进入店铺装修页面', '单击"马上使用"', '在系统模板中选定一款合适的店铺模板'],
                        answer: ['B', 'A', 'D', 'C']
                    },
                    {
                        type: 'sort',
                        question: '在天涯社区进行论坛营销的流程为（）',
                        options: ['点击"发帖"', '撰写内容', '找到"数码生活"下"手机安全"版块栏目', '设计标题', '登录"天涯社区"账号', '点击"发表"'],
                        answer: ['E', 'C', 'A', 'D', 'B', 'F']
                    },
                    {
                        type: 'sort',
                        question: '查询店铺流量来源的作业步骤为 （）',
                        options: ['查看流量来源构成', '点击"店铺来源"', '进入"生意参谋"首页', '点击"来源分析"', '点击"流量"'],
                        answer: ['C', 'E', 'D', 'B', 'A']
                    },
                    {
                        type: 'sort',
                        question: '在详情页海报中添加商品图片的步骤为（）',
                        options: ['扣取商品图片，在背景中添加主体商品，通过"色阶"及图层样式命令调整图片的显示效果。', '根据已完成的海报背景和销售的商品进行分析，确定展示的角度和内容，选择合适的商品图片，确定商品图片的设计方向和思路。', '打开商品宝贝原图', '添加素材，烘托商品形象。'],
                        answer: ['B', 'C', 'A', 'D']
                    }
                ]
            },
            exam3: {
                title: '试卷模拟3',
                questions: [
                    // 单选题（20题）
                    {
                        type: 'single',
                        question: '光圈值______，进光量______，拍摄画面______。（ ）',
                        options: ['越小 越大 越暗', '越大 越多 越亮', '越小 越多 越亮', '越大 越多 越暗'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '下列可用于网页的常见声音格式的是______。（ ）',
                        options: ['FLV', 'ASF', 'WAV', 'MPG'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '插入一个表格的快捷键为______。（ ）',
                        options: ['ctrl+alt+i', 'ctrl+alt+t', 'ctrl+alt+a', 'alt+t'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '网店海报设计配色的黄金法则比例为______。（ ）',
                        options: ['主色彩 50%，次要色彩 30%，辅助色彩 20%', '主色彩 40%，次要色彩 40%，辅助色彩 20%', '主色彩 60%，次要色彩 30%，辅助色彩 10%', '主色彩 70%，次要色彩 20%，辅助色彩 10%'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '改变层的______可以改变层的显示顺序。（ ）',
                        options: ['可见性', '溢出', '图层顺序', 'Z轴'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: 'DW 主界面不包括______。（ ）',
                        options: ['菜单栏', '插入栏', '属性面板', '图层面板'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '客户："你们的产品是正品吗？" 这是关于（______）的问题。',
                        options: ['商品质量', '商品价格', '支付和物流', '售后服务'],
                        answer: 'A'
                    },
                    {
                        type: 'single',
                        question: '商家报名参加淘金币活动，上传活动商品图的尺寸为（______）',
                        options: ['80像素 x80像素', '120像素 x120像素', '700像素 x700像素', '800像素 x800像素'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '淘宝上可以在（______）查询店铺流量来源。',
                        options: ['数据魔方', '生意参谋', '淘宝大学', '阿里妈妈'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '下列关于订单四种状态的说法，错误的是（______）',
                        options: ['等待买家付款表示该商品已拍下，但买家还没付款到支付宝', '买家已付款表示买家已付款到卖家', '卖家已发货表示买家的货款由支付宝公司代管着', '交易成功表示买家已确认收货，卖家已收到货款'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '网站 SEO 评估时，网站跳出率的理想指数在（______）一下。',
                        options: ['30%', '40%', '50%', '60%'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '（______）即用户关注度。',
                        options: ['关键词密度', '关键词竞争度', '关键词相关度', '关键词热度'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '宝贝推荐模块最大推荐的宝贝数量不能超过（______）个',
                        options: ['18', '28', '38', '48'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '在 Photoshop CS6 中，______操作可以给 "文字图层" 加描边效果。（ ）',
                        options: ['选择 "文字图层"> 点击 "编辑" 菜单 > 描边 > 设置描边宽度 > 确定', '选择 "文字图层"> 点击 "文字" 菜单 > 描边 > 设置描边宽度 > 确定', '选择 "文字图层"> 点击 "图像" 菜单 > 图层样式 > 描边 > 设置描边大小 > 确定', '选择 "文字图层"> 点击 "图层" 菜单 > 图层样式 > 描边 > 设置描边大小 > 确定'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '以下不是 FLASH 动画设计的三大基本功能的是______（ ）',
                        options: ['补间动画', '遮罩', '绘图与编辑图形', '元件设计'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '曲线和色阶同属于图像 -- 调整子菜单，色阶的快捷键是______（ ）。',
                        options: ['Ctrl+O', 'Ctrl+I', 'Ctrl+L', 'Ctrl+M'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '修补工具中 ■ 表示______。（ ）',
                        options: ['新选区', '添加到选区', '从选区中减去', '与选区交叉'],
                        answer: 'A'
                    },
                    {
                        type: 'single',
                        question: '自由变换的快捷键是（______）',
                        options: ['ctrl+J', 'ctrl+T', 'shift+T', 'AIT+J'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '<input>标签用于______。（ ）',
                        options: ['网页标签', '定义一个按钮', '创建 HTML 表单', '收集用户信息'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: 'onMouseOut 的鼠标事件是（______）。',
                        options: ['鼠标悬浮', '鼠标移至', '鼠标移开', '鼠标按下'],
                        answer: 'C'
                    },
                    // 多选题（5题）
                    {
                        type: 'multiple',
                        question: '利用 CSS 样式美化页面时，可以对 (______) 进行美化',
                        options: ['字体大小', 'DIV 的背景颜色', '显示器的分辨率', '表格的边框'],
                        answer: ['A', 'B', 'D'],
                        explanation: 'CSS 可美化字体大小、DIV 背景颜色、表格边框等，显示器分辨率无法通过 CSS 美化'
                    },
                    {
                        type: 'multiple',
                        question: '下列属于设计静态广告 BANNER 的十大技巧的是（______）',
                        options: ['留白', '用心选图', '选择多个主题', '来点古怪奇招'],
                        answer: ['A', 'B', 'D'],
                        explanation: '设计静态广告 BANNER 技巧包含留白、用心选图、来点古怪奇招等，选择多个主题易杂乱，不是有效技巧'
                    },
                    {
                        type: 'multiple',
                        question: '下列关于论坛营销中发布广告的说法，正确的有 (______)',
                        options: ['在主帖发布广告时加入链接功能，方便查找', '为避免删帖，经过一段时间，可以对发布的帖子进行修改，重新将广告内容加上', '帖子发表时，不要一开始就发广告', '在发布广告时，可以长帖短发，在后面的跟帖中发布广告'],
                        answer: ['B', 'C', 'D'],
                        explanation: '论坛营销发布广告，为避免删帖修改加广告、不一开始发广告、长帖短发在跟帖发广告是合理做法'
                    },
                    {
                        type: 'multiple',
                        question: '下列属于比较失败的沟通语言的有 (______)',
                        options: ['我理解您现在的心情，我保证会帮您解决的。', '我绝对会在今天给您发货的。', '您看这样解决行吗？', '刚才您说您是一位妈妈，想必您的宝宝一定聪明、可爱、懂事。'],
                        answer: ['A', 'B', 'D'],
                        explanation: '"我绝对会在今天给您发货的" 易因不可控因素无法兑现，"我理解您现在的心情，我保证会帮您解决的" 承诺过重，"刚才您说您是一位妈妈，想必您的宝宝一定聪明、可爱、懂事。" 过度奉承，都是失败沟通'
                    },
                    {
                        type: 'multiple',
                        question: '"钢笔工具组" 包括（______）',
                        options: ['钢笔工具', '添加锚点工具', '删除锚点工具', '转换点工具'],
                        answer: ['A', 'B', 'C', 'D'],
                        explanation: '钢笔工具组包含这四个工具'
                    },
   // 判断题（20题）
                    {
                        type: 'judge',
                        question: '网络媒体中的标题要做到言简意赅，字数限制在 18 字以内。（______）',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '图层样式菜单中可以设置 3D 效果。（______）',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '图像属性面板中的 "链接" 用于设置图像的存放路径。（______）',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '成交转化率与店铺的定位和宝贝的定价有着直接的关系。（______）',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '通过宝贝详情页中设置站内搜索功能，可以提高用户的体验。（______）',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '<hr>是水平线的标签。（______）',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '详情页内需要做关联营销，将其他点击率高的商品关联到详情页内，降低详情页面跳失率。（______）',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '一个网站由很多网页组成，但不同网页之间可以共用描述标签内容。（______）',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: 'DIV 的布局一行只能显示一个 DIV 标签。（______）',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '为了进行有效的论坛营销，不而要对和产品无关的帖子进行回复和灌水。（______）',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '"极致产品 + 内容为主 + 体验至上" 是微信营销的本质。（______）',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '直接 IP 数，即通过软文发布地址或关键词直接访问的数量，相较于浏览量，这个数值更能说明正文的质量。（______）',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '可以用右键插入表格。（______）',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '可通过菜单栏中的反相命令来实现选区的反选效果。（______）',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '微淘的核心是回归以卖家为中心的淘宝。（______）',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '买家拍下商品付款后我们不可以修改交易价格。（______）',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '宝贝标题的容量是 25 个汉字。（______）',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '如果要隐藏图层上的内容，可使用黑色画笔在图层蒙版上涂抹。（______）',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '可以通过设置不同的曝光度参数来调整背景的变化效果。（______）',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '可以利用在线的二维码生成器制作二维码。（______）',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    // 排序题（5题）
                    {
                        type: 'sort',
                        question: '钻石展位的投放操作步骤为（______）',
                        options: [
                            '点击 "营销推广"', '登录 "卖家中心"', '点击 "钻石展位" 入口',
                            '点击 "我要推广"', '设置出价', '新建推广计划',
                            '选择推广场景', '选择资源位', '推广单元设置',
                            '投放日期，选择投放时间点和投放地', '编辑设置推广计划信息'
                        ],
                        answer: ['B', 'A', 'D', 'C', 'F', 'G', 'K', 'J', 'I', 'H', 'E']
                    },
                    {
                        type: 'sort',
                        question: '开设淘宝店铺的步骤是（______）',
                        options: ['登录淘宝网申请免费开店', '完善支付宝信息', '选择开店类型', '淘宝开店认证', '等待审核通过，店铺创建成功'],
                        answer: ['A', 'C', 'B', 'D', 'E']
                    },
                    {
                        type: 'sort',
                        question: '成交转化率漏斗模型各层次从上至下依次为（______）',
                        options: ['旺旺咨询率', '订单支付率', '有效入店率', '成交转化率', '旺旺咨询转化率和静默转化率'],
                        answer: ['C', 'A', 'E', 'B', 'D']
                    },
                    {
                        type: 'sort',
                        question: '在 Dreamweaver CS6 软件中插入复选框的步骤是（______）',
                        options: ['输入标签属性', '单击 "复选框"', '单击 "确定" 按钮', '单击 {插入}/{表单}', '将光标移至相应的位置'],
                        answer: ['E', 'D', 'B', 'A', 'C']
                    },
                    {
                        type: 'sort',
                        question: '设计网店海报的活动步骤为（______）',
                        options: ['新建文件，设计海报主要内容', '分析商品风格，确定海报构思', '添加宣传文案，完善海报设计'],
                        answer: ['B', 'A', 'C']
                    }
                ]
            },
            exam4: {
                title: '试卷模拟4',
                questions: [
                    // 单选题（20题）
                    {
                        type: 'single',
                        question: '下列属于主关键词的是（）',
                        options: ['夏装宽松', '"618"大促包邮', '代购休闲运动鞋', 'T恤'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '电子商务客服最主要的工作是（）',
                        options: ['准备FAQ和设置快捷短语', '与客户进行沟通', '指导客户下单付款', '修改订单信息'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '下列不属于挽回流失客户技巧的是（）',
                        options: ['树立企业形象', '完善管理制度', '不断进行创新', '完善质量管理'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '下列不会导致关键词没有展现量的是（）',
                        options: ['标题中不包含这个关键词', '关键词出价太低', '关键词太长且生僻', '关键词质量得分很低'],
                        answer: 'A'
                    },
                    {
                        type: 'single',
                        question: '天天特价活动的图片尺寸要求为（）',
                        options: ['800像素x800像素', '480像素x480像素', '800像素x600像素', '400像素x400像素'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '下列关于支付宝的使用说法不正确的是（）',
                        options: ['支付宝的使用可以保证资金的安全，需要手续费', '买家使用支付宝时最好申请数字证书以保证账户资金安全', '买家使用支付宝进行购物不需要通过任何认证手续', '支付宝是第三方代收款平台'],
                        answer: 'A'
                    },
                    {
                        type: 'single',
                        question: 'Garmin佳明跑步心率户外智能运动手表（产品如右图所示），它能实时记录跑步动态数据，科学量化跑步姿势，并对训练进行分析与指导的手表；运用革新的生物黑科技，记录脉搏与血氧，专业评估训练状态和体能变化；同时带有可续航22小时的GPS。根据介绍，请你判断这款产品在淘宝网默认的____主题市场中。（）',
                        options: ['运动', '手表', '运动手表', '户外健身'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '色阶的快捷键是（）。',
                        options: ['Ctrl+M', 'Ctrl+U', 'Ctrl+L', 'Ctrl+K'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '某个别钻资源位在某个小时段有三家开心食品果子的的竞争商家A、B和C参考竞价。其中A预算1200元，CPM出价7元；B预算1000元，CPM出价8元；C预算800元，CPM出价5元。最先得到展现的商家一共购买了____展现量。（）',
                        options: ['8400', '125000', '160000', '8000'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '客服人员需要对顾客常见问题进行分类，并编制成常见问题应答表。针对顾客提出的价格问题，客服回答正确的是____。（） 顾客：衣服太贵了，能不能便宜一点呀？ 客服：____。',
                        options: ['您好，本公司产品均为原厂自主设计生产，商城品质，假一罚十，亲大可放心！', '您好，这款已经是活动特惠价了，而且库存有限，亲喜欢的话要抓紧了哦。', '您好，本店默认发货快递为圆通快递，您那里可以到吗？如圆通快递不到的请留言，我们将转发邮政小包哦。', '您好，本店产品均为实样拍摄，图片由于拍摄光线以及显示器分辨率的原因，多少会有些色差，但是不影响整体质量，请您放心，我们承诺15天内包退换的，请您放心购买。'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '网页制作中下列名称不适合作为文件夹名称的是____。',
                        options: ['image', '图像', 'images', 'photo'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '插入一个表格的快捷键为____。',
                        options: ['ctrl+alt+i', 'ctrl+alt+t', 'ctrl+alt+a', 'alt+t'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '网店海报设计配色的黄金法则比例为____。',
                        options: ['主色彩50%，次要色彩30%，辅助色彩20%', '主色彩40%，次要色彩40%，辅助色彩20%', '主色彩60%，次要色彩30%，辅助色彩10%', '主色彩70%，次要色彩20%，辅助色彩10%'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '改变层的____可以改变层的显示顺序。',
                        options: ['可见性', '溢出', '图层顺序', 'Z轴'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '以下不是FLASH动画设计的三大基本功能的是____（）',
                        options: ['补间动画', '遮罩', '绘图与编辑图形', '元件设计'],
                        answer: 'D'
                    },
                    {
                        type: 'single',
                        question: '一般而言，导航条的主要功能和导航链接尽量不要超过____个。',
                        options: ['7', '12', '10', '15'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '下列属于吸光体的商品是（）',
                        options: ['玻璃', '橡胶', '银器', '红酒'],
                        answer: 'B'
                    },
                    {
                        type: 'single',
                        question: '在Photoshop中，用"文件/新建 "命令创建文件不能设定的模式是（）',
                        options: ['位图模式', 'RGB模式', '双色调模式', 'Lab模式'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: '信息经济学将商品进行了分类,消费者在购买时就能确定或评价其质量的商品称为（）',
                        options: ['经验性商品', '可量化性商品', '可鉴别商品', '感官性商品'],
                        answer: 'C'
                    },
                    {
                        type: 'single',
                        question: 'CSS的中文名称为（）。',
                        options: ['层叠样式', '层次样式', '层叠样式表', '层次样式表'],
                        answer: 'C'
                    },
                    // 多选题（5题）
                    {
                        type: 'multiple',
                        question: '1. float常用属性为（）',
                        options: ['Left', 'Right', 'None', 'Font'],
                        answer: ['A', 'B', 'C']
                    },
                    {
                        type: 'multiple',
                        question: '2. 以下属于常见感性的光圈值有____。',
                        options: ['F1', 'F1.7', 'F8.3', 'F22'],
                        answer: ['A', 'D']
                    },
                    {
                        type: 'multiple',
                        question: '3. 分析竞争对手的步骤包括（）',
                        options: ['知己', '知彼', '分析', '用魔镜分析'],
                        answer: ['A', 'B', 'C']
                    },
                    {
                        type: 'multiple',
                        question: '4. 在商品拍摄过程中，道具的选择原则是（）',
                        options: ['服务主题', '摆放合理', '宁缺毋滥', '与商品色调一致'],
                        answer: ['A', 'B', 'C']
                    },
                    {
                        type: 'multiple',
                        question: '5. 网页中常用的图片效果有（）。',
                        options: ['左右晃动效果', '图片叠加效果', '透明度改变效果', '放大效果'],
                        answer: ['A', 'B', 'C', 'D']
                    },
                    // 判断题（20题）
                    {
                        type: 'judge',
                        question: '1. 一般网店销售的商品体积不宜太大，而且要易于包装，方便快递运输。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '2. 在Photoshop CS6软件中设置画笔工具不透明度为50%，流量100%时，使用画笔工具按住鼠标不松开涂抹，颜色会越来越深。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '3. 客户第一次来店咨询时，客服需要快速响应，在1分钟内做出反馈，不要让客户过长等待。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '4. 一个WEB站点至少需要一个主页（home Page），可以有其他子页（二级页面等）。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '5. 一个超级链接链接的地址为：this.html#x11，其中x11是this.html页中的某个锚点。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '6. 软文的标题直接决定在软件的浏览量、转载量和被搜索引擎收录量。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '7. 若某网页背景颜色设置为FFFFFF，则背景的颜色为黑色。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '8. 在撰写论坛营销的帖子时，楼主应尽可能将营销信息的内容在主帖中表述清楚。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '9. Photoshop CS6软件中矩形工具绘制的矩形像素图形可以使用钢笔工具调整形状。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '10. 选中表格后，Dreamweaver CS6中即可显示表格属性，即可对表格的对齐方式、高度、宽度，边框样式等进行设置。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '11.天天特价活动图片和淘金币活动图片的大小均不得超过1M。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '12.在Dreamweaver CS6中，非连续的单元格也可直接合并。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '13.手机购买商品时，用户很难同时打开多个页面去比较价格和质量，使得影响用户不购买当前页面的商品因素减少，所以其页面转化率比计算机端低。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '14.Dreamweaver CS6模板可以在局部应用，但不能应用于整个站点。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '15. 在Photoshop CS6软件中通过画笔面板的设置，可以使画笔工具一笔画出多种颜色。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '16.表格布局浏览速度较慢，CSS+DIV布局的DIV层可以依次下载显示，因此其访问速度较表格布局的网页要快很多。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '17. Photoshop CS6软件标尺的原点是在左上角，且不能更改。',
                        options: ['正确', '错误'],
                        answer: 'F'
                    },
                    {
                        type: 'judge',
                        question: '18.文本和图像是网页中最基本的构成元素。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '19.在进行邮件营销前，需要对受众进行分析，才能有针对性地对目标受众发邮件，受众才有可能打开邮件阅读，并点击店铺或产品的链接。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    {
                        type: 'judge',
                        question: '20.大多数的买家有了购买的意愿，却在其他方面犹豫时，就可以利用买家想快点拿到商品怕买不到的心理。',
                        options: ['正确', '错误'],
                        answer: 'T'
                    },
                    // 排序题（5题）
                    {
                        type: 'sort',
                        question: '1. 利用Photoshop CS6软件修改文件大小的正确流程是____。',
                        options: ['执行 "画布大小"命令', '打开文件', '执行 "存储为web所用格式"命令', '设置文件格式与参数', '调整画布大小'],
                        answer: ['B', 'A', 'E', 'C', 'D']
                    },
                    {
                        type: 'sort',
                        question: '2. 运费模板设置的流程____。',
                        options: ['单击运费模板设置', '登录淘宝网，进入卖家中心，单击物流工具', '根据店铺地址，商品特点等，开始编辑运费模板内容及时保存', '单击新增运费模板'],
                        answer: ['B', 'D', 'A', 'C']
                    },
                    {
                        type: 'sort',
                        question: '3. 网页设计的一般步骤是____。',
                        options: ['制作网页', '选择主题', '收集素材', '检测网页', '规划结构'],
                        answer: ['B', 'E', 'C', 'A', 'D']
                    },
                    {
                        type: 'sort',
                        question: '4. 设计白底主图的步骤是____。',
                        options: ['分析商品特征，筛选商品图片', '调整图片位置和大小', '利用 "钢笔工具"抠取商品图片', '新建主图文件，确定文件大小', '绘制商品倒影，修饰商品图片'],
                        answer: ['A', 'D', 'C', 'B', 'E']
                    },
                    {
                        type: 'sort',
                        question: '5. 查询店铺流量来源的作业步骤为',
                        options: ['查看流量来源构成', '点击"店铺来源"', '进入"生意参谋"首页', '点击"来源分析"', '点击"流量"'],
                        answer: ['C', 'E', 'D', 'B', 'A']
                    }
                ]
            }
        };

        // 页面管理器
        const PageManager = {
            // 切换到指定页面
            switchTo(pageId) {
                // 隐藏所有页面
                const pages = document.querySelectorAll('.page');
                pages.forEach(page => {
                    page.classList.remove('active');
                });
                
                // 显示目标页面
                const targetPage = document.getElementById(pageId + 'Page');
                if (targetPage) {
                    targetPage.classList.add('active');
                    AppState.currentPage = pageId;
                    
                    // 如果切换到试卷选择页面，更新历史记录数量和错题数量
                    if (pageId === 'examSelection') {
                        updateHistoryCount();
                        updateWrongAnswerCount();
                    }
                }
            },
            
            // 显示页面（带动画）
            showPage(pageId) {
                const currentPage = document.querySelector('.page.active');
                const targetPage = document.getElementById(pageId + 'Page');
                
                if (!targetPage) return;
                
                // 添加淡出动画到当前页面
                if (currentPage) {
                    currentPage.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    currentPage.style.opacity = '0';
                    currentPage.style.transform = 'scale(0.95)';
                    
                    setTimeout(() => {
                        currentPage.classList.remove('active');
                        targetPage.classList.add('active');
                        
                        // 添加淡入动画到目标页面
                        targetPage.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                        targetPage.style.opacity = '0';
                        targetPage.style.transform = 'scale(1.05)';
                        
                        // 触发重排
                        void targetPage.offsetWidth;
                        
                        // 恢复正常状态
                        targetPage.style.opacity = '1';
                        targetPage.style.transform = 'scale(1)';
                        
                        AppState.currentPage = pageId;
                        
                        // 如果切换到试卷选择页面，更新历史记录数量和错题数量
                        if (pageId === 'examSelection') {
                            updateHistoryCount();
                            updateWrongAnswerCount();
                        }
                    }, 300);
                } else {
                    targetPage.classList.add('active');
                    AppState.currentPage = pageId;
                    
                    // 如果切换到试卷选择页面，更新历史记录数量和错题数量
                    if (pageId === 'examSelection') {
                        updateHistoryCount();
                        updateWrongAnswerCount();
                    }
                }
            }
        };

        // 模态框管理器
        const ModalManager = {
            // 显示模态框
            show(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('active');
                }
            },
            
            // 隐藏模态框
            hide(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                }
            }
        };

        // 工具函数
        const Utils = {
            // 获取DOM元素
            getElement(id) {
                try {
                    const element = document.getElementById(id);
                    if (!element) {
                        console.warn(`元素未找到: ${id}`);
                        return null;
                    }
                    return element;
                } catch (error) {
                    console.error(`获取元素时出错: ${id}`, error);
                    return null;
                }
            },
            
            // 创建DOM元素
            createElement(tagName, className, innerHTML) {
                try {
                    const element = document.createElement(tagName);
                    if (className) {
                        element.className = className;
                    }
                    if (innerHTML) {
                        element.innerHTML = innerHTML;
                    }
                    return element;
                } catch (error) {
                    console.error(`创建元素时出错: ${tagName}`, error);
                    return null;
                }
            },
            
            // 显示提示消息
            showToast(message, type = 'error') {
                try {
                    // 移除已存在的提示
                    const existingToast = document.querySelector(`.${type}-toast`);
                    if (existingToast) {
                        existingToast.remove();
                    }
                    
                    // 创建新的提示
                    const toast = Utils.createElement('div', `${type}-toast`, message);
                    if (toast) {
                        document.body.appendChild(toast);
                        
                        // 3秒后自动移除
                        setTimeout(() => {
                            if (toast.parentNode) {
                                toast.remove();
                            }
                        }, 3000);
                    }
                } catch (error) {
                    console.error('显示提示消息时出错:', error);
                }
            },
            
            // 从数组中随机获取指定数量的元素
            getRandomItems(array, count) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled.slice(0, count);
            },
            
            // 打乱数组
            shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }
        };

        // 数据持久化管理器
        const DataManager = {
            // 保存数据到localStorage
            saveData(key, data) {
                try {
                    // 添加时间戳和版本信息
                    const dataWithMeta = {
                        version: '1.0',
                        timestamp: new Date().toISOString(),
                        data: data
                    };
                    
                    localStorage.setItem(key, JSON.stringify(dataWithMeta));
                    console.log(`数据已保存到localStorage: ${key}`);
                    return true;
                } catch (error) {
                    console.error(`保存数据到localStorage失败: ${key}`, error);
                    return false;
                }
            },
            
            // 从localStorage加载数据
            loadData(key) {
                try {
                    const storedData = localStorage.getItem(key);
                    if (!storedData) {
                        console.log(`localStorage中没有找到数据: ${key}`);
                        return null;
                    }
                    
                    // 尝试解析数据
                    const parsedData = JSON.parse(storedData);
                    
                    // 检查数据格式（兼容旧版本）
                    if (parsedData.version && parsedData.data) {
                        console.log(`从localStorage加载数据成功: ${key} (版本 ${parsedData.version})`);
                        return parsedData.data;
                    } else {
                        // 旧版本数据，直接返回
                        console.log(`从localStorage加载数据成功: ${key} (旧版本格式)`);
                        return parsedData;
                    }
                } catch (error) {
                    console.error(`从localStorage加载数据失败: ${key}`, error);
                    return null;
                }
            },
            
            // 移除数据
            removeData(key) {
                try {
                    localStorage.removeItem(key);
                    console.log(`数据已从localStorage移除: ${key}`);
                    return true;
                } catch (error) {
                    console.error(`从localStorage移除数据失败: ${key}`, error);
                    return false;
                }
            },
            
            // 检查localStorage可用性
            isLocalStorageAvailable() {
                try {
                    const testKey = '__test__';
                    localStorage.setItem(testKey, 'test');
                    localStorage.removeItem(testKey);
                    return true;
                } catch (error) {
                    console.error('localStorage不可用:', error);
                    return false;
                }
            },
            
            // 获取存储空间使用情况
            getStorageUsage() {
                try {
                    let totalSize = 0;
                    for (let key in localStorage) {
                        if (localStorage.hasOwnProperty(key)) {
                            totalSize += localStorage[key].length;
                        }
                    }
                    return {
                        used: totalSize,
                        usedKB: (totalSize / 1024).toFixed(2),
                        available: 5 * 1024 * 1024 - totalSize, // 假设5MB限制
                        availableKB: ((5 * 1024 * 1024 - totalSize) / 1024).toFixed(2)
                    };
                } catch (error) {
                    console.error('获取存储空间使用情况失败:', error);
                    return null;
                }
            }
        };

        // 显示更新说明弹窗
        function showUpdateNotes() {
            ModalManager.show('updateNotesModal');
        }

        // 隐藏更新说明弹窗
        function hideUpdateNotes() {
            ModalManager.hide('updateNotesModal');
        }

        // 确认返回主页
        function confirmBackToHome() {
            // 检查是否已开始答题
            const hasAnswered = AppState.isAnswered.some(answered => answered);
            
            if (hasAnswered) {
                // 显示确认弹窗
                ModalManager.show('homeConfirmModal');
            } else {
                // 直接返回主页
                backToHome();
            }
        }

        // 提交并返回主页
        function submitAndGoHome() {
            ModalManager.hide('homeConfirmModal');
            submitAnswers();
            
            // 等待结果弹窗显示后再返回主页
            setTimeout(() => {
                backToHome();
            }, 1000);
        }

        // 取消返回主页
        function cancelGoHome() {
            ModalManager.hide('homeConfirmModal');
        }

        // 返回首页
        function backToHome() {
            // 重置考试状态
            resetExamState();
            
            // 切换到试卷选择页面
            PageManager.showPage('examSelection');
        }

        // 重置考试状态
        function resetExamState() {
            AppState.currentExam = null;
            AppState.questions = [];
            AppState.currentQuestion = 0;
            AppState.userAnswers = [];
            AppState.isAnswered = [];
            AppState.sortSubmitted = [];
            AppState.sortSelectedItems = [];
            AppState.multipleSelectedItems = [];
            AppState.previousQuestionType = '';
            AppState.isShuffled = false;
            AppState.originalIndices = [];
            AppState.passwordAttempts = 0;
            AppState.selectedRandomExams = [];
            AppState.grandmaShuffleEnabled = false;
            AppState.grandmaShuffleMode = 'full';
            
            // 10086版本特殊功能重置
            AppState.correctCountInSpecialVersion = 0;
            AppState.consecutiveCorrectCount = 0;
            AppState.lastAnswerCorrect = false;
            AppState.isRecovering = false;
            
            // 重置人物脸部状态
            const characterFace = Utils.getElement('characterFace');
            if (characterFace) {
                characterFace.className = 'character-face normal';
                characterFace.style.display = 'none';
            }
            
            // 清除特殊弹窗定时器
            if (AppState.specialToastTimeout) {
                clearTimeout(AppState.specialToastTimeout);
                AppState.specialToastTimeout = null;
            }
            
            // 隐藏特殊弹窗
            const specialToast = Utils.getElement('specialToast');
            if (specialToast) {
                specialToast.style.display = 'none';
                specialToast.classList.remove('hiding');
            }
            AppState.specialToastActive = false;
            
            // 隐藏音频激活按钮
            const audioBtn = Utils.getElement('audioActivationBtn');
            if (audioBtn) {
                audioBtn.style.display = 'none';
            }
            
            // 隐藏语音状态指示器
            const voiceIndicator = Utils.getElement('voiceStatusIndicator');
            if (voiceIndicator) {
                voiceIndicator.classList.remove('show');
            }
            
            // 禁用页面刷新保护
            AppState.refreshProtectionEnabled = false;
        }

        // 显示空试卷提示
        function showEmptyExam() {
            alert('该试卷暂无题目，敬请期待！');
            backToHome();
        }

        // 显示随机练习选择界面
        function showRandomSelection() {
            PageManager.showPage('randomSelection');
            generateRandomExamList();
        }

        // 生成随机练习可选择的试卷列表
        function generateRandomExamList() {
            try {
                const container = Utils.getElement('randomExamList');
                if (!container) {
                    console.error('随机练习列表容器未找到');
                    return;
                }
                
                container.innerHTML = '';
                
                // 只显示有题目的试卷
                const availableExams = [
                    { id: 'exam1', title: '试卷模拟1', count: examData.exam1.questions.length },
                    { id: 'exam2', title: '试卷模拟2', count: examData.exam2.questions.length },
                    { id: 'exam3', title: '试卷模拟3', count: examData.exam3.questions.length },
                    { id: 'exam4', title: '试卷模拟4', count: examData.exam4.questions.length }
                ];
                
                availableExams.forEach(exam => {
                    const examItem = Utils.createElement('div', 'random-exam-item');
                    if (!examItem) return;
                    
                    examItem.dataset.examId = exam.id;
                    examItem.onclick = () => toggleRandomExamSelection(exam.id);
                    
                    examItem.innerHTML = `
                        <div class="random-exam-icon">📝</div>
                        <div class="random-exam-title">${exam.title}</div>
                        <div class="random-exam-count">${exam.count} 题</div>
                    `;
                    
                    container.appendChild(examItem);
                });
                
                // 重置选择状态
                AppState.selectedRandomExams = [];
                updateRandomSelectionInfo();
            } catch (error) {
                console.error('生成随机练习试卷列表时出错:', error);
                Utils.showToast('生成试卷列表时出错，请刷新页面重试');
            }
        }

        // 切换随机练习试卷选择
        function toggleRandomExamSelection(examId) {
            try {
                const examItem = document.querySelector(`.random-exam-item[data-exam-id="${examId}"]`);
                if (!examItem) {
                    console.error(`试卷项未找到: ${examId}`);
                    return;
                }
                
                if (AppState.selectedRandomExams.includes(examId)) {
                    // 取消选择
                    AppState.selectedRandomExams = AppState.selectedRandomExams.filter(id => id !== examId);
                    examItem.classList.remove('selected');
                } else {
                    // 添加选择
                    AppState.selectedRandomExams.push(examId);
                    examItem.classList.add('selected');
                }
                
                updateRandomSelectionInfo();
            } catch (error) {
                console.error('切换随机练习试卷选择时出错:', error);
                Utils.showToast('切换试卷选择时出错，请刷新页面重试');
            }
        }

        // 更新随机练习选择信息
        function updateRandomSelectionInfo() {
            try {
                const infoText = Utils.getElement('selectedExamsText');
                const startBtn = Utils.getElement('startRandomBtn');
                
                if (!infoText || !startBtn) {
                    console.error('随机练习信息元素未找到');
                    return;
                }
                
                if (AppState.selectedRandomExams.length < 2) {
                    infoText.textContent = '请至少选择2个试卷';
                    startBtn.disabled = true;
                } else {
                    // 计算总题目数（固定为50道）
                    let examNames = [];
                    
                    AppState.selectedRandomExams.forEach(examId => {
                        examNames.push(examData[examId].title);
                    });
                    
                    infoText.textContent = `已选择：${examNames.join('、')}，将生成50道题目（单选20道、多选5道、判断20道、排序5道）`;
                    startBtn.disabled = false;
                }
            } catch (error) {
                console.error('更新随机练习选择信息时出错:', error);
                Utils.showToast('更新选择信息时出错，请刷新页面重试');
            }
        }

        // 开始随机练习
        function startRandomPractice() {
            try {
                if (AppState.selectedRandomExams.length < 2) {
                    alert('请至少选择2个试卷');
                    return;
                }
                
                // 定义每种题型需要的题目数量
                const requiredQuestions = {
                    'single': 20,    // 单选题20道
                    'multiple': 5,   // 多选题5道
                    'judge': 20,    // 判断题20道
                    'sort': 5       // 排序题5道
                };
                
                // 收集所有选中的试卷题目
                let allQuestions = [];
                AppState.selectedRandomExams.forEach(examId => {
                    allQuestions = allQuestions.concat(examData[examId].questions);
                });
                
                // 按题型分类题目
                const questionsByType = {
                    'single': [],
                    'multiple': [],
                    'judge': [],
                    'sort': []
                };
                
                allQuestions.forEach(question => {
                    questionsByType[question.type].push(question);
                });
                
                // 为每种题型抽取指定数量的题目
                let selectedQuestions = [];
                
                // 抽取单选题
                if (questionsByType['single'].length >= requiredQuestions['single']) {
                    selectedQuestions = selectedQuestions.concat(
                        Utils.getRandomItems(questionsByType['single'], requiredQuestions['single'])
                    );
                } else {
                    // 如果单选题不足，从所有试卷中补充
                    selectedQuestions = selectedQuestions.concat(questionsByType['single']);
                    const remaining = requiredQuestions['single'] - questionsByType['single'].length;
                    
                    // 从其他试卷中补充单选题
                    const otherSingleQuestions = [];
                    Object.keys(examData).forEach(examId => {
                        if (!AppState.selectedRandomExams.includes(examId) && examData[examId].questions.length > 0) {
                            examData[examId].questions.forEach(question => {
                                if (question.type === 'single') {
                                    otherSingleQuestions.push(question);
                                }
                            });
                        }
                    });
                    
                    if (otherSingleQuestions.length >= remaining) {
                        selectedQuestions = selectedQuestions.concat(
                            Utils.getRandomItems(otherSingleQuestions, remaining)
                        );
                    } else {
                        selectedQuestions = selectedQuestions.concat(otherSingleQuestions);
                    }
                }
                
                // 抽取多选题
                if (questionsByType['multiple'].length >= requiredQuestions['multiple']) {
                    selectedQuestions = selectedQuestions.concat(
                        Utils.getRandomItems(questionsByType['multiple'], requiredQuestions['multiple'])
                    );
                } else {
                    // 如果多选题不足，从所有试卷中补充
                    selectedQuestions = selectedQuestions.concat(questionsByType['multiple']);
                    const remaining = requiredQuestions['multiple'] - questionsByType['multiple'].length;
                    
                    // 从其他试卷中补充多选题
                    const otherMultipleQuestions = [];
                    Object.keys(examData).forEach(examId => {
                        if (!AppState.selectedRandomExams.includes(examId) && examData[examId].questions.length > 0) {
                            examData[examId].questions.forEach(question => {
                                if (question.type === 'multiple') {
                                    otherMultipleQuestions.push(question);
                                }
                            });
                        }
                    });
                    
                    if (otherMultipleQuestions.length >= remaining) {
                        selectedQuestions = selectedQuestions.concat(
                            Utils.getRandomItems(otherMultipleQuestions, remaining)
                        );
                    } else {
                        selectedQuestions = selectedQuestions.concat(otherMultipleQuestions);
                    }
                }
                
                // 抽取判断题
                if (questionsByType['judge'].length >= requiredQuestions['judge']) {
                    selectedQuestions = selectedQuestions.concat(
                        Utils.getRandomItems(questionsByType['judge'], requiredQuestions['judge'])
                    );
                } else {
                    // 如果判断题不足，从所有试卷中补充
                    selectedQuestions = selectedQuestions.concat(questionsByType['judge']);
                    const remaining = requiredQuestions['judge'] - questionsByType['judge'].length;
                    
                    // 从其他试卷中补充判断题
                    const otherJudgeQuestions = [];
                    Object.keys(examData).forEach(examId => {
                        if (!AppState.selectedRandomExams.includes(examId) && examData[examId].questions.length > 0) {
                            examData[examId].questions.forEach(question => {
                                if (question.type === 'judge') {
                                    otherJudgeQuestions.push(question);
                                }
                            });
                        }
                    });
                    
                    if (otherJudgeQuestions.length >= remaining) {
                        selectedQuestions = selectedQuestions.concat(
                            Utils.getRandomItems(otherJudgeQuestions, remaining)
                        );
                    } else {
                        selectedQuestions = selectedQuestions.concat(otherJudgeQuestions);
                    }
                }
                
                // 抽取排序题
                if (questionsByType['sort'].length >= requiredQuestions['sort']) {
                    selectedQuestions = selectedQuestions.concat(
                        Utils.getRandomItems(questionsByType['sort'], requiredQuestions['sort'])
                    );
                } else {
                    // 如果排序题不足，从所有试卷中补充
                    selectedQuestions = selectedQuestions.concat(questionsByType['sort']);
                    const remaining = requiredQuestions['sort'] - questionsByType['sort'].length;
                    
                    // 从其他试卷中补充排序题
                    const otherSortQuestions = [];
                    Object.keys(examData).forEach(examId => {
                        if (!AppState.selectedRandomExams.includes(examId) && examData[examId].questions.length > 0) {
                            examData[examId].questions.forEach(question => {
                                if (question.type === 'sort') {
                                    otherSortQuestions.push(question);
                                }
                            });
                        }
                    });
                    
                    if (otherSortQuestions.length >= remaining) {
                        selectedQuestions = selectedQuestions.concat(
                            Utils.getRandomItems(otherSortQuestions, remaining)
                        );
                    } else {
                        selectedQuestions = selectedQuestions.concat(otherSortQuestions);
                    }
                }
                
                // 保持题型分类，不进行打乱
                // 按照题型顺序排列：单选题 -> 多选题 -> 判断题 -> 排序题
                const sortedQuestions = [];
                
                // 添加单选题
                sortedQuestions.push(...selectedQuestions.filter(q => q.type === 'single'));
                // 添加多选题
                sortedQuestions.push(...selectedQuestions.filter(q => q.type === 'multiple'));
                // 添加判断题
                sortedQuestions.push(...selectedQuestions.filter(q => q.type === 'judge'));
                // 添加排序题
                sortedQuestions.push(...selectedQuestions.filter(q => q.type === 'sort'));
                
                // 创建临时试卷数据
                const tempExamData = {
                    title: '随机练习',
                    questions: sortedQuestions
                };
                
                // 设置当前考试数据
                AppState.currentExam = 'random';
                examData.random = tempExamData;
                
                // 显示加载动画
                showLoading();
                
                // 模拟加载延迟，然后显示密码框
                setTimeout(() => {
                    hideLoading();
                    showPasswordModal();
                }, 1500);
            } catch (error) {
                console.error('开始随机练习时出错:', error);
                Utils.showToast('开始随机练习时出错，请刷新页面重试');
            }
        }

        // 显示错题记录页面
        function showWrongAnswers() {
            // 修复：使用正确的页面ID
            PageManager.showPage('wrongAnswer');
            generateWrongAnswerList();
        }

        // 生成错题记录列表
        function generateWrongAnswerList() {
            try {
                const container = Utils.getElement('wrongAnswerList');
                if (!container) {
                    console.error('错题记录列表容器未找到');
                    return;
                }
                
                container.innerHTML = '';
                
                if (AppState.wrongAnswers.length === 0) {
                    container.innerHTML = `
                        <div class="empty-wrong-answers">
                            <div class="empty-icon">❌</div>
                            <div class="empty-title">暂无错题记录</div>
                            <div class="empty-text">完成考试后，您的错题将显示在这里</div>
                        </div>
                    `;
                    
                    // 禁用重做错题按钮
                    const retryBtn = Utils.getElement('retryWrongBtn');
                    if (retryBtn) {
                        retryBtn.disabled = true;
                    }
                    return;
                }
                
                // 启用重做错题按钮
                const retryBtn = Utils.getElement('retryWrongBtn');
                if (retryBtn) {
                    retryBtn.disabled = false;
                }
                
                AppState.wrongAnswers.forEach((wrongAnswer, index) => {
                    const wrongItem = Utils.createElement('div', 'wrong-answer-item');
                    if (!wrongItem) return;
                    
                    const typeMap = {
                        'single': '单选题',
                        'multiple': '多选题',
                        'judge': '判断题',
                        'sort': '排序题'
                    };
                    
                    wrongItem.innerHTML = `
                        <div class="wrong-answer-header">
                            <div class="wrong-answer-type">${typeMap[wrongAnswer.question.type]}</div>
                            <div class="wrong-answer-number">题目 ${index + 1}</div>
                        </div>
                        <div class="wrong-answer-question">${wrongAnswer.question.question}</div>
                        <div class="wrong-answer-details">
                            <div class="wrong-answer-user">你的答案：${formatUserAnswer(wrongAnswer.question, wrongAnswer.userAnswer)}</div>
                            <div class="wrong-answer-correct">正确答案：${formatCorrectAnswer(wrongAnswer.question)}</div>
                        </div>
                    `;
                    
                    container.appendChild(wrongItem);
                });
            } catch (error) {
                console.error('生成错题记录列表时出错:', error);
                Utils.showToast('生成错题记录列表时出错，请刷新页面重试');
            }
        }

        // 格式化用户答案
        function formatUserAnswer(question, userAnswer) {
            if (!userAnswer || userAnswer.length === 0) {
                return '未作答';
            }
            
            if (question.type === 'single' || question.type === 'judge') {
                const index = question.type === 'judge' ? 
                    (userAnswer === 'T' ? 0 : 1) : 
                    userAnswer.charCodeAt(0) - 65;
                return question.options[index];
            } else if (question.type === 'multiple' || question.type === 'sort') {
                return userAnswer.map(char => {
                    const index = char.charCodeAt(0) - 65;
                    return question.options[index];
                }).join('、');
            }
            
            return '未知答案';
        }

        // 格式化正确答案
        function formatCorrectAnswer(question) {
            if (question.type === 'single' || question.type === 'judge') {
                const answer = question.type === 'judge' ? 
                    (question.answer === 'T' ? 0 : 1) : 
                    question.answer.charCodeAt(0) - 65;
                return question.options[answer];
            } else if (question.type === 'multiple' || question.type === 'sort') {
                return question.answer.map(char => {
                    const index = char.charCodeAt(0) - 65;
                    return question.options[index];
                }).join('、');
            }
            
            return '未知答案';
        }

        // 重做错题
        function retryWrongAnswers() {
            try {
                if (AppState.wrongAnswers.length === 0) {
                    Utils.showToast('没有错题可以重做');
                    return;
                }
                
                // 创建临时试卷数据
                const tempExamData = {
                    title: '错题重做',
                    questions: AppState.wrongAnswers.map(wrongAnswer => wrongAnswer.question)
                };
                
                // 设置当前考试数据
                AppState.currentExam = 'wrongRetry';
                examData.wrongRetry = tempExamData;
                
                // 显示加载动画
                showLoading();
                
                // 模拟加载延迟，然后进入答题页面
                setTimeout(() => {
                    hideLoading();
                    initializeExam();
                }, 1000);
            } catch (error) {
                console.error('重做错题时出错:', error);
                Utils.showToast('重做错题时出错，请刷新页面重试');
            }
        }

        // 清空错题记录
        function clearWrongAnswers() {
            if (confirm('确定要清空所有错题记录吗？此操作不可撤销。')) {
                AppState.wrongAnswers = [];
                DataManager.saveData('wrongAnswers', AppState.wrongAnswers);
                generateWrongAnswerList();
                updateWrongAnswerCount();
            }
        }

        // 更新错题数量
        function updateWrongAnswerCount() {
            const countElement = Utils.getElement('wrongAnswerCount');
            if (countElement) {
                countElement.textContent = AppState.wrongAnswers.length;
            }
        }

        // 开始考试
        function startExam(examId) {
            try {
                // 检查试卷数据是否存在
                if (!examData[examId] || !examData[examId].questions || examData[examId].questions.length === 0) {
                    showEmptyExam();
                    return;
                }
                
                AppState.currentExam = examId;
                AppState.passwordAttempts = 0;
                
                // 显示加载动画
                showLoading();
                
                // 模拟加载延迟，然后显示密码框
                setTimeout(() => {
                    hideLoading();
                    showPasswordModal();
                }, 1500);
            } catch (error) {
                console.error('开始考试时出错:', error);
                Utils.showToast('开始考试时出错，请刷新页面重试');
            }
        }

        // 显示加载动画
        function showLoading() {
            const loadingContainer = Utils.getElement('loadingContainer');
            if (loadingContainer) {
                loadingContainer.classList.add('active');
            }
        }

        // 隐藏加载动画
        function hideLoading() {
            const loadingContainer = Utils.getElement('loadingContainer');
            if (loadingContainer) {
                loadingContainer.classList.remove('active');
            }
        }

        // 显示密码输入弹窗
        function showPasswordModal() {
            const passwordInput = Utils.getElement('passwordInput');
            const passwordError = Utils.getElement('passwordError');
            
            if (passwordInput && passwordError) {
                passwordInput.value = '';
                passwordError.style.display = 'none';
                passwordInput.focus();
                
                // 移除旧的监听器，防止重复绑定
                const newInput = passwordInput.cloneNode(true);
                passwordInput.parentNode.replaceChild(newInput, passwordInput);
                newInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        verifyPassword();
                    }
                });
            }
            
            ModalManager.show('passwordModal');
        }

        // 验证密码
        function verifyPassword() {
            try {
                const passwordInput = Utils.getElement('passwordInput');
                const passwordError = Utils.getElement('passwordError');
                
                if (!passwordInput || !passwordError) {
                    console.error('密码输入元素未找到');
                    return;
                }
                
                const password = passwordInput.value;
                
                if (password === '10086') {
                    // 特殊版本
                    AppState.isSpecialVersion = true;
                    ModalManager.hide('passwordModal');
                    initializeExam();
                    applySpecialVersionSettings();
                    loadAnimalSounds();
                    loadSpecialToastAudio();
                    checkSpeechSynthesisSupport();
                    addGlobalClickListener();
                } else if (password === '15957855063') {
                    // 原始版本
                    AppState.isSpecialVersion = false;
                    ModalManager.hide('passwordModal');
                    initializeExam();
                    applyNormalVersionSettings();
                    initAudioContext();
                    addGlobalClickListener();
                } else {
                    // 密码错误
                    AppState.passwordAttempts++;
                    passwordError.style.display = 'block';
                    passwordInput.value = '';
                    passwordInput.focus();
                    
                    if (AppState.passwordAttempts >= 3) {
                        alert('密码错误次数过多，请刷新页面重试。');
                        backToHome();
                    }
                }
            } catch (error) {
                console.error('验证密码时出错:', error);
                Utils.showToast('验证密码时出错，请刷新页面重试');
            }
        }

        // 添加全局点击监听器以激活音频
        function addGlobalClickListener() {
            // 如果已经添加过监听器，则不再重复添加
            if (AppState.globalClickListenerAdded) {
                return;
            }
            
            // 添加全局点击监听器
            document.addEventListener('click', function handleFirstClick() {
                // 如果音频已经初始化，则不再处理
                if (AppState.audioInitialized) {
                    return;
                }
                
                // 初始化音频上下文
                if (!AppState.audioContext) {
                    try {
                        window.AudioContext = window.AudioContext || window.webkitAudioContext;
                        AppState.audioContext = new AudioContext();
                    } catch (error) {
                        console.error('创建AudioContext失败:', error);
                    }
                }
                
                // 如果音频上下文存在且处于暂停状态，则恢复
                if (AppState.audioContext && AppState.audioContext.state === 'suspended') {
                    AppState.audioContext.resume().then(() => {
                        console.log('AudioContext已通过全局点击激活');
                        AppState.audioInitialized = true;
                        
                        // 播放一个极短的静音音频以"解锁"音频权限
                        playSilentSound();
                        
                        // 移除事件监听器
                        document.removeEventListener('click', handleFirstClick);
                        AppState.globalClickListenerAdded = true;
                    }).catch(e => {
                        console.error('恢复AudioContext失败:', e);
                    });
                } else {
                    AppState.audioInitialized = true;
                    
                    // 播放一个极短的静音音频以"解锁"音频权限
                    playSilentSound();
                    
                    // 移除事件监听器
                    document.removeEventListener('click', handleFirstClick);
                    AppState.globalClickListenerAdded = true;
                }
            }, { once: true });
            
            AppState.globalClickListenerAdded = true;
        }

        // 播放静音音频以"解锁"音频权限
        function playSilentSound() {
            try {
                if (!AppState.audioContext) {
                    return;
                }
                
                // 创建一个极短的静音音频
                const oscillator = AppState.audioContext.createOscillator();
                const gainNode = AppState.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(AppState.audioContext.destination);
                
                // 设置为静音
                gainNode.gain.value = 0;
                
                // 设置极短的持续时间
                oscillator.start();
                oscillator.stop(AppState.audioContext.currentTime + 0.01);
                
                console.log('已播放静音音频以解锁音频权限');
            } catch (error) {
                console.error('播放静音音频时出错:', error);
            }
        }

        // 初始化音频上下文
        function initAudioContext() {
            try {
                if (!AppState.audioContext) {
                    window.AudioContext = window.AudioContext || window.webkitAudioContext;
                    AppState.audioContext = new AudioContext();
                    
                    // 如果音频上下文处于暂停状态，尝试恢复
                    if (AppState.audioContext.state === 'suspended') {
                        AppState.audioContext.resume().then(() => {
                            console.log('AudioContext已恢复');
                        }).catch(e => {
                            console.error('恢复AudioContext失败:', e);
                        });
                    }
                }
            } catch (error) {
                console.error('初始化AudioContext失败:', error);
                Utils.showToast('音频系统初始化失败，可能无法播放音效');
            }
        }

        // 取消密码输入
        function cancelPassword() {
            ModalManager.hide('passwordModal');
            AppState.passwordAttempts = 0;
            backToHome();
        }

        // 加载动物音效
        function loadAnimalSounds() {
            try {
                AppState.correctSound = new Audio('https://img.tukuppt.com/newpreview_music/09/04/08/5c8b03a8802e214463.mp3');
                AppState.incorrectSound = new Audio('https://img.tukuppt.com/newpreview_music/09/00/22/5c890ce9eeb7271798.mp3');
                
                // 预加载音频
                AppState.correctSound.preload = 'auto';
                AppState.incorrectSound.preload = 'auto';
                
                // 静默加载，避免自动播放限制
                AppState.correctSound.load();
                AppState.incorrectSound.load();
            } catch (error) {
                console.error('加载动物音效时出错:', error);
            }
        }

        // 10086版本特殊功能 - 加载特殊语音
        function loadSpecialToastAudio() {
            try {
                // 使用Web Speech API生成语音
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance('你还活着干嘛');
                    utterance.lang = 'zh-CN';
                    // 调整参数使语气更生气
                    utterance.rate = 1.2;
                    utterance.pitch = 0.5;
                    utterance.volume = 1.0;
                    
                    // 预加载语音
                    speechSynthesis.cancel();
                    speechSynthesis.speak(utterance);
                    speechSynthesis.pause();
                    speechSynthesis.cancel();
                    
                    // 存储语音配置
                    AppState.specialToastAudio = {
                        text: '你还活着干嘛',
                        lang: 'zh-CN',
                        rate: 1.2,
                        pitch: 0.5,
                        volume: 1.0
                    };
                }
            } catch (error) {
                console.error('加载特殊语音时出错:', error);
            }
        }

        // 检测语音合成支持
        function checkSpeechSynthesisSupport() {
            try {
                if ('speechSynthesis' in window) {
                    AppState.speechSynthesisSupported = true;
                    console.log('浏览器支持语音合成API');
                } else {
                    AppState.speechSynthesisSupported = false;
                    console.log('浏览器不支持语音合成API');
                    // 显示音频激活按钮
                    showAudioActivationButton();
                }
            } catch (error) {
                console.error('检测语音合成支持时出错:', error);
                AppState.speechSynthesisSupported = false;
                showAudioActivationButton();
            }
        }

        // 显示音频激活按钮
        function showAudioActivationButton() {
            try {
                const audioBtn = Utils.getElement('audioActivationBtn');
                if (audioBtn) {
                    audioBtn.style.display = 'flex';
                }
            } catch (error) {
                console.error('显示音频激活按钮时出错:', error);
            }
        }

        // 激活音频
        function activateAudio() {
            try {
                // 创建音频上下文
                if (!AppState.audioContext) {
                    window.AudioContext = window.AudioContext || window.webkitAudioContext;
                    AppState.audioContext = new AudioContext();
                }
                
                // 如果音频上下文被暂停，尝试恢复
                if (AppState.audioContext.state === 'suspended') {
                    AppState.audioContext.resume().then(() => {
                        console.log('音频上下文已激活');
                        AppState.audioActivated = true;
                        
                        // 隐藏激活按钮
                        const audioBtn = Utils.getElement('audioActivationBtn');
                        if (audioBtn) {
                            audioBtn.style.display = 'none';
                        }
                        
                        // 播放一个短音效确认激活
                        playActivationSound();
                        
                        Utils.showToast('音频已激活，语音功能可用');
                    }).catch(e => {
                        console.error('激活音频上下文失败:', e);
                        Utils.showToast('音频激活失败，请重试');
                    });
                } else {
                    AppState.audioActivated = true;
                    
                    // 隐藏激活按钮
                    const audioBtn = Utils.getElement('audioActivationBtn');
                    if (audioBtn) {
                        audioBtn.style.display = 'none';
                    }
                    
                    // 播放一个短音效确认激活
                    playActivationSound();
                    
                    Utils.showToast('音频已激活，语音功能可用');
                }
            } catch (error) {
                console.error('激活音频时出错:', error);
                Utils.showToast('音频激活失败，请重试');
            }
        }

        // 播放激活音效
        function playActivationSound() {
            try {
                if (!AppState.audioContext) return;
                
                const oscillator = AppState.audioContext.createOscillator();
                const gainNode = AppState.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(AppState.audioContext.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523.25, AppState.audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(0, AppState.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, AppState.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, AppState.audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(AppState.audioContext.currentTime + 0.5);
            } catch (error) {
                console.error('播放激活音效时出错:', error);
            }
        }

        // 初始化考试
        function initializeExam() {
            try {
                // 添加检查以确保当前考试数据存在
                if (!AppState.currentExam || !examData[AppState.currentExam]) {
                    console.error("考试数据未找到:", AppState.currentExam);
                    Utils.showToast("考试数据加载失败，请重新开始。");
                    backToHome();
                    return;
                }

                // 初始化题目数据
                AppState.questions = [...examData[AppState.currentExam].questions];
                AppState.userAnswers = new Array(AppState.questions.length).fill(null);
                AppState.isAnswered = new Array(AppState.questions.length).fill(false);
                AppState.sortSubmitted = new Array(AppState.questions.length).fill(false);
                AppState.sortSelectedItems = [];
                AppState.multipleSelectedItems = [];
                
                // 初始化原始索引
                AppState.originalIndices = Array.from({length: AppState.questions.length}, (_, i) => i);
                
                // 设置考试标题
                const examTitle = Utils.getElement('examTitle');
                if (examTitle) {
                    examTitle.textContent = examData[AppState.currentExam].title;
                }
                
                // 切换到考试页面
                PageManager.showPage('exam');
                
                // 显示第一题
                AppState.currentQuestion = 0;
                displayQuestion();
                updateProgress();
                
                // 确保按钮正确显示
                updateButtonVisibility();
                
                // 10086版本特殊功能 - 显示人物脸部
                if (AppState.isSpecialVersion) {
                    const characterFace = Utils.getElement('characterFace');
                    if (characterFace) {
                        characterFace.style.display = 'flex';
                    }
                }
                
                // 启用页面刷新保护
                AppState.refreshProtectionEnabled = true;
            } catch (error) {
                console.error('初始化考试时出错:', error);
                Utils.showToast('初始化考试时出错，请刷新页面重试');
            }
        }

        // 应用特殊版本设置
        function applySpecialVersionSettings() {
            try {
                // 显示顾老太太打乱设置区域
                const grandmaShuffleSection = Utils.getElement('grandmaShuffleSection');
                if (grandmaShuffleSection) {
                    grandmaShuffleSection.style.display = 'block';
                }
                
                // 显示答错语音播报设置
                const specialToastSection = Utils.getElement('specialToastSection');
                if (specialToastSection) {
                    specialToastSection.style.display = 'flex';
                }
                
                // 隐藏普通打乱设置项
                const shuffleSettingItem = Utils.getElement('shuffleSettingItem');
                
                if (shuffleSettingItem) {
                    shuffleSettingItem.style.display = 'none';
                }
                
                // 修改打乱按钮标题
                const shuffleBtn = Utils.getElement('shuffleBtn');
                if (shuffleBtn) {
                    shuffleBtn.title = '顾老太太打乱';
                }
                
                // 设置音效为动物叫声
                AppState.soundType = 'animal';
                
                // 更新音效选择按钮状态
                const soundButtons = document.querySelectorAll('.sound-btn');
                soundButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const animalBtn = document.querySelector('.sound-btn[data-sound="animal"]');
                if (animalBtn) {
                    animalBtn.classList.add('active');
                }
                
                // 初始化顾老太太打乱状态为关闭
                AppState.grandmaShuffleEnabled = false;
                AppState.grandmaShuffleMode = 'full';
                
                const toggle = Utils.getElement('grandmaShuffleToggle');
                const status = Utils.getElement('grandmaShuffleStatus');
                
                if (toggle && status) {
                    toggle.classList.remove('active');
                    status.textContent = '当前状态：已关闭';
                }
                
                // 初始化语音播报开关为关闭
                AppState.specialToastEnabled = false;
                const specialToastToggle = Utils.getElement('specialToastToggle');
                if (specialToastToggle) {
                    specialToastToggle.classList.remove('active');
                }
            } catch (error) {
                console.error('应用特殊版本设置时出错:', error);
                Utils.showToast('应用特殊版本设置时出错，请刷新页面重试');
            }
        }

        // 应用普通版本设置
        function applyNormalVersionSettings() {
            try {
                // 隐藏顾老太太打乱设置区域
                const grandmaShuffleSection = Utils.getElement('grandmaShuffleSection');
                if (grandmaShuffleSection) {
                    grandmaShuffleSection.style.display = 'none';
                }
                
                // 隐藏答错语音播报设置
                const specialToastSection = Utils.getElement('specialToastSection');
                if (specialToastSection) {
                    specialToastSection.style.display = 'none';
                }
                
                // 显示普通打乱设置项
                const shuffleSettingItem = Utils.getElement('shuffleSettingItem');
                
                if (shuffleSettingItem) {
                    shuffleSettingItem.style.display = 'flex';
                }
                
                // 修改设置中的一键打乱标签
                const shuffleLabel = Utils.getElement('shuffleLabel');
                if (shuffleLabel) {
                    shuffleLabel.textContent = '一键打乱';
                }
                
                // 修改打乱按钮标题
                const shuffleBtn = Utils.getElement('shuffleBtn');
                if (shuffleBtn) {
                    shuffleBtn.title = '一键打乱';
                }
                
                // 设置音效为默认音效
                AppState.soundType = 'correct';
                
                // 更新音效选择按钮状态
                const soundButtons = document.querySelectorAll('.sound-btn');
                soundButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const correctBtn = document.querySelector('.sound-btn[data-sound="correct"]');
                if (correctBtn) {
                    correctBtn.classList.add('active');
                }
            } catch (error) {
                console.error('应用普通版本设置时出错:', error);
                Utils.showToast('应用普通版本设置时出错，请刷新页面重试');
            }
        }

        // 更新按钮可见性
        function updateButtonVisibility() {
            try {
                const prevBtn = Utils.getElement('prevBtn');
                const nextBtn = Utils.getElement('nextBtn');
                
                if (!prevBtn || !nextBtn) {
                    console.error('按钮元素未找到');
                    return;
                }
                
                prevBtn.disabled = AppState.currentQuestion === 0;
                
                if (AppState.currentQuestion === AppState.questions.length - 1) {
                    nextBtn.disabled = true;
                } else {
                    nextBtn.disabled = false;
                }
            } catch (error) {
                console.error('更新按钮可见性时出错:', error);
            }
        }

        // 显示题目
        function displayQuestion() {
            try {
                if (AppState.currentQuestion < 0 || AppState.currentQuestion >= AppState.questions.length) {
                    console.error('当前题目索引无效');
                    return;
                }
                
                const q = AppState.questions[AppState.currentQuestion];
                if (!q) {
                    console.error('当前题目数据无效');
                    return;
                }
                
                const typeMap = {
                    'single': '单选题',
                    'multiple': '多选题',
                    'judge': '判断题',
                    'sort': '排序题'
                };

                // 添加题型切换动画
                const questionTypeElement = Utils.getElement('questionType');
                if (questionTypeElement) {
                    questionTypeElement.textContent = typeMap[q.type] || '未知题型';
                    
                    // 如果题型发生变化，添加动画效果
                    if (AppState.previousQuestionType !== q.type) {
                        questionTypeElement.classList.add('animate');
                        setTimeout(() => {
                            questionTypeElement.classList.remove('animate');
                        }, 1000);
                        AppState.previousQuestionType = q.type;
                    }
                }

                const questionNumberElement = Utils.getElement('questionNumber');
                if (questionNumberElement) {
                    questionNumberElement.textContent = `第 ${AppState.currentQuestion + 1} 题`;
                }
                
                const questionTextElement = Utils.getElement('questionText');
                if (questionTextElement) {
                    questionTextElement.textContent = q.question || '';
                }

                const container = Utils.getElement('optionsContainer');
                if (container) {
                    container.innerHTML = '';
                }
                
                // 隐藏答案反馈
                const feedback = Utils.getElement('answerFeedback');
                if (feedback) {
                    feedback.className = 'answer-feedback';
                    feedback.innerHTML = '';
                }

                // 更新动态反馈
                updateDynamicFeedback();

                if (container) {
                    if (q.type === 'sort') {
                        container.className = 'sort-container';
                        displaySortOptions(q);
                    } else if (q.type === 'judge') {
                        container.className = 'options';
                        displayJudgeOptions(q);
                    } else if (q.type === 'multiple') {
                        container.className = 'multiple-container';
                        AppState.multipleSelectedItems = AppState.userAnswers[AppState.currentQuestion] || [];
                        displayMultipleOptions(q);
                        if (!AppState.isAnswered[AppState.currentQuestion]) {
                            AppState.multipleStartTime = Date.now();
                        }
                    } else {
                        container.className = 'options';
                        displayNormalOptions(q);
                    }
                }

                updateButtonVisibility();
            } catch (error) {
                console.error('显示题目时出错:', error);
                Utils.showToast('显示题目时出错，请刷新页面重试');
            }
        }

        // 更新动态反馈
        function updateDynamicFeedback() {
            try {
                const q = AppState.questions[AppState.currentQuestion];
                const feedbackElement = Utils.getElement('dynamicFeedback');
                
                if (!feedbackElement || !q) {
                    return;
                }
                
                if (AppState.isAnswered[AppState.currentQuestion] && AppState.userAnswers[AppState.currentQuestion] !== null) {
                    if (q.type === 'single') {
                        const correctAnswer = q.answer;
                        const userAnswer = AppState.userAnswers[AppState.currentQuestion];
                        const correctOptionText = q.options[correctAnswer.charCodeAt(0) - 65];
                        const userOptionText = q.options[userAnswer.charCodeAt(0) - 65];
                        
                        feedbackElement.innerHTML = `正确答案：<span class="correct-option">${correctAnswer}. ${correctOptionText}</span>，你的选择：<span class="user-option">${userAnswer}. ${userOptionText}</span>`;
                    } else if (q.type === 'multiple') {
                        const correctAnswers = q.answer;
                        const userAnswersArray = AppState.userAnswers[AppState.currentQuestion] || [];
                        
                        const correctOptionsText = correctAnswers.map(char => {
                            const index = char.charCodeAt(0) - 65;
                            return `${char}. ${q.options[index]}`;
                        }).join(', ');
                        
                        const userOptionsText = userAnswersArray.map(char => {
                            const index = char.charCodeAt(0) - 65;
                            return `${char}. ${q.options[index]}`;
                        }).join(', ');
                        
                        feedbackElement.innerHTML = `正确答案：<span class="correct-option">${correctOptionsText}</span>，你的选择：<span class="user-option">${userOptionsText}</span>`;
                    } else if (q.type === 'judge') {
                        const correctAnswer = q.answer;
                        const userAnswer = AppState.userAnswers[AppState.currentQuestion];
                        const correctText = correctAnswer === 'T' ? q.options[0] : q.options[1];
                        const userText = userAnswer === 'T' ? q.options[0] : q.options[1];
                        
                        feedbackElement.innerHTML = `正确答案：<span class="correct-option">${correctText}</span>，你的选择：<span class="user-option">${userText}</span>`;
                    } else if (q.type === 'sort') {
                        const correctAnswers = q.answer;
                        const userAnswersArray = AppState.userAnswers[AppState.currentQuestion] || [];
                        
                        const correctOptionsText = correctAnswers.map(char => {
                            const index = char.charCodeAt(0) - 65;
                            return q.options[index];
                        }).join(' → ');
                        
                        const userOptionsText = userAnswersArray.map(char => {
                            const index = char.charCodeAt(0) - 65;
                            return q.options[index];
                        }).join(' → ');
                        
                        feedbackElement.innerHTML = `正确答案：<span class="correct-option">${correctOptionsText}</span>，你的选择：<span class="user-option">${userOptionsText}</span>`;
                    }
                } else {
                    feedbackElement.innerHTML = `正确答案：<span class="correct-option">答题后显示</span>`;
                }
            } catch (error) {
                console.error('更新动态反馈时出错:', error);
            }
        }

        // 显示普通选项
        function displayNormalOptions(q) {
            try {
                const container = Utils.getElement('optionsContainer');
                if (!container) {
                    console.error('选项容器未找到');
                    return;
                }
                
                q.options.forEach((option, index) => {
                    const optionDiv = Utils.createElement('div', 'option');
                    if (!optionDiv) return;
                    
                    if (AppState.isAnswered[AppState.currentQuestion]) {
                        const optionChar = String.fromCharCode(65 + index);
                        if (q.type === 'multiple') {
                            if (q.answer.includes(optionChar)) {
                                optionDiv.classList.add('correct');
                            } else if (AppState.userAnswers[AppState.currentQuestion] && AppState.userAnswers[AppState.currentQuestion].includes(optionChar)) {
                                optionDiv.classList.add('incorrect');
                            }
                        } else {
                            if (optionChar === q.answer) {
                                optionDiv.classList.add('correct');
                            } else if (AppState.userAnswers[AppState.currentQuestion] === optionChar) {
                                optionDiv.classList.add('incorrect');
                            }
                        }
                    } else if (AppState.userAnswers[AppState.currentQuestion]) {
                        if (q.type === 'multiple') {
                            if (AppState.userAnswers[AppState.currentQuestion].includes(String.fromCharCode(65 + index))) {
                                optionDiv.classList.add('selected');
                            }
                        } else {
                            if (AppState.userAnswers[AppState.currentQuestion] === String.fromCharCode(65 + index)) {
                                optionDiv.classList.add('selected');
                            }
                        }
                    }

                    optionDiv.innerHTML = `
                        <div class="option-label">${String.fromCharCode(65 + index)}</div>
                        <div class="option-text">${option}</div>
                    `;

                    optionDiv.onclick = () => selectOption(index);
                    container.appendChild(optionDiv);
                });
            } catch (error) {
                console.error('显示普通选项时出错:', error);
                Utils.showToast('显示选项时出错，请刷新页面重试');
            }
        }

        // 显示多选题选项
        function displayMultipleOptions(q) {
            try {
                const container = Utils.getElement('optionsContainer');
                if (!container) {
                    console.error('选项容器未找到');
                    return;
                }
                
                container.innerHTML = '';
                
                if (AppState.isAnswered[AppState.currentQuestion]) {
                    const resultDiv = Utils.createElement('div', 'multiple-answer-panel');
                    if (!resultDiv) return;
                    
                    resultDiv.style.background = '#f8f9fa';
                    resultDiv.style.borderRadius = '10px';
                    resultDiv.style.padding = '20px';
                    
                    const titleDiv = Utils.createElement('div');
                    if (!titleDiv) return;
                    
                    titleDiv.style.fontWeight = 'bold';
                    titleDiv.style.marginBottom = '15px';
                    titleDiv.style.color = '#333';
                    titleDiv.textContent = '正确答案：';
                    resultDiv.appendChild(titleDiv);
                    
                    const contentDiv = Utils.createElement('div');
                    if (!contentDiv) return;
                    
                    contentDiv.style.display = 'flex';
                    contentDiv.style.flexWrap = 'wrap';
                    contentDiv.style.gap = '8px';
                    
                    q.answer.forEach((char, index) => {
                        const optionIndex = char.charCodeAt(0) - 65;
                        const tagDiv = Utils.createElement('div', 'multiple-answer-tag correct');
                        if (!tagDiv) return;
                        
                        tagDiv.textContent = `${char}. ${q.options[optionIndex]}`;
                        contentDiv.appendChild(tagDiv);
                    });
                    
                    resultDiv.appendChild(contentDiv);
                    container.appendChild(resultDiv);
                } else {
                    // 创建紧凑的多选题布局
                    const compactDiv = Utils.createElement('div', 'multiple-compact');
                    if (!compactDiv) return;
                    
                    const headerDiv = Utils.createElement('div', 'multiple-header');
                    if (!headerDiv) return;
                    
                    headerDiv.innerHTML = `
                        <div class="multiple-info">本题需要选择 <strong>${q.answer.length}</strong> 个选项</div>
                        <div class="multiple-actions">
                            <button class="multiple-action-btn" onclick="selectAllOptions()">全选</button>
                            <button class="multiple-action-btn secondary" onclick="clearAllOptions()">清空</button>
                        </div>
                    `;
                    compactDiv.appendChild(headerDiv);
                    
                    const mainDiv = Utils.createElement('div', 'multiple-main');
                    if (!mainDiv) return;
                    
                    const optionsPanel = Utils.createElement('div', 'multiple-options-panel');
                    if (!optionsPanel) return;
                    
                    const optionsTitle = Utils.createElement('div', 'multiple-panel-title');
                    if (!optionsTitle) return;
                    
                    optionsTitle.textContent = '可选选项';
                    optionsPanel.appendChild(optionsTitle);
                    
                    const optionsGrid = Utils.createElement('div', 'multiple-options-grid');
                    if (!optionsGrid) return;
                    
                    q.options.forEach((option, index) => {
                        const optionDiv = Utils.createElement('div', 'multiple-option-item');
                        const optionChar = String.fromCharCode(65 + index);
                        
                        if (AppState.multipleSelectedItems.includes(optionChar)) {
                            optionDiv.classList.add('used');
                        }
                        
                        optionDiv.innerHTML = `
                            <div class="multiple-option-letter">${optionChar}</div>
                            <div class="multiple-option-text">${option}</div>
                        `;
                        
                        if (!AppState.multipleSelectedItems.includes(optionChar)) {
                            optionDiv.onclick = () => selectMultipleOption(optionChar);
                        }
                        
                        optionsGrid.appendChild(optionDiv);
                    });
                    
                    optionsPanel.appendChild(optionsGrid);
                    mainDiv.appendChild(optionsPanel);
                    
                    const answerPanel = Utils.createElement('div', 'multiple-answer-panel');
                    if (!answerPanel) return;
                    
                    const answerTitle = Utils.createElement('div', 'multiple-panel-title');
                    if (!answerTitle) return;
                    
                    answerTitle.textContent = '已选答案';
                    answerPanel.appendChild(answerTitle);
                    
                    const answerContent = Utils.createElement('div', 'multiple-answer-content');
                    if (!answerContent) return;
                    
                    if (AppState.multipleSelectedItems.length > 0) {
                        AppState.multipleSelectedItems.forEach((char, index) => {
                            const optionIndex = char.charCodeAt(0) - 65;
                            const itemDiv = Utils.createElement('div', 'multiple-answer-tag');
                            if (!itemDiv) return;
                            
                            itemDiv.innerHTML = `
                                ${char}. ${q.options[optionIndex]}
                                <span class="remove-icon">×</span>
                            `;
                            itemDiv.onclick = () => removeMultipleOption(char);
                            answerContent.appendChild(itemDiv);
                        });
                    } else {
                        answerContent.innerHTML = '<div class="empty-hint">请从左侧选择选项</div>';
                    }
                    
                    answerPanel.appendChild(answerContent);
                    
                    const submitArea = Utils.createElement('div', 'multiple-submit-area');
                    if (!submitArea) return;
                    
                    const selectedCount = AppState.multipleSelectedItems.length;
                    submitArea.innerHTML = `
                        <div class="multiple-count">
                            已选择 <span class="count-number">${selectedCount}</span> 项
                            ${selectedCount > 0 ? `/ 共 ${q.answer.length} 项` : ''}
                        </div>
                        <button class="multiple-submit-btn" ${selectedCount === 0 ? 'disabled' : ''} onclick="submitMultipleAnswer()">
                            ✓ 提交答案
                        </button>
                    `;
                    
                    answerPanel.appendChild(submitArea);
                    mainDiv.appendChild(answerPanel);
                    
                    compactDiv.appendChild(mainDiv);
                    container.appendChild(compactDiv);
                }
            } catch (error) {
                console.error('显示多选题选项时出错:', error);
                Utils.showToast('显示选项时出错，请刷新页面重试');
            }
        }

        // 全选所有选项
        function selectAllOptions() {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;
                
                const q = AppState.questions[AppState.currentQuestion];
                AppState.multipleSelectedItems = [];
                
                for (let i = 0; i < q.options.length; i++) {
                    AppState.multipleSelectedItems.push(String.fromCharCode(65 + i));
                }
                
                AppState.userAnswers[AppState.currentQuestion] = [...AppState.multipleSelectedItems];
                
                playSound(true);
                updateMultipleOptionsDisplay(q);
            } catch (error) {
                console.error('全选所有选项时出错:', error);
                Utils.showToast('全选选项时出错，请刷新页面重试');
            }
        }

        // 清空所有选项
        function clearAllOptions() {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;
                
                const q = AppState.questions[AppState.currentQuestion];
                AppState.multipleSelectedItems = [];
                AppState.userAnswers[AppState.currentQuestion] = [];
                
                playSound(false);
                updateMultipleOptionsDisplay(q);
            } catch (error) {
                console.error('清空所有选项时出错:', error);
                Utils.showToast('清空选项时出错，请刷新页面重试');
            }
        }

        // 选择多选题选项
        function selectMultipleOption(optionChar) {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;
                
                const q = AppState.questions[AppState.currentQuestion];
                
                AppState.multipleSelectedItems.push(optionChar);
                AppState.userAnswers[AppState.currentQuestion] = [...AppState.multipleSelectedItems];
                
                playSound(true);
                updateMultipleOptionsDisplay(q);
            } catch (error) {
                console.error('选择多选题选项时出错:', error);
                Utils.showToast('选择选项时出错，请刷新页面重试');
            }
        }

        // 更新多选题选项显示
        function updateMultipleOptionsDisplay(q) {
            try {
                const container = Utils.getElement('optionsContainer');
                if (!container) {
                    console.error('选项容器未找到');
                    return;
                }
                
                const compactDiv = container.querySelector('.multiple-compact');
                if (!compactDiv) {
                    console.error('多选题容器未找到');
                    displayMultipleOptions(q);
                    return;
                }
                
                const mainDiv = compactDiv.querySelector('.multiple-main');
                const optionsPanel = mainDiv.querySelector('.multiple-options-panel');
                const optionsGrid = optionsPanel.querySelector('.multiple-options-grid');
                const answerPanel = mainDiv.querySelector('.multiple-answer-panel');
                const answerContent = answerPanel.querySelector('.multiple-answer-content');
                const submitArea = answerPanel.querySelector('.multiple-submit-area');
                
                if (!mainDiv || !optionsPanel || !optionsGrid || !answerPanel || !answerContent || !submitArea) {
                    console.error('多选题子元素未找到');
                    displayMultipleOptions(q);
                    return;
                }
                
                optionsGrid.innerHTML = '';
                q.options.forEach((option, index) => {
                    const optionDiv = Utils.createElement('div', 'multiple-option-item');
                    const optionChar = String.fromCharCode(65 + index);
                    
                    if (AppState.multipleSelectedItems.includes(optionChar)) {
                        optionDiv.classList.add('used');
                    }
                    
                    optionDiv.innerHTML = `
                        <div class="multiple-option-letter">${optionChar}</div>
                        <div class="multiple-option-text">${option}</div>
                    `;
                    
                    if (!AppState.multipleSelectedItems.includes(optionChar)) {
                        optionDiv.onclick = () => selectMultipleOption(optionChar);
                    }
                    
                    optionsGrid.appendChild(optionDiv);
                });
                
                answerContent.innerHTML = '';
                if (AppState.multipleSelectedItems.length > 0) {
                    AppState.multipleSelectedItems.forEach((char, index) => {
                        const optionIndex = char.charCodeAt(0) - 65;
                        const itemDiv = Utils.createElement('div', 'multiple-answer-tag');
                        if (!itemDiv) return;
                        
                        itemDiv.innerHTML = `
                            ${char}. ${q.options[optionIndex]}
                            <span class="remove-icon">×</span>
                        `;
                        itemDiv.onclick = () => removeMultipleOption(char);
                        answerContent.appendChild(itemDiv);
                    });
                } else {
                    answerContent.innerHTML = '<div class="empty-hint">请从左侧选择选项</div>';
                }
                
                const selectedCount = AppState.multipleSelectedItems.length;
                submitArea.innerHTML = `
                    <div class="multiple-count">
                        已选择 <span class="count-number">${selectedCount}</span> 项
                        ${selectedCount > 0 ? `/ 共 ${q.answer.length} 项` : ''}
                    </div>
                    <button class="multiple-submit-btn" ${selectedCount === 0 ? 'disabled' : ''} onclick="submitMultipleAnswer()">
                        ✓ 提交答案
                    </button>
                `;
                
                updateButtonVisibility();
            } catch (error) {
                console.error('更新多选题选项显示时出错:', error);
                Utils.showToast('更新选项显示时出错，请刷新页面重试');
                displayMultipleOptions(q);
            }
        }

        // 移除多选题选项
        function removeMultipleOption(optionChar) {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;
                
                const q = AppState.questions[AppState.currentQuestion];
                
                const index = AppState.multipleSelectedItems.indexOf(optionChar);
                if (index > -1) {
                    AppState.multipleSelectedItems.splice(index, 1);
                    AppState.userAnswers[AppState.currentQuestion] = [...AppState.multipleSelectedItems];
                    
                    updateMultipleOptionsDisplay(q);
                    updateDynamicFeedback();
                    
                    const feedback = Utils.getElement('answerFeedback');
                    if (feedback) {
                        feedback.className = 'answer-feedback';
                        feedback.innerHTML = '';
                    }
                    
                    updateButtonVisibility();
                }
            } catch (error) {
                console.error('移除多选题选项时出错:', error);
                Utils.showToast('移除选项时出错，请刷新页面重试');
            }
        }

        // 显示判断题选项
        function displayJudgeOptions(q) {
            try {
                const container = Utils.getElement('optionsContainer');
                if (!container) {
                    console.error('选项容器未找到');
                    return;
                }
                
                q.options.forEach((option, index) => {
                    const optionDiv = Utils.createElement('div', 'judge-option');
                    if (!optionDiv) return;
                    
                    if (AppState.isAnswered[AppState.currentQuestion]) {
                        const selectedValue = index === 0 ? 'T' : 'F';
                        if (selectedValue === q.answer) {
                            optionDiv.classList.add('correct');
                        } else if (AppState.userAnswers[AppState.currentQuestion] === selectedValue) {
                            optionDiv.classList.add('incorrect');
                        }
                    } else if (AppState.userAnswers[AppState.currentQuestion]) {
                        const selectedValue = index === 0 ? 'T' : 'F';
                        if (AppState.userAnswers[AppState.currentQuestion] === selectedValue) {
                            optionDiv.classList.add('selected');
                        }
                    }

                    optionDiv.innerHTML = `
                        <div class="judge-label">${option}</div>
                    `;

                    optionDiv.onclick = () => selectJudgeOption(index);
                    container.appendChild(optionDiv);
                });
            } catch (error) {
                console.error('显示判断题选项时出错:', error);
                Utils.showToast('显示选项时出错，请刷新页面重试');
            }
        }

        // 显示排序选项
        function displaySortOptions(q) {
            try {
                const container = Utils.getElement('optionsContainer');
                if (!container) {
                    console.error('选项容器未找到');
                    return;
                }
                
                container.innerHTML = '';
                
                if (!AppState.userAnswers[AppState.currentQuestion]) {
                    AppState.sortSelectedItems = [];
                } else {
                    AppState.sortSelectedItems = [...AppState.userAnswers[AppState.currentQuestion]];
                }
                
                const optionsDiv = Utils.createElement('div', 'sort-options');
                if (!optionsDiv) return;
                
                q.options.forEach((option, index) => {
                    const optionDiv = Utils.createElement('div', 'sort-option');
                    const optionChar = String.fromCharCode(65 + index);
                    
                    if (AppState.sortSelectedItems.includes(optionChar)) {
                        optionDiv.classList.add('used');
                    }
                    
                    if (AppState.isAnswered[AppState.currentQuestion] || AppState.sortSubmitted[AppState.currentQuestion]) {
                        optionDiv.classList.add('locked');
                        optionDiv.style.cursor = 'not-allowed';
                        optionDiv.style.opacity = '0.6';
                    }
                    
                    optionDiv.innerHTML = `
                        <div class="sort-number">${index + 1}</div>
                        <div class="sort-text">${option}</div>
                    `;
                    
                    if (!AppState.sortSelectedItems.includes(optionChar) && !AppState.isAnswered[AppState.currentQuestion] && !AppState.sortSubmitted[AppState.currentQuestion]) {
                        optionDiv.onclick = () => selectSortOption(optionChar, option);
                    }
                    
                    optionsDiv.appendChild(optionDiv);
                });
                
                container.appendChild(optionsDiv);
                
                const answerDiv = Utils.createElement('div', 'sort-answer-area');
                if (!answerDiv) return;
                
                answerDiv.id = 'sortAnswerArea';
                
                if (AppState.sortSelectedItems.length > 0) {
                    AppState.sortSelectedItems.forEach((char, index) => {
                        const optionIndex = char.charCodeAt(0) - 65;
                        const itemDiv = Utils.createElement('div', 'sort-answer-item');
                        if (!itemDiv) return;
                        
                        const isLocked = AppState.isAnswered[AppState.currentQuestion] || AppState.sortSubmitted[AppState.currentQuestion];
                        
                        if (isLocked) {
                            itemDiv.classList.add('locked');
                        }
                        
                        itemDiv.textContent = q.options[optionIndex];
                        
                        if (!isLocked) {
                            itemDiv.onclick = () => removeSortOption(char);
                        }
                        
                        answerDiv.appendChild(itemDiv);
                        
                        if (index < AppState.sortSelectedItems.length - 1) {
                            const arrowDiv = Utils.createElement('span', 'sort-arrow');
                            if (!arrowDiv) return;
                            
                            arrowDiv.textContent = '→';
                            answerDiv.appendChild(arrowDiv);
                        }
                    });
                } else {
                    answerDiv.innerHTML = '<span style="color: #999;">请按顺序点击左侧选项</span>';
                }
                
                container.appendChild(answerDiv);
                
                // 添加提交按钮（仅在未提交时显示）
                if (!AppState.isAnswered[AppState.currentQuestion] && !AppState.sortSubmitted[AppState.currentQuestion]) {
                    const submitContainer = Utils.createElement('div', 'sort-submit-container');
                    if (!submitContainer) return;
                    
                    const submitBtn = Utils.createElement('button', 'sort-submit-btn');
                    if (!submitBtn) return;
                    
                    submitBtn.innerHTML = '✓ 提交答案';
                    submitBtn.disabled = AppState.sortSelectedItems.length === 0;
                    submitBtn.onclick = () => submitSortAnswer();
                    
                    submitContainer.appendChild(submitBtn);
                    container.appendChild(submitContainer);
                }
            } catch (error) {
                console.error('显示排序选项时出错:', error);
                Utils.showToast('显示选项时出错，请刷新页面重试');
            }
        }

        // 提交排序题答案
        function submitSortAnswer() {
            try {
                if (AppState.isAnswered[AppState.currentQuestion] || AppState.sortSubmitted[AppState.currentQuestion]) return;
                
                const q = AppState.questions[AppState.currentQuestion];
                
                // 检查是否已选择所有选项
                if (AppState.sortSelectedItems.length !== q.answer.length) {
                    Utils.showToast(`请选择所有 ${q.answer.length} 个选项后再提交`);
                    return;
                }
                
                // 标记为已提交
                AppState.sortSubmitted[AppState.currentQuestion] = true;
                AppState.userAnswers[AppState.currentQuestion] = [...AppState.sortSelectedItems];
                
                // 检查答案是否正确
                const isCorrect = JSON.stringify(AppState.sortSelectedItems) === JSON.stringify(q.answer);
                
                if (isCorrect) {
                    playSound(true);
                    AppState.isAnswered[AppState.currentQuestion] = true;
                    showAnswerFeedback(true, '排序正确！');
                    updateButtonVisibility();
                    
                    if (AppState.autoNextEnabled) {
                        setTimeout(() => {
                            if (AppState.currentQuestion < AppState.questions.length - 1) {
                                nextQuestion();
                            }
                        }, 500);
                    }
                } else {
                    playSound(false);
                    AppState.isAnswered[AppState.currentQuestion] = true;
                    
                    const feedback = Utils.getElement('answerFeedback');
                    if (feedback) {
                        feedback.className = 'answer-feedback incorrect';
                        feedback.innerHTML = '排序已锁定';
                    }
                    
                    updateButtonVisibility();
                }
                
                // 重新显示排序选项，更新UI状态
                displaySortOptions(q);
                updateDynamicFeedback();
                checkIfAllQuestionsAnswered();
            } catch (error) {
                console.error('提交排序题答案时出错:', error);
                Utils.showToast('提交答案时出错，请刷新页面重试');
            }
        }

        // 选择排序选项
        function selectSortOption(optionChar, optionText) {
            try {
                const q = AppState.questions[AppState.currentQuestion];
                
                // 检查是否已提交答案
                if (AppState.isAnswered[AppState.currentQuestion] || AppState.sortSubmitted[AppState.currentQuestion]) {
                    return;
                }
                
                AppState.sortSelectedItems.push(optionChar);
                AppState.userAnswers[AppState.currentQuestion] = [...AppState.sortSelectedItems];
                
                displaySortOptions(q);
                updateDynamicFeedback();
            } catch (error) {
                console.error('选择排序选项时出错:', error);
                Utils.showToast('选择选项时出错，请刷新页面重试');
            }
        }

        // 移除排序选项
        function removeSortOption(optionChar) {
            try {
                // 检查是否已提交答案
                if (AppState.isAnswered[AppState.currentQuestion] || AppState.sortSubmitted[AppState.currentQuestion]) {
                    return;
                }
                
                const q = AppState.questions[AppState.currentQuestion];
                
                const index = AppState.sortSelectedItems.indexOf(optionChar);
                if (index > -1) {
                    AppState.sortSelectedItems.splice(index, 1);
                    AppState.userAnswers[AppState.currentQuestion] = [...AppState.sortSelectedItems];
                    
                    displaySortOptions(q);
                    updateDynamicFeedback();
                    
                    const feedback = Utils.getElement('answerFeedback');
                    if (feedback) {
                        feedback.className = 'answer-feedback';
                        feedback.innerHTML = '';
                    }
                    
                    updateButtonVisibility();
                }
            } catch (error) {
                console.error('移除排序选项时出错:', error);
                Utils.showToast('移除选项时出错，请刷新页面重试');
            }
        }

        // 显示答案反馈
        function showAnswerFeedback(isCorrect, message, detailHTML = '') {
            try {
                const feedback = Utils.getElement('answerFeedback');
                if (!feedback) return;
                
                feedback.className = `answer-feedback show ${isCorrect ? 'correct' : 'incorrect'}`;
                feedback.innerHTML = message + (detailHTML || '');
            } catch (error) {
                console.error('显示答案反馈时出错:', error);
            }
        }

        // 选择选项
        function selectOption(index) {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;

                const q = AppState.questions[AppState.currentQuestion];
                const selectedChar = String.fromCharCode(65 + index);

                if (q.type === 'multiple') {
                    if (!AppState.userAnswers[AppState.currentQuestion]) {
                        AppState.userAnswers[AppState.currentQuestion] = [];
                    }
                    const answerIndex = AppState.userAnswers[AppState.currentQuestion].indexOf(selectedChar);
                    if (answerIndex > -1) {
                        AppState.userAnswers[AppState.currentQuestion].splice(answerIndex, 1);
                    } else {
                        AppState.userAnswers[AppState.currentQuestion].push(selectedChar);
                    }
                    
                    const isCorrect = q.answer.includes(selectedChar);
                    playSound(isCorrect);
                    
                    if (!isCorrect) {
                        AppState.isAnswered[AppState.currentQuestion] = true;
                        const correctOptions = q.answer.map(char => {
                            const optionIndex = char.charCodeAt(0) - 65;
                            return `${char}. ${q.options[optionIndex]}`;
                        }).join(', ');
                        
                        const userOptions = AppState.userAnswers[AppState.currentQuestion].map(char => {
                            const optionIndex = char.charCodeAt(0) - 65;
                            return `${char}. ${q.options[optionIndex]}`;
                        }).join(', ');
                        
                        showAnswerFeedback(false, `回答错误。正确答案：${correctOptions}，您选择了：${userOptions}`);
                    }
                } else {
                    AppState.userAnswers[AppState.currentQuestion] = selectedChar;
                    const isCorrect = AppState.userAnswers[AppState.currentQuestion] === q.answer;
                    playSound(isCorrect);
                    AppState.isAnswered[AppState.currentQuestion] = true;
                    
                    const correctOption = `${q.answer}. ${q.options[q.answer.charCodeAt(0) - 65]}`;
                    const userOption = `${selectedChar}. ${q.options[index]}`;
                    
                    if (isCorrect) {
                        showAnswerFeedback(true, `回答正确！正确答案：${correctOption}，您选择了：${userOption}`);
                        
                        if (AppState.autoNextEnabled) {
                            setTimeout(() => {
                                if (AppState.currentQuestion < AppState.questions.length - 1) {
                                    nextQuestion();
                                }
                            }, 500);
                        }
                    } else {
                        showAnswerFeedback(false, `回答错误。正确答案：${correctOption}，您选择了：${userOption}`);
                        
                        // 10086版本特殊功能 - 答错题目时触发
                        if (AppState.isSpecialVersion) {
                            updateCharacterFace(false);
                        }
                    }
                }

                updateDynamicFeedback();
                displayQuestion();
                updateButtonVisibility();
                checkIfAllQuestionsAnswered();
            } catch (error) {
                console.error('选择选项时出错:', error);
                Utils.showToast('选择选项时出错，请刷新页面重试');
            }
        }

        // 选择判断题选项
        function selectJudgeOption(index) {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;

                const q = AppState.questions[AppState.currentQuestion];
                const selectedValue = index === 0 ? 'T' : 'F';
                const selectedText = q.options[index];
                
                AppState.userAnswers[AppState.currentQuestion] = selectedValue;
                const isCorrect = AppState.userAnswers[AppState.currentQuestion] === q.answer;
                playSound(isCorrect);
                AppState.isAnswered[AppState.currentQuestion] = true;
                
                const correctText = q.answer === 'T' ? q.options[0] : q.options[1];
                
                if (isCorrect) {
                    showAnswerFeedback(true, `回答正确！正确答案：${correctText}，您选择了：${selectedText}`);
                    
                    if (AppState.autoNextEnabled) {
                        setTimeout(() => {
                            if (AppState.currentQuestion < AppState.questions.length - 1) {
                                        nextQuestion();
                                    }
                                }, 500);
                    }
                } else {
                    showAnswerFeedback(false, `回答错误。正确答案：${correctText}，您选择了：${selectedText}`);
                    
                    // 10086版本特殊功能 - 答错题目时触发
                    if (AppState.isSpecialVersion) {
                        updateCharacterFace(false);
                    }
                }

                updateDynamicFeedback();
                displayQuestion();
                updateButtonVisibility();
                checkIfAllQuestionsAnswered();
            } catch (error) {
                console.error('选择判断题选项时出错:', error);
                Utils.showToast('选择选项时出错，请刷新页面重试');
            }
        }

        // 提交多选题答案
        function submitMultipleAnswer() {
            try {
                if (AppState.isAnswered[AppState.currentQuestion]) return;
                
                const q = AppState.questions[AppState.currentQuestion];
                const userAnswers = AppState.multipleSelectedItems;
                const correctAnswers = q.answer;
                
                // 检查答案是否正确
                const isCorrect = userAnswers.length === correctAnswers.length && 
                                userAnswers.every(ans => correctAnswers.includes(ans));
                
                AppState.userAnswers[AppState.currentQuestion] = [...userAnswers];
                AppState.isAnswered[AppState.currentQuestion] = true;
                
                playSound(isCorrect);
                
                // 显示反馈
                const correctOptionsText = correctAnswers.map(char => {
                    const index = char.charCodeAt(0) - 65;
                    return `${char}. ${q.options[index]}`;
                }).join(', ');
                
                const userOptionsText = userAnswers.map(char => {
                    const index = char.charCodeAt(0) - 65;
                    return `${char}. ${q.options[index]}`;
                }).join(', ');
                
                if (isCorrect) {
                    showAnswerFeedback(true, `回答正确！正确答案：${correctOptionsText}，您选择了：${userOptionsText}`);
                    
                    if (AppState.autoNextEnabled) {
                        setTimeout(() => {
                            if (AppState.currentQuestion < AppState.questions.length - 1) {
                                nextQuestion();
                            }
                        }, 500);
                    }
                } else {
                    showAnswerFeedback(false, `回答错误。正确答案：${correctOptionsText}，您选择了：${userOptionsText}`);
                    
                    // 10086版本特殊功能 - 答错题目时触发
                    if (AppState.isSpecialVersion) {
                        updateCharacterFace(false);
                    }
                }
                
                updateDynamicFeedback();
                displayQuestion();
                updateButtonVisibility();
                checkIfAllQuestionsAnswered();
            } catch (error) {
                console.error('提交多选题答案时出错:', error);
                Utils.showToast('提交答案时出错，请刷新页面重试');
            }
        }

        // 检查是否完成所有题目
        function checkIfAllQuestionsAnswered() {
            try {
                const allAnswered = AppState.isAnswered.every(answered => answered);
                if (allAnswered) {
                    setTimeout(() => {
                        submitAnswers();
                    }, 1000);
                }
            } catch (error) {
                console.error('检查是否完成所有题目时出错:', error);
            }
        }

        // 上一题
        function previousQuestion() {
            try {
                if (AppState.currentQuestion > 0) {
                    AppState.currentQuestion--;
                    displayQuestion();
                    updateProgress();
                    updateButtonVisibility();
                }
            } catch (error) {
                console.error('上一题时出错:', error);
                Utils.showToast('上一题时出错，请刷新页面重试');
            }
        }

        // 下一题
        function nextQuestion() {
            try {
                if (AppState.currentQuestion < AppState.questions.length - 1) {
                    AppState.currentQuestion++;
                    displayQuestion();
                    updateProgress();
                    updateButtonVisibility();
                }
            } catch (error) {
                console.error('下一题时出错:', error);
                Utils.showToast('下一题时出错，请刷新页面重试');
            }
        }

        // 更新进度
        function updateProgress() {
            try {
                const progress = ((AppState.currentQuestion + 1) / AppState.questions.length) * 100;
                const progressBar = Utils.getElement('progressBar');
                const progressText = Utils.getElement('progressText');
                
                if (progressBar) {
                    progressBar.style.width = progress + '%';
                }
                
                if (progressText) {
                    progressText.textContent = `第 ${AppState.currentQuestion + 1} 题 / 共 ${AppState.questions.length} 题`;
                }
            } catch (error) {
                console.error('更新进度时出错:', error);
            }
        }

        // 打开设置
        function openSettings() {
            ModalManager.show('settingsModal');
            generateSoundOptions();
            
            // 设置自动下一题开关的状态
            const autoNextToggle = Utils.getElement('autoNextToggle');
            if (autoNextToggle) {
                if (AppState.autoNextEnabled) {
                    autoNextToggle.classList.add('active');
                } else {
                    autoNextToggle.classList.remove('active');
                }
            }
            
            // 设置语音播报开关的状态
            if (AppState.isSpecialVersion) {
                const specialToastToggle = Utils.getElement('specialToastToggle');
                if (specialToastToggle) {
                    if (AppState.specialToastEnabled) {
                        specialToastToggle.classList.add('active');
                    } else {
                        specialToastToggle.classList.remove('active');
                    }
                }
            }
        }

        // 切换自动下一题
        function toggleAutoNext() {
            try {
                const toggle = Utils.getElement('autoNextToggle');
                if (toggle) {
                    toggle.classList.toggle('active');
                    AppState.autoNextEnabled = toggle.classList.contains('active');
                }
            } catch (error) {
                console.error('切换自动下一题时出错:', error);
                Utils.showToast('切换自动下一题时出错，请刷新页面重试');
            }
        }

        // 切换语音播报开关
        function toggleSpecialToast() {
            try {
                const toggle = Utils.getElement('specialToastToggle');
                if (toggle) {
                    toggle.classList.toggle('active');
                    AppState.specialToastEnabled = toggle.classList.contains('active');
                    
                    // 如果开启语音播报但音频未激活，显示激活按钮
                    if (AppState.specialToastEnabled && !AppState.audioActivated && !AppState.speechSynthesisSupported) {
                        showAudioActivationButton();
                    }
                }
            } catch (error) {
                console.error('切换语音播报开关时出错:', error);
                Utils.showToast('切换语音播报开关时出错，请刷新页面重试');
            }
        }

        // 生成音效选项
        function generateSoundOptions() {
            try {
                const soundOptionsContainer = Utils.getElement('soundOptions');
                if (!soundOptionsContainer) {
                    console.error('音效选项容器未找到');
                    return;
                }
                
                soundOptionsContainer.innerHTML = '';
                
                if (AppState.isSpecialVersion) {
                    const animalBtn = Utils.createElement('div', 'sound-btn active');
                    if (!animalBtn) return;
                    
                    animalBtn.dataset.sound = 'animal';
                    animalBtn.innerHTML = `
                        <span>动物叫声</span>
                        <span class="sound-preview" onclick="previewSound(event, 'animal')">▶</span>
                    `;
                    soundOptionsContainer.appendChild(animalBtn);
                } else {
                    const correctBtn = Utils.createElement('div', 'sound-btn active');
                    if (!correctBtn) return;
                    
                    correctBtn.dataset.sound = 'correct';
                    correctBtn.innerHTML = `
                        <span>答对音效</span>
                        <span class="sound-preview" onclick="previewSound(event, 'correct')">▶</span>
                    `;
                    soundOptionsContainer.appendChild(correctBtn);
                    
                    const incorrectBtn = Utils.createElement('div', 'sound-btn');
                    if (!incorrectBtn) return;
                    
                    incorrectBtn.dataset.sound = 'incorrect';
                    incorrectBtn.innerHTML = `
                        <span>答错音效</span>
                        <span class="sound-preview" onclick="previewSound(event, 'incorrect')">▶</span>
                    `;
                    soundOptionsContainer.appendChild(incorrectBtn);
                }
            } catch (error) {
                console.error('生成音效选项时出错:', error);
            }
        }

        // 关闭设置
        function closeSettings() {
            ModalManager.hide('settingsModal');
        }

        // 切换顾老太太打乱
        function toggleGrandmaShuffle() {
            try {
                const toggle = Utils.getElement('grandmaShuffleToggle');
                const status = Utils.getElement('grandmaShuffleStatus');
                
                if (!toggle || !status) return;
                
                // 如果当前是开启状态，则关闭
                if (AppState.grandmaShuffleEnabled) {
                    AppState.grandmaShuffleEnabled = false;
                    toggle.classList.remove('active');
                    status.textContent = '当前状态：已关闭';
                    
                    // 如果当前已打乱，则恢复原始顺序
                    if (AppState.isShuffled) {
                        toggleShuffle();
                    }
                } else {
                    // 显示打乱方式选择弹窗
                    ModalManager.show('grandmaShuffleModeModal');
                }
            } catch (error) {
                console.error('切换顾老太太打乱时出错:', error);
                Utils.showToast('切换顾老太太打乱时出错，请刷新页面重试');
            }
        }

        // 选择顾老太太打乱方式
        function selectGrandmaShuffleMode(mode) {
            try {
                AppState.grandmaShuffleMode = mode;
                AppState.grandmaShuffleEnabled = true;
                
                const toggle = Utils.getElement('grandmaShuffleToggle');
                const status = Utils.getElement('grandmaShuffleStatus');
                
                if (toggle && status) {
                    toggle.classList.add('active');
                    status.textContent = `当前状态：已开启 (${mode === 'full' ? '全部打乱' : '智能分组打乱'})`;
                }
                
                // 关闭选择弹窗
                ModalManager.hide('grandmaShuffleModeModal');
                
                // 如果当前未打乱，则执行打乱
                if (!AppState.isShuffled) {
                    AppState.shuffleMode = mode;
                    toggleShuffle();
                } else {
                    // 如果当前已打乱，先恢复原始顺序再打乱
                    toggleShuffle();
                    setTimeout(() => {
                        AppState.shuffleMode = mode;
                        toggleShuffle();
                    }, 500);
                }
            } catch (error) {
                console.error('选择顾老太太打乱方式时出错:', error);
                Utils.showToast('选择打乱方式时出错，请刷新页面重试');
            }
        }

        // 取消顾老太太打乱
        function cancelGrandmaShuffle() {
            ModalManager.hide('grandmaShuffleModeModal');
        }

        // 切换题目顺序
        function toggleShuffle() {
            try {
                const currentOriginalIndex = AppState.isShuffled ? 
                    AppState.originalIndices[AppState.currentQuestion] : 
                    AppState.currentQuestion;
                
                if (AppState.isShuffled) {
                    // 恢复原始顺序
                    AppState.questions = [...examData[AppState.currentExam].questions];
                    AppState.originalIndices = Array.from({length: AppState.questions.length}, (_, i) => i);
                    AppState.isShuffled = false;
                    
                    const shuffleBtn = Utils.getElement('shuffleBtn');
                    if (shuffleBtn) {
                        shuffleBtn.classList.remove('active');
                    }
                    
                    // 更新设置中的开关状态
                    if (AppState.isSpecialVersion) {
                        const grandmaToggle = Utils.getElement('grandmaShuffleToggle');
                        const grandmaStatus = Utils.getElement('grandmaShuffleStatus');
                        if (grandmaToggle && grandmaStatus) {
                            grandmaToggle.classList.remove('active');
                            grandmaStatus.textContent = '当前状态：已关闭';
                        }
                    } else {
                        const shuffleToggle = Utils.getElement('shuffleToggle');
                        if (shuffleToggle) {
                            shuffleToggle.classList.remove('active');
                        }
                    }
                    
                    if (AppState.isSpecialVersion) {
                        Utils.showToast('顾老太太已恢复原始题目顺序');
                    } else {
                        Utils.showToast('已恢复原始题目顺序');
                    }
                    
                    AppState.currentQuestion = currentOriginalIndex;
                } else {
                    let newQuestions, newOriginalIndices;
                    
                    // 特殊版本使用顾老太太打乱
                    if (AppState.isSpecialVersion) {
                        const mode = AppState.grandmaShuffleMode || 'full';
                        
                        if (mode === 'group') {
                            const result = shuffleQuestionsByGroup();
                            newQuestions = result.questions;
                            newOriginalIndices = result.originalIndices;
                            showShuffleModal('👵', '顾老太太正在智能分组打乱...', '请稍候，顾老太太正在按题型分组打乱题目顺序');
                        } else {
                            const shuffledIndices = Utils.shuffleArray(Array.from({length: AppState.questions.length}, (_, i) => i));
                            newQuestions = [];
                            newOriginalIndices = [];
                            
                            for (let i = 0; i < shuffledIndices.length; i++) {
                                const originalIndex = shuffledIndices[i];
                                newQuestions.push(examData[AppState.currentExam].questions[originalIndex]);
                                newOriginalIndices.push(originalIndex);
                            }
                            
                            showShuffleModal('👵', '顾老太太正在全部打乱...', '请稍候，顾老太太正在为您打乱题目顺序');
                        }
                    } else {
                        // 普通版本打乱逻辑保持不变
                        if (AppState.shuffleMode === 'group') {
                            const result = shuffleQuestionsByGroup();
                            newQuestions = result.questions;
                            newOriginalIndices = result.originalIndices;
                            showShuffleModal('🔀', '正在智能分组打乱...', '请稍候，系统正在按题型分组打乱题目顺序');
                        } else {
                            const shuffledIndices = Utils.shuffleArray(Array.from({length: AppState.questions.length}, (_, i) => i));
                            newQuestions = [];
                            newOriginalIndices = [];
                            
                            for (let i = 0; i < shuffledIndices.length; i++) {
                                const originalIndex = shuffledIndices[i];
                                newQuestions.push(examData[AppState.currentExam].questions[originalIndex]);
                                newOriginalIndices.push(originalIndex);
                            }
                            
                            showShuffleModal('🔀', '正在全部打乱...', '请稍候，系统正在为您打乱题目顺序');
                        }
                    }
                    
                    AppState.questions = newQuestions;
                    AppState.originalIndices = newOriginalIndices;
                    AppState.isShuffled = true;
                    
                    const shuffleBtn = Utils.getElement('shuffleBtn');
                    if (shuffleBtn) {
                        shuffleBtn.classList.add('active');
                    }
                    
                    // 更新设置中的开关状态
                    if (AppState.isSpecialVersion) {
                        const grandmaToggle = Utils.getElement('grandmaShuffleToggle');
                        const grandmaStatus = Utils.getElement('grandmaShuffleStatus');
                        if (grandmaToggle && grandmaStatus) {
                            grandmaToggle.classList.add('active');
                            grandmaStatus.textContent = `当前状态：已开启 (${AppState.grandmaShuffleMode === 'full' ? '全部打乱' : '智能分组打乱'})`;
                        }
                    } else {
                        const shuffleToggle = Utils.getElement('shuffleToggle');
                        if (shuffleToggle) {
                            shuffleToggle.classList.add('active');
                        }
                    }
                    
                    AppState.currentQuestion = newOriginalIndices.indexOf(currentOriginalIndex);
                }
                
                displayQuestion();
                updateProgress();
                updateButtonVisibility();
            } catch (error) {
                console.error('切换题目顺序时出错:', error);
                Utils.showToast('切换题目顺序时出错，请刷新页面重试');
            }
        }

        // 从设置中切换打乱功能
        function toggleShuffleFromSettings() {
            try {
                // 如果当前是未打乱状态，即将开启打乱
                if (!AppState.isShuffled) {
                    // 显示打乱方式选择弹窗
                    ModalManager.show('shuffleModeModal');
                } else {
                    // 如果当前是打乱状态，则关闭打乱
                    toggleShuffle();
                }
            } catch (error) {
                console.error('从设置中切换打乱功能时出错:', error);
                Utils.showToast('切换打乱功能时出错，请刷新页面重试');
            }
        }

        // 选择打乱方式
        function selectShuffleMode(mode) {
            try {
                AppState.shuffleMode = mode;
                AppState.lastShuffleMode = mode;
                
                // 关闭选择弹窗
                ModalManager.hide('shuffleModeModal');
                
                // 如果当前未打乱，则执行打乱
                if (!AppState.isShuffled) {
                    AppState.shuffleMode = mode;
                    toggleShuffle();
                } else {
                    // 如果当前已打乱，先恢复原始顺序再打乱
                    toggleShuffle();
                    setTimeout(() => {
                        AppState.shuffleMode = mode;
                        toggleShuffle();
                    }, 500);
                }
            } catch (error) {
                console.error('选择打乱方式时出错:', error);
                Utils.showToast('选择打乱方式时出错，请刷新页面重试');
            }
        }

        // 取消打乱方式选择
        function cancelShuffleMode() {
            ModalManager.hide('shuffleModeModal');
        }

        // 智能分组打乱题目
        function shuffleQuestionsByGroup() {
            const questionGroups = {
                'single': [],
                'multiple': [],
                'judge': [],
                'sort': []
            };
            
            AppState.questions.forEach((question, index) => {
                questionGroups[question.type].push({
                    question: question,
                    originalIndex: index
                });
            });
            
            Object.keys(questionGroups).forEach(type => {
                questionGroups[type] = Utils.shuffleArray(questionGroups[type]);
            });
            
            const newQuestions = [];
            const newOriginalIndices = [];
            
            ['single', 'multiple', 'judge', 'sort'].forEach(type => {
                questionGroups[type].forEach(item => {
                    newQuestions.push(item.question);
                    newOriginalIndices.push(item.originalIndex);
                });
            });
            
            return {
                questions: newQuestions,
                originalIndices: newOriginalIndices
            };
        }

        // 显示打乱顺序提示
        function showShuffleToast(message) {
            const existingToast = document.querySelector('.shuffle-toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = Utils.createElement('div', 'shuffle-toast', message);
            if (toast) {
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 2000);
            }
        }

        // 显示打乱动画弹窗
        function showShuffleModal(icon, title, text) {
            const shuffleModal = Utils.getElement('shuffleModal');
            const shuffleIcon = Utils.getElement('shuffleIcon');
            const shuffleTitle = Utils.getElement('shuffleTitle');
            const shuffleText = Utils.getElement('shuffleText');
            
            if (shuffleModal && shuffleIcon && shuffleTitle && shuffleText) {
                shuffleIcon.textContent = icon;
                shuffleTitle.textContent = title;
                shuffleText.textContent = text;
                
                ModalManager.show('shuffleModal');
                
                setTimeout(() => {
                    ModalManager.hide('shuffleModal');
                }, 3000);
            }
        }

        // 播放音效
        function playSound(isCorrect) {
            try {
                // 确保音频上下文已初始化
                if (!AppState.audioContext && !AppState.isSpecialVersion) {
                    initAudioContext();
                }
                
                if (AppState.isSpecialVersion) {
                    playExternalSound(isCorrect);
                    return;
                }
                
                // 检查音频上下文状态
                if (AppState.audioContext && AppState.audioContext.state === 'suspended') {
                    AppState.audioContext.resume().then(() => {
                        generateBuiltInSound(isCorrect);
                    }).catch(e => {
                        console.error('恢复AudioContext失败:', e);
                        // 尝试直接播放音效
                        generateBuiltInSound(isCorrect);
                    });
                } else {
                    generateBuiltInSound(isCorrect);
                }
            } catch (error) {
                console.error('播放音效时出错:', error);
                // 静默失败，不影响用户体验
            }
        }

        // 播放外部音效
        function playExternalSound(isCorrect) {
            try {
                let soundToPlay = isCorrect ? AppState.correctSound : AppState.incorrectSound;
                if (soundToPlay) {
                    soundToPlay.currentTime = 0;
                    soundToPlay.play().catch(e => {
                        console.error('播放外部音效失败:', e);
                        // 降级到内置音效
                        generateBuiltInSound(isCorrect);
                    });
                } else {
                    // 降级到内置音效
                    generateBuiltInSound(isCorrect);
                }
            } catch (error) {
                console.error('播放外部音效出错:', error);
                // 降级到内置音效
                generateBuiltInSound(isCorrect);
            }
        }

        // 生成内置音效
        function generateBuiltInSound(isCorrect) {
            try {
                // 如果没有音频上下文，尝试创建
                if (!AppState.audioContext) {
                    try {
                        window.AudioContext = window.AudioContext || window.webkitAudioContext;
                        AppState.audioContext = new AudioContext();
                    } catch (e) {
                        console.error('Web Audio API不可用:', e);
                        return;
                    }
                }
                
                // 如果音频上下文被暂停，尝试恢复
                if (AppState.audioContext.state === 'suspended') {
                    AppState.audioContext.resume().then(() => {
                        createSound(isCorrect);
                    }).catch(e => {
                        console.error('恢复AudioContext失败:', e);
                        // 尝试直接创建音效
                        createSound(isCorrect);
                    });
                } else {
                    createSound(isCorrect);
                }
            } catch (error) {
                console.error('生成内置音效时出错:', error);
            }
        }

        // 创建音效
        function createSound(isCorrect) {
            try {
                if (!AppState.audioContext) return;
                
                const oscillator = AppState.audioContext.createOscillator();
                const gainNode = AppState.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(AppState.audioContext.destination);
                
                let frequency = 440;
                let duration = 0.2;
                let typeWave = 'sine';
                
                if (isCorrect) {
                    frequency = 523.25;
                    duration = 0.3;
                    typeWave = 'sine';
                    
                    // 添加第二个振荡器创建更丰富的音效
                    const oscillator2 = AppState.audioContext.createOscillator();
                    const gainNode2 = AppState.audioContext.createGain();
                    
                    oscillator2.connect(gainNode2);
                    gainNode2.connect(AppState.audioContext.destination);
                    
                    oscillator2.type = 'sine';
                    oscillator2.frequency.setValueAtTime(659.25, AppState.audioContext.currentTime);
                    gainNode2.gain.setValueAtTime(0.2, AppState.audioContext.currentTime);
                    gainNode2.gain.exponentialRampToValueAtTime(0.01, AppState.audioContext.currentTime + 0.3);
                    
                    oscillator2.start();
                    oscillator2.stop(AppState.audioContext.currentTime + 0.3);
                } else {
                    frequency = 261.63;
                    duration = 0.4;
                    typeWave = 'triangle';
                    
                    // 添加第二个振荡器创建更丰富的音效
                    const oscillator2 = AppState.audioContext.createOscillator();
                    const gainNode2 = AppState.audioContext.createGain();
                    
                    oscillator2.connect(gainNode2);
                    gainNode2.connect(AppState.audioContext.destination);
                    
                    oscillator2.type = 'sawtooth';
                    oscillator2.frequency.setValueAtTime(220.00, AppState.audioContext.currentTime);
                    gainNode2.gain.setValueAtTime(0.2, AppState.audioContext.currentTime);
                    gainNode2.gain.exponentialRampToValueAtTime(0.01, AppState.audioContext.currentTime + 0.4);
                    
                    oscillator2.start();
                    oscillator2.stop(AppState.audioContext.currentTime + 0.4);
                }
                
                oscillator.type = typeWave;
                oscillator.frequency.setValueAtTime(frequency, AppState.audioContext.currentTime);
                
                // 增加音量设置 - 修复音效太小的问题
                gainNode.gain.setValueAtTime(0, AppState.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.8, AppState.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.4, AppState.audioContext.currentTime + duration);
                
                oscillator.start();
                oscillator.stop(AppState.audioContext.currentTime + duration);
                
                return oscillator;
            } catch (error) {
                console.error('创建音效时出错:', error);
            }
        }

        // 10086版本特殊功能 - 播放特殊语音
        function playSpecialToast() {
            try {
                if (!AppState.isSpecialVersion) return;
                
                // 检查语音播报开关是否开启
                if (!AppState.specialToastEnabled) {
                    return;
                }
                
                // 如果已经有弹窗在显示，先清除定时器
                if (AppState.specialToastTimeout) {
                    clearTimeout(AppState.specialToastTimeout);
                    AppState.specialToastTimeout = null;
                }
                
                const specialToast = Utils.getElement('specialToast');
                if (!specialToast) return;
                
                // 如果弹窗已经在显示中，先移除消失类
                if (AppState.specialToastActive) {
                    specialToast.classList.remove('hiding');
                }
                
                // 显示弹窗
                specialToast.style.display = 'block';
                specialToast.classList.remove('hiding');
                AppState.specialToastActive = true;
                
                // 显示语音状态指示器
                showVoiceStatusIndicator();
                
                // 检查是否支持语音合成
                if (AppState.speechSynthesisSupported && AppState.specialToastAudio) {
                    // 使用Web Speech API播放语音
                    const utterance = new SpeechSynthesisUtterance(AppState.specialToastAudio.text);
                    utterance.lang = AppState.specialToastAudio.lang;
                    utterance.rate = AppState.specialToastAudio.rate;
                    utterance.pitch = AppState.specialToastAudio.pitch;
                    utterance.volume = AppState.specialToastAudio.volume;
                    
                    // 确保音频上下文已激活
                    if (!AppState.audioActivated) {
                        // 尝试激活音频上下文
                        if (AppState.audioContext && AppState.audioContext.state === 'suspended') {
                            AppState.audioContext.resume().then(() => {
                                AppState.audioActivated = true;
                                speakUtterance(utterance);
                            }).catch(e => {
                                console.error('激活音频上下文失败:', e);
                                // 即使激活失败，也尝试播放语音
                                speakUtterance(utterance);
                            });
                        } else {
                            speakUtterance(utterance);
                        }
                    } else {
                        speakUtterance(utterance);
                    }
                } else {
                    // 如果语音API不可用，3秒后自动隐藏
                    AppState.specialToastTimeout = setTimeout(() => {
                        specialToast.classList.add('hiding');
                        setTimeout(() => {
                            specialToast.style.display = 'none';
                            specialToast.classList.remove('hiding');
                            AppState.specialToastActive = false;
                            AppState.specialToastTimeout = null;
                            hideVoiceStatusIndicator();
                        }, 1500);
                    }, 3000);
                }
            } catch (error) {
                console.error('播放特殊语音时出错:', error);
            }
        }

        // 显示语音状态指示器
        function showVoiceStatusIndicator() {
            try {
                const voiceIndicator = Utils.getElement('voiceStatusIndicator');
                if (voiceIndicator) {
                    voiceIndicator.classList.add('show');
                }
            } catch (error) {
                console.error('显示语音状态指示器时出错:', error);
            }
        }

        // 隐藏语音状态指示器
        function hideVoiceStatusIndicator() {
            try {
                const voiceIndicator = Utils.getElement('voiceStatusIndicator');
                if (voiceIndicator) {
                    voiceIndicator.classList.remove('show');
                }
            } catch (error) {
                console.error('隐藏语音状态指示器时出错:', error);
            }
        }

        // 10086版本特殊功能 - 优化人物脸部状态动画
        function updateCharacterFace(isCorrect) {
            try {
                if (!AppState.isSpecialVersion) return;
                
                const characterFace = Utils.getElement('characterFace');
                if (!characterFace) return;
                
                if (isCorrect) {
                    // 答对题目，增加连续答对计数
                    AppState.consecutiveCorrectCount++;
                    AppState.correctCountInSpecialVersion++;
                    
                    // 如果正在恢复动画中，不重复触发
                    if (AppState.isRecovering) {
                        return;
                    }
                    
                    // 连续答对5道题及以上，脸部恢复
                    if (AppState.consecutiveCorrectCount >= 5) {
                        AppState.isRecovering = true;
                        characterFace.classList.remove('swollen');
                        characterFace.classList.add('recovering');
                        
                        // 恢复动画结束后移除类
                        setTimeout(() => {
                            characterFace.classList.remove('recovering');
                            characterFace.classList.add('normal');
                            AppState.isRecovering = false;
                            AppState.consecutiveCorrectCount = 0;
                        }, 2000);
                    }
                } else {
                    // 答错题目，重置连续答对计数，脸部肿胀
                    AppState.consecutiveCorrectCount = 0;
                    AppState.isRecovering = false;
                    
                    characterFace.classList.remove('normal', 'recovering');
                    characterFace.classList.add('swollen');
                    
                    // 播放特殊语音（仅在开关开启时）
                    playSpecialToast();
                }
            } catch (error) {
                console.error('更新人物脸部状态时出错:', error);
            }
        }

        // 预览音效
        function previewSound(event, soundType) {
            event.stopPropagation();
            
            if (AppState.isPreviewing) {
                return;
            }
            
            const previewBtn = event.target;
            if (!previewBtn) {
                console.error('预览按钮未找到');
                return;
            }
            
            if (AppState.isSpecialVersion && soundType === 'animal') {
                previewExternalSound(soundType);
                return;
            }
            
            // 确保音频上下文已初始化
            if (!AppState.audioContext) {
                initAudioContext();
            }
            
            previewBtn.classList.add('playing');
            AppState.isPreviewing = true;
            
            if (AppState.audioContext.state === 'suspended') {
                AppState.audioContext.resume().then(() => {
                    createSound(true);
                    Utils.showToast(`正在播放: ${getSoundName(soundType)}`);
                    
                    setTimeout(() => {
                        previewBtn.classList.remove('playing');
                        AppState.isPreviewing = false;
                    }, 600);
                }).catch(e => {
                    console.error('恢复AudioContext失败:', e);
                    previewBtn.classList.remove('playing');
                    AppState.isPreviewing = false;
                    Utils.showToast(`预览"${getSoundName(soundType)}"音效失败`);
                });
            } else {
                createSound(true);
                Utils.showToast(`正在播放: ${getSoundName(soundType)}`);
                
                setTimeout(() => {
                    previewBtn.classList.remove('playing');
                    AppState.isPreviewing = false;
                }, 600);
            }
        }

        // 预览外部音效
        function previewExternalSound(soundType) {
            if (soundType === 'animal') {
                if (AppState.correctSound) {
                    AppState.correctSound.currentTime = 0;
                    AppState.correctSound.play().catch(e => {
                        console.error('预览外部音效失败:', e);
                        Utils.showToast('预览音效失败');
                    });
                    Utils.showToast('正在播放: 动物叫声 (答对音效)');
                } else {
                    Utils.showToast('音效未加载完成');
                }
            }
        }

        // 获取音效名称
        function getSoundName(type) {
            const names = {
                'correct': '答对音效',
                'incorrect': '答错音效',
                'animal': '动物叫声'
            };
            return names[type] || type;
        }

        // 打开答题卡
        function openAnswerCard() {
            ModalManager.show('answerCardModal');
            displayQuestionGrid();
        }

        // 关闭答题卡
        function closeAnswerCard() {
            ModalManager.hide('answerCardModal');
        }

        // 显示题目网格
        function displayQuestionGrid() {
            try {
                const grid = Utils.getElement('questionGrid');
                if (!grid) {
                    console.error('题目网格未找到');
                    return;
                }
                
                grid.innerHTML = '';
                
                checkAnswerStatus();
                
                AppState.questions.forEach((q, index) => {
                    const btn = Utils.createElement('div', 'question-btn');
                    if (!btn) return;
                    
                    btn.textContent = index + 1;
                    
                    if (index === AppState.currentQuestion) {
                        btn.classList.add('current');
                    } else if (!AppState.isAnswered[index] || AppState.userAnswers[index] === null) {
                        btn.classList.add('unanswered');
                    } else {
                        let isCorrect = false;
                        if (q.type === 'multiple') {
                            const userAnswer = AppState.userAnswers[index] || [];
                            isCorrect = userAnswer.length === q.answer.length && 
                            userAnswer.every(ans => q.answer.includes(ans));
                        } else if (q.type === 'sort') {
                            const userAnswer = AppState.userAnswers[index] || [];
                            isCorrect = JSON.stringify(userAnswer) === JSON.stringify(q.answer);
                        } else {
                            isCorrect = AppState.userAnswers[index] === q.answer;
                        }
                        
                        if (isCorrect) {
                            btn.classList.add('correct');
                        } else {
                            btn.classList.add('incorrect');
                        }
                    }
                    
                    btn.onclick = () => goToQuestion(index);
                    grid.appendChild(btn);
                });
            } catch (error) {
                console.error('显示题目网格时出错:', error);
                Utils.showToast('显示题目网格时出错，请刷新页面重试');
            }
        }

        // 检查答题状态并显示特殊提示
        function checkAnswerStatus() {
            try {
                const specialStatusArea = Utils.getElement('specialStatusArea');
                if (!specialStatusArea) {
                    console.error('特殊状态区域未找到');
                    return;
                }
                
                specialStatusArea.innerHTML = '';
                
                const hasAnswered = AppState.isAnswered.some(answered => answered);
                if (!hasAnswered) {
                    const emptyDiv = Utils.createElement('div', 'answer-card-special empty');
                    if (!emptyDiv) return;
                    
                    emptyDiv.innerHTML = `
                        <div class="special-icon">📝</div>
                        <div class="special-title">您还没有开始答题</div>
                        <div class="special-text">点击题目按钮开始答题，或者点击"清空记录"按钮重置答题状态。</div>
                    `;
                    specialStatusArea.appendChild(emptyDiv);
                    return;
                }
                
                const allCorrect = AppState.questions.every((q, index) => {
                    if (!AppState.isAnswered[index] || AppState.userAnswers[index] === null) return false;
                    
                    if (q.type === 'multiple') {
                        const userAnswer = AppState.userAnswers[index] || [];
                        return userAnswer.length === q.answer.length && 
                        userAnswer.every(ans => q.answer.includes(ans));
                    } else if (q.type === 'sort') {
                        const userAnswer = AppState.userAnswers[index] || [];
                        return JSON.stringify(userAnswer) === JSON.stringify(q.answer);
                    } else {
                        return AppState.userAnswers[index] === q.answer;
                    }
                });
                
                if (allCorrect) {
                    const allCorrectDiv = Utils.createElement('div', 'answer-card-special all-correct');
                    if (!allCorrectDiv) return;
                    
                    allCorrectDiv.innerHTML = `
                        <div class="special-icon">🎉</div>
                        <div class="special-title">太棒了！您答对了所有题目！</div>
                        <div class="special-text">恭喜您全部答对，展现了出色的知识掌握能力！继续保持这种学习状态！</div>
                    `;
                    specialStatusArea.appendChild(allCorrectDiv);
                    return;
                }
                
                const allIncorrect = AppState.questions.every((q, index) => {
                    if (!AppState.isAnswered[index] || AppState.userAnswers[index] === null) return false;
                    
                    if (q.type === 'multiple') {
                        const userAnswer = AppState.userAnswers[index] || [];
                        return !(userAnswer.length === q.answer.length && 
                        userAnswer.every(ans => q.answer.includes(ans)));
                    } else if (q.type === 'sort') {
                        const userAnswer = AppState.userAnswers[index] || [];
                        return !(JSON.stringify(userAnswer) === JSON.stringify(q.answer));
                    } else {
                        return AppState.userAnswers[index] !== q.answer;
                    }
                });
                
                if (allIncorrect) {
                    const allIncorrectDiv = Utils.createElement('div', 'answer-card-special all-incorrect');
                    if (!allIncorrectDiv) return;
                    
                    allIncorrectDiv.innerHTML = `
                        <div class="special-icon">💪</div>
                        <div class="special-title">不要气馁！</div>
                        <div class="special-text">虽然这次没有答对任何题目，但每一次尝试都是学习的过程。建议您重新复习知识点，再次尝试！</div>
                    `;
                    specialStatusArea.appendChild(allIncorrectDiv);
                    return;
                }
            } catch (error) {
                console.error('检查答题状态时出错:', error);
            }
        }

        // 跳转到指定题目
        function goToQuestion(index) {
            AppState.currentQuestion = index;
            displayQuestion();
            updateProgress();
            updateButtonVisibility();
            closeAnswerCard();
        }

        // 筛选题目
        function filterQuestions(filter) {
            AppState.currentFilter = filter;
            
            const tabs = document.querySelectorAll('.filter-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            const targetTab = event.target;
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            displayQuestionGrid();
        }

        // 显示清空确认弹窗
        function showClearConfirm() {
            ModalManager.show('confirmModal');
        }

        // 隐藏清空确认弹窗
        function hideClearConfirm() {
            ModalManager.hide('confirmModal');
        }

        // 清空记录
        function clearRecords() {
            AppState.userAnswers = new Array(AppState.questions.length).fill(null);
            AppState.isAnswered = new Array(AppState.questions.length).fill(false);
            AppState.sortSubmitted = new Array(AppState.questions.length).fill(false);
            
            hideClearConfirm();
            displayQuestionGrid();
            
            if (AppState.currentQuestion >= 0 && AppState.currentQuestion < AppState.questions.length) {
                displayQuestion();
                updateButtonVisibility();
            }
        }

        // 查看结果
        function viewResults() {
            closeAnswerCard();
            submitAnswers();
        }

        // 提交答案
        function submitAnswers() {
            try {
                let singleCorrectCount = 0;
                let multipleCorrectCount = 0;
                let judgeCorrectCount = 0;
                let sortCorrectCount = 0;
                
                const singleScore = 2;
                const multipleScore = 3;
                const judgeScore = 1;
                const sortScore = 3;
                
                AppState.questions.forEach((q, index) => {
                    let isCorrect = false;
                    
                    if (q.type === 'single') {
                        isCorrect = AppState.userAnswers[index] === q.answer;
                        if (isCorrect) singleCorrectCount++;
                    } else if (q.type === 'multiple') {
                        const userAnswer = AppState.userAnswers[index] || [];
                        isCorrect = userAnswer.length === q.answer.length && 
                        userAnswer.every(ans => q.answer.includes(ans));
                        if (isCorrect) multipleCorrectCount++;
                    } else if (q.type === 'judge') {
                        isCorrect = AppState.userAnswers[index] === q.answer;
                        if (isCorrect) judgeCorrectCount++;
                    } else if (q.type === 'sort') {
                        const userAnswer = AppState.userAnswers[index] || [];
                        isCorrect = JSON.stringify(userAnswer) === JSON.stringify(q.answer);
                        if (isCorrect) sortCorrectCount++;
                    }
                    
                    // 收集错题
                    if (!isCorrect && AppState.userAnswers[index] !== null && AppState.userAnswers[index] !== undefined) {
                        // 检查是否已经存在该错题
                        const existingIndex = AppState.wrongAnswers.findIndex(wrong => 
                            wrong.question.question === q.question
                        );
                        
                        if (existingIndex === -1) {
                            AppState.wrongAnswers.push({
                                question: q,
                                userAnswer: AppState.userAnswers[index]
                            });
                        }
                    }
                });
                
                const singleTotalScore = singleCorrectCount * singleScore;
                const multipleTotalScore = multipleCorrectCount * multipleScore;
                const judgeTotalScore = judgeCorrectCount * judgeScore;
                const sortTotalScore = sortCorrectCount * sortScore;
                
                // 计算总分
                let totalScore = singleTotalScore + multipleTotalScore + judgeTotalScore + sortTotalScore;
                let maxScore = 90;
                let isPass = totalScore >= 54;
                
                // 如果是错题重做，使用动态评分系统
                if (AppState.currentExam === 'wrongRetry') {
                    // 计算实际满分
                    maxScore = 0;
                    AppState.questions.forEach(q => {
                        if (q.type === 'single') maxScore += singleScore;
                        else if (q.type === 'multiple') maxScore += multipleScore;
                        else if (q.type === 'judge') maxScore += judgeScore;
                        else if (q.type === 'sort') maxScore += sortScore;
                    });
                    
                    // 动态计算及格线（60%）
                    const passScore = Math.round(maxScore * 0.6);
                    isPass = totalScore >= passScore;
                }
                
                const percentage = Math.round((totalScore / maxScore) * 100);
                
                const resultScoreElement = Utils.getElement('resultScore');
                const scorePercentageElement = Utils.getElement('scorePercentage');
                const scoreBadgeElement = Utils.getElement('scoreBadge');
                const resultIconElement = Utils.getElement('resultIcon');
                const resultEvaluationElement = Utils.getElement('resultEvaluation');
                
                if (scorePercentageElement) {
                    scorePercentageElement.textContent = percentage + '%';
                }
                
                // 检查是否全部答对
                const allCorrect = AppState.questions.every((q, index) => {
                    if (!AppState.isAnswered[index] || AppState.userAnswers[index] === null) return false;
                    
                    if (q.type === 'multiple') {
                        const userAnswer = AppState.userAnswers[index] || [];
                        return userAnswer.length === q.answer.length && 
                        userAnswer.every(ans => q.answer.includes(ans));
                    } else if (q.type === 'sort') {
                        const userAnswer = AppState.userAnswers[index] || [];
                        return JSON.stringify(userAnswer) === JSON.stringify(q.answer);
                    } else {
                        return AppState.userAnswers[index] === q.answer;
                    }
                });
                
                if (resultScoreElement && scoreBadgeElement && resultIconElement && resultEvaluationElement) {
                    if (allCorrect) {
                        // 满分情况
                        resultScoreElement.className = 'result-score perfect';
                        scoreBadgeElement.className = 'result-badge perfect';
                        scoreBadgeElement.textContent = '满分';
                        resultIconElement.textContent = '🏆';
                        resultEvaluationElement.className = 'result-evaluation perfect';
                        resultEvaluationElement.innerHTML = '<strong>完美！</strong> 您答对了所有题目，展现了出色的知识掌握能力！继续保持这种学习状态，您一定能取得更好的成绩！';
                    } else if (isPass) {
                        resultScoreElement.className = 'result-score pass';
                        scoreBadgeElement.className = 'result-badge pass';
                        scoreBadgeElement.textContent = '及格';
                        resultIconElement.textContent = '🎉';
                        resultEvaluationElement.className = 'result-evaluation pass';
                        
                        if (percentage >= 90) {
                            resultEvaluationElement.innerHTML = '<strong>优秀！</strong> 您的表现非常出色，几乎答对了所有题目！继续保持这种学习状态，您一定能取得更好的成绩！';
                        } else if (percentage >= 80) {
                            resultEvaluationElement.innerHTML = '<strong>良好！</strong> 您答对了大部分题目，基础知识掌握得很好。继续努力，争取更高的分数！';
                        } else if (percentage >= 70) {
                            resultEvaluationElement.innerHTML = '<strong>中等！</strong> 您已经掌握了大部分知识点，但还有一些需要加强的地方。建议复习错题，巩固知识点。';
                        } else {
                            resultEvaluationElement.innerHTML = '<strong>及格！</strong> 您刚刚达到及格线，基础知识基本掌握，但还需要更多的练习来提高熟练度。';
                        }
                    } else {
                        resultScoreElement.className = 'result-score fail';
                        scoreBadgeElement.className = 'result-badge fail';
                        scoreBadgeElement.textContent = '不及格';
                        resultIconElement.textContent = '😔';
                        resultEvaluationElement.className = 'result-evaluation fail';
                        
                        if (percentage >= 50) {
                            resultEvaluationElement.innerHTML = '<strong>接近及格！</strong> 您已经掌握了一部分知识点，但还需要更多的练习。建议重点复习错题，巩固基础知识。';
                        } else if (percentage >= 30) {
                            resultEvaluationElement.innerHTML = '<strong>需要加强！</strong> 您对知识点的掌握还不够扎实，建议系统性地复习教材，多做练习题。';
                        } else {
                            resultEvaluationElement.innerHTML = '<strong>需要努力！</strong> 您可能对大部分知识点还不够熟悉，建议从基础开始，逐步学习和练习。';
                        }
                    }
                }
                
                const singleScoreElement = Utils.getElement('singleScore');
                const multipleScoreElement = Utils.getElement('multipleScore');
                const judgeScoreElement = Utils.getElement('judgeScore');
                const sortScoreElement = Utils.getElement('sortScore');
                const totalScoreElement = Utils.getElement('totalScore');
                const resultTextElement = Utils.getElement('resultText');
                
                if (singleScoreElement) {
                    singleScoreElement.textContent = `${singleTotalScore}分/${AppState.questions.filter(q => q.type === 'single').length * singleScore}分`;
                }
                
                if (multipleScoreElement) {
                    multipleScoreElement.textContent = `${multipleTotalScore}分/${AppState.questions.filter(q => q.type === 'multiple').length * multipleScore}分`;
                }
                
                if (judgeScoreElement) {
                    judgeScoreElement.textContent = `${judgeTotalScore}分/${AppState.questions.filter(q => q.type === 'judge').length * judgeScore}分`;
                }
                
                if (sortScoreElement) {
                    sortScoreElement.textContent = `${sortTotalScore}分/${AppState.questions.filter(q => q.type === 'sort').length * sortScore}分`;
                }
                
                if (totalScoreElement) {
                    totalScoreElement.textContent = `${totalScore}分/${maxScore}分`;
                }
                
                const totalCorrectCount = singleCorrectCount + multipleCorrectCount + judgeCorrectCount + sortCorrectCount;
                if (resultTextElement) {
                    // 优化：将得分部分进行红色加粗处理
                    resultTextElement.innerHTML = `您答对了 ${totalCorrectCount} 道题，共 ${AppState.questions.length} 道题，得分 <span class="highlight-score">${totalScore}</span> 分`;
                }
                
                // 保存历史记录
                const historyRecord = {
                    date: new Date().toLocaleString(),
                    examTitle: examData[AppState.currentExam].title,
                    totalScore: totalScore,
                    maxScore: maxScore,
                    percentage: percentage,
                    isPass: isPass,
                    singleCorrectCount: singleCorrectCount,
                    multipleCorrectCount: multipleCorrectCount,
                    judgeCorrectCount: judgeCorrectCount,
                    sortCorrectCount: sortCorrectCount,
                    totalCorrectCount: totalCorrectCount,
                    totalQuestions: AppState.questions.length
                };
                
                AppState.historyRecords.push(historyRecord);
                DataManager.saveData('examHistory', AppState.historyRecords);
                
                // 保存错题记录
                DataManager.saveData('wrongAnswers', AppState.wrongAnswers);
                
                ModalManager.show('resultModal');
            } catch (error) {
                console.error('提交答案时出错:', error);
                Utils.showToast('提交答案时出错，请刷新页面重试');
            }
        }

        // 关闭模态框
        function closeModal() {
            ModalManager.hide('resultModal');
        }

        // 显示历史记录
        function showHistoryRecords() {
            PageManager.showPage('history');
            generateHistoryList();
        }

        // 生成历史记录列表
        function generateHistoryList() {
            try {
                const historyList = Utils.getElement('historyList');
                if (!historyList) {
                    console.error('历史记录列表容器未找到');
                    return;
                }
                
                historyList.innerHTML = '';
                
                if (AppState.historyRecords.length === 0) {
                    historyList.innerHTML = `
                        <div class="empty-history">
                            <div class="empty-icon">📊</div>
                            <div class="empty-title">暂无历史记录</div>
                            <div class="empty-text">完成考试后，您的成绩记录将显示在这里</div>
                        </div>
                    `;
                    return;
                }
                
                const sortedRecords = [...AppState.historyRecords].reverse();
                
                sortedRecords.forEach((record, index) => {
                    const recordItem = Utils.createElement('div', 'history-record-item');
                    if (!recordItem) return;
                    
                    recordItem.className = `exam-card ${record.isPass ? 'pass' : 'fail'}`;
                    recordItem.innerHTML = `
                        <div class="exam-icon">${record.isPass ? '🎉' : '😔'}</div>
                        <div class="exam-content">
                            <div class="exam-title">${record.examTitle}</div>
                            <div class="exam-description">
                                <div>考试时间：${record.date}</div>
                                <div>得分：${record.totalScore}分/${record.maxScore}分 (${record.percentage}%)</div>
                                <div>答对：${record.totalCorrectCount}题/${record.totalQuestions}题</div>
                            </div>
                            <div class="exam-footer">
                                <div class="exam-status ${record.isPass ? 'available' : 'empty'}">${record.isPass ? '及格' : '不及格'}</div>
                            </div>
                        </div>
                    `;
                    
                    historyList.appendChild(recordItem);
                });
            } catch (error) {
                console.error('生成历史记录列表时出错:', error);
                Utils.showToast('生成历史记录列表时出错，请刷新页面重试');
            }
        }

        // 清空历史记录
        function clearHistoryRecords() {
            if (confirm('确定要清空所有历史记录吗？此操作不可撤销。')) {
                AppState.historyRecords = [];
                DataManager.removeData('examHistory');
                generateHistoryList();
            }
        }

        // 返回试卷选择页面
        function backToExamSelection() {
            PageManager.showPage('examSelection');
        }

        // 加载历史记录
        function loadHistoryRecords() {
            try {
                const savedHistory = DataManager.loadData('examHistory');
                if (savedHistory) {
                    AppState.historyRecords = savedHistory;
                    console.log(`成功加载 ${AppState.historyRecords.length} 条历史记录`);
                } else {
                    console.log('没有找到历史记录，使用默认值');
                    AppState.historyRecords = [];
                }
            } catch (error) {
                console.error('加载历史记录时出错:', error);
                AppState.historyRecords = [];
            }
        }

        // 加载错题记录
        function loadWrongAnswers() {
            try {
                const savedWrongAnswers = DataManager.loadData('wrongAnswers');
                if (savedWrongAnswers) {
                    AppState.wrongAnswers = savedWrongAnswers;
                    console.log(`成功加载 ${AppState.wrongAnswers.length} 条错题记录`);
                } else {
                    console.log('没有找到错题记录，使用默认值');
                    AppState.wrongAnswers = [];
                }
            } catch (error) {
                console.error('加载错题记录时出错:', error);
                AppState.wrongAnswers = [];
            }
        }

        // 更新历史记录数量
        function updateHistoryCount() {
            const historyCount = Utils.getElement('historyCount');
            if (historyCount) {
                historyCount.textContent = AppState.historyRecords.length;
            }
        }

        // 页面刷新保护
        function setupRefreshProtection() {
            // 添加beforeunload事件监听器
            window.addEventListener('beforeunload', function(e) {
                // 只有在考试页面且启用刷新保护时才触发
                if (AppState.currentPage === 'exam' && AppState.refreshProtectionEnabled) {
                    // 检查是否有未完成的题目
                    const hasUnansweredQuestions = AppState.isAnswered.some(answered => !answered);
                    
                    if (hasUnansweredQuestions) {
                        // 取消默认的刷新行为
                        e.preventDefault();
                        e.returnValue = '';
                        
                        // 显示确认弹窗
                        setTimeout(() => {
                            ModalManager.show('refreshConfirmModal');
                        }, 100);
                        
                        return '';
                    }
                }
            });
        }

        // 提交并刷新
        function submitAndRefresh() {
            try {
                // 隐藏确认弹窗
                ModalManager.hide('refreshConfirmModal');
                
                // 提交答案
                submitAnswers();
                
                // 禁用刷新保护
                AppState.refreshProtectionEnabled = false;
                
                // 刷新页面
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } catch (error) {
                console.error('提交并刷新时出错:', error);
                Utils.showToast('提交并刷新时出错，请刷新页面重试');
            }
        }

        // 取消刷新
        function cancelRefresh() {
            ModalManager.hide('refreshConfirmModal');
        }

        // 初始化应用
        function init() {
            // 检查localStorage可用性
            if (!DataManager.isLocalStorageAvailable()) {
                console.warn('localStorage不可用，数据将无法持久化保存');
                Utils.showToast('您的浏览器不支持本地存储，历史记录和错题记录可能无法保存');
            }
            
            // 加载数据
            loadHistoryRecords();
            loadWrongAnswers();
            setupRefreshProtection();
            
            // 添加点击事件监听器到特殊弹窗
            const specialToast = Utils.getElement('specialToast');
            if (specialToast) {
                specialToast.addEventListener('click', function() {
                    // 清除定时器
                    if (AppState.specialToastTimeout) {
                        clearTimeout(AppState.specialToastTimeout);
                        AppState.specialToastTimeout = null;
                    }
                    
                    // 添加消失动画
                    this.classList.add('hiding');
                    
                    // 设置定时器，在动画结束后隐藏弹窗
                    AppState.specialToastTimeout = setTimeout(() => {
                        this.style.display = 'none';
                        this.classList.remove('hiding');
                        AppState.specialToastActive = false;
                        AppState.specialToastTimeout = null;
                        hideVoiceStatusIndicator();
                    }, 1500);
                });
            }
            
            // 显示存储空间使用情况（调试用）
            const storageUsage = DataManager.getStorageUsage();
            if (storageUsage) {
                console.log(`存储空间使用情况: 已用 ${storageUsage.usedKB} KB，可用 ${storageUsage.availableKB} KB`);
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            init();
        });
    </script>
</body>
</html>
